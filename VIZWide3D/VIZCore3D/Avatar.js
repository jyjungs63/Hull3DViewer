class Avatar{constructor(a,b){let c=this,d=[],e=0x0,f=0x1,g=-0x1;this['AvatarUserType']=-0x1,this['ShowAvatar']=!![],this['AvatarCurrentTime']=0x0,this['AvatarZoom']=0x1388,this['ZoomRate']=0x12c,this['AvatarZoomMax']=0x1388,this['AvatarZoomMin']=0x1f4;let h=-0x3c,i=0x5a;this['ShowPosition']=a['Configuration']['Walkthrough']['Position']===undefined?![]:a['Configuration']['Walkthrough']['Position']['Visible'],this['PosInfo']={'Pos':undefined,'Dir':undefined},this['GetKey']=function(){return'softhills_AvatarObject';},j();function j(){}this['Clear']=function(){for(let m=e-0x1;m>=0x0;m--){c['DeleteObject'](d[m]['uuid']);}d=[],e=0x0,g=-0x1;},this['Visible']=function(m){if(c['ShowAvatar']===m)return;c['ShowAvatar']=m;if(m){let n=a['Control']['GetMode']();if(n!==b['Enum']['CONTROL_STATE']['WALKTHROUGH'])return;c['InitPosAndDirection']();}},this['AddObject']=function(m){d['push'](m);for(let n=0x0;n<m['object']['length'];n++){m['object'][n]['id_file']=c['GetKey'](),'';for(let o=0x0;o<m['object'][n]['tag']['length'];o++){let p=m['object'][n]['tag'][o];p['partId']=f,f++,p['bodyId']=f,f++,p['origin_id']=p['bodyId'];let q=a['Data']['ShapeAction']['GetAction'](p['object']['id_file'],p['origin_id']);{q===undefined&&(q=a['Data']['ActionItem'](),q['material']=p['material']),a['Data']['ShapeAction']['SetAction'](p['object']['id_file'],p['origin_id'],q);}}a['RenderWGL']['SetDataByObject'](m['object'][n]),m['enableSelection']=![];}e++;if(g<0x0)g=0x0;c['SetAnimationByIndex'](m['uuid'],0x0,0x0);},this['GetObject']=function(m){if(m===undefined){if(g>=0x0)return d[g];}for(let n=0x0;n<d['length'];n++){if(d[n]['uuid']!==m)continue;return d[n];}return undefined;},this['SetUserAvatar']=function(m){for(let n=0x0;n<d['length'];n++){if(d[n]['uuid']!==m)continue;g=n;break;}},this['AddAnimationData']=function(m,n,o,p){let q=c['GetObject'](m);if(q===undefined)return;if(n<0x0)n=0x0;if(q['animation'][n]===undefined)q['animation'][n]=p;else{if(o>=0x0)for(let r=0x0;r<p['layer']['length'];r++){q['animation'][n]['layer'][o+r]=p['layer'][r];}else for(let s=0x0;s<p['layer']['length'];s++){q['animation'][n]['layer']['push'](p['layer'][s]);}}},this['SetAnimationByIndex']=function(m,n,o){let p=c['GetObject'](m);if(p===undefined)return;if(o<p['animation'][n]['layer']['length'])c['SetAnimation'](p['uuid'],n,p['animation'][n]['layer'][o]['ID']);},this['SetAnimation']=function(m,n,o){let p=c['GetObject'](m);if(p===undefined)return;let q=![];p['currentAnimationNum']!==n&&(q=!![]);let r=-0x1;for(let s=0x0;s<p['animation'][n]['layer']['length'];s++){if(p['animation'][n]['layer'][s]['ID']!==o)continue;r=s;break;}if(!q&&p['animation'][n]['playAnimation']===r)return;p['currentAnimationNum']=n,p['animation'][n]['lastAnimation']=p['animation'][n]['playAnimation'],p['animation'][n]['lastAnimationSecond']=p['animation'][n]['animationSecond'],p['animation'][n]['playAnimation']=-0x1;r>=0x0&&(p['animation'][n]['playAnimation']=r,p['animation'][n]['animationSecond']=0x0);if(q)p['animation'][n]['lastAnimation']=-0x1;},this['SetPosAndDirection']=function(n,o,p,q){let r=c['GetObject'](n);if(r===undefined)return;if(o!=undefined)r['position']['copy'](o);if(p!=undefined)r['direction']['copy'](p);if(q!=undefined)r['up']['copy'](q);let s=new b['Vector3']()['copy'](r['direction']),t=new b['Vector3']()['copy'](r['up']),u=new b['Vector3']()['crossVectors'](t,s),v=new b['Vector3']()['copy'](s);v['cross'](u),v['normalize']();let w=new b['Matrix4']()['makeBasis'](s,u,v),x=new b['Matrix4']()['setPosition'](r['position']),y=new b['Matrix4']()['multiplyMatrices'](x,w);for(let z=0x0;z<r['object']['length'];z++){for(let A=0x0;A<r['object'][z]['tag']['length'];A++){let B=r['object'][z]['tag'][A],C=a['Data']['ShapeAction']['GetAction'](B['object']['id_file'],B['origin_id']);C['transform']['copy'](y);}r['object'][z]['flag']['updateProcess']=!![];}a['Renderer']['Render']();},this['InitPosAndDirection']=function(m,n){let o=c['GetObject']();if(o===undefined)return;let p=new b['Vector3']()['copy'](o['position']),q=new b['Vector3']()['copy'](o['direction']),r=new b['Vector3'](0x0,0x0,0x1),s=new b['Matrix4']()['copy'](a['Camera']['matMV']),t=new b['Matrix4']()['copy'](a['Camera']['matMVP']),u=new b['Matrix4']()['getInverse'](s),v=u['multiplyVector'](a['Camera']['cameraPosition']);const w=a['Renderer']['GetSizeWidth'](),x=a['Renderer']['GetSizeHeight']();let y=new b['Vector3'](w/0x2,x/0x2,0x0),z=new b['Vector3'](w/0x2,x/0x2,0.5),A=a['Camera']['screen2WorldWithMatrix'](t,y),B=a['Camera']['screen2WorldWithMatrix'](t,z),C=new b['Vector3']()['subVectors'](B,A);C['normalize']();let D=c['AvatarZoom'];D=Math['max'](c['AvatarZoomMin'],D),D=Math['min'](c['AvatarZoomMax'],D),p=new b['Vector3']()['addVectors'](v,C['multiplyScalar'](D)),p['z']-=0x690,C['z']=0x0,C['normalize'](),q['copy'](C);let E=new b['Matrix4']()['makeRotationZ'](0x5a*Math['PI']/0xb4);q['applyMatrix4'](E);if(m!==undefined)p['copy'](m);if(n!==undefined)q['copy'](n);c['SetPosAndDirection'](o['uuid'],p,q,r);},this['UpdateCamera']=function(){let m=c['GetObject']();if(m===undefined)return;let n=new b['Vector3']()['copy'](m['position']),o=new b['Vector3']()['copy'](m['direction']),p=new b['Vector3']()['copy'](m['up']),q=new b['Matrix4']()['copy'](a['Camera']['matMV']),r=new b['Matrix4']()['copy'](a['Camera']['matMVP']),s=new b['Matrix4']()['getInverse'](q),t=s['multiplyVector'](a['Camera']['cameraPosition']),u=q['multiplyVector'](new b['Vector3']());n['z']+=0x690;let v=c['AvatarZoom'];v=Math['max'](c['AvatarZoomMin'],v),v=Math['min'](c['AvatarZoomMax'],v);let w=new b['Vector3']()['subVectors'](n,t),x=q['multiplyVector'](w);x=new b['Vector3']()['subVectors'](x,u);let y=new b['Vector3'](0x0,0x0,0x1);y['normalize'](),x=new b['Vector3']()['addVectors'](x,y['multiplyScalar'](v)),a['Camera']['cameraMatrix']['translate'](-x['x'],-x['y'],-x['z']),a['Camera']['ResizeGLWindow'](),this['PosInfo']['Pos']=new b['Vector3']()['copy'](m['position']),this['PosInfo']['Dir']=new b['Vector3'](0x0,0x0,-0x1);if(this['ShowAvatar']&&this['ShowPosition']){}};function k(m,n,o,p,q){let r=new b['Matrix4']()['copy'](a['Camera']['matMVP']),s=0x8,t=0x2;m['font']=s+'pt\x20Arial',m['fillStyle']='rgba(0,\x200,\x200,\x201.0)';let u=0x1e;if(q!==undefined)u=q;let v=a['Camera']['GetScreen1PixelLength'](n),x=new b['Vector3']()['addVectors'](n,new b['Vector3']()['copy'](o)['multiplyScalar'](v*u)),y=a['Camera']['world2ScreenWithMatrix'](r,x),z=m['measureText'](p),A=z['width']+t*0x2,B=z['height']+t*0x2;m['fillText'](p,y['x']-A/0x2,y['y']);}this['Render2D']=function(){let m=a['Control']['GetMode']();if(b['Enum']['CONTROL_STATE']['WALKTHROUGH']!==m)return;this['PosInfo']['Pos']===undefined&&c['UpdateCamera']();if(this['ShowAvatar']&&this['ShowPosition']&&this['PosInfo']['Pos']!==undefined){let n='X:'+this['PosInfo']['Pos']['x']['toFixed'](0x2)+',\x20Y:'+this['PosInfo']['Pos']['y']['toFixed'](0x2)+',\x20Z:'+this['PosInfo']['Pos']['z']['toFixed'](0x2);k(a['ctx_review'],this['PosInfo']['Pos'],this['PosInfo']['Dir'],n,0x1e);}},this['SetZoom']=function(m){m=Math['max'](c['AvatarZoomMin'],m),m=Math['min'](c['AvatarZoomMax'],m),c['AvatarZoom']=m,c['UpdateCamera']();},this['CameraRotate']=function(m,n){let o=new b['Matrix4']()['makeRotationX'](m['x']),p=new b['Matrix4']()['makeRotationY'](m['y']),q=new b['Matrix4']()['makeRotationZ'](m['z']);{let r=new b['Matrix4']()['copy'](a['Camera']['matMV']);{let v=new b['Matrix4']()['copy'](r);v['setPosition'](new b['Vector3'](0x0,0x0,0x0));let w=new b['Vector3'](0x0,0x0,0x1),x=new b['Vector3'](0x0,0x0,0x0);w['applyMatrix4'](v),x['applyMatrix4'](v);if(w['y']<x['y'])q=new b['Matrix4']()['makeRotationZ'](-m['z']);}let s=new b['Matrix4'](),t=new b['Matrix4']();{let y=new b['Vector3']()['copy'](n);y['applyMatrix4'](r);let z=new b['Matrix4'](),A=new b['Vector3']()['copy'](y)['multiplyScalar'](-0x1);z['setPosition'](A);let B=new b['Matrix4']()['copy'](o),C=new b['Matrix4']()['setPosition'](y),D=new b['Matrix4']()['multiplyMatrices'](B,z);s=new b['Matrix4']()['multiplyMatrices'](C,D);}{let E=new b['Vector3']()['copy'](n),F=new b['Matrix4'](),G=new b['Vector3']()['copy'](E)['multiplyScalar'](-0x1);F['setPosition'](G);let H=new b['Matrix4']()['copy'](q),I=new b['Matrix4']()['setPosition'](E),J=new b['Matrix4']()['multiplyMatrices'](H,F);t=new b['Matrix4']()['multiplyMatrices'](I,J);}{let K=new b['Matrix4']()['multiplyMatrices'](r,t),L=new b['Matrix4']()['multiplyMatrices'](s,K),M=new b['Vector3'](0x0,0x0,0x1),N=new b['Matrix4']()['copy'](L);N['setPosition'](new b['Vector3'](0x0,0x0,0x0)),M['applyMatrix4'](N);let O=Math['acos'](M['y']),P=h*Math['PI']/0xb4,Q=i*Math['PI']/0xb4;if(M['z']<0x0)O*=-0x1;if(O<P){m['x']=P-O+m['x'],c['CameraRotate'](m,n);return;}if(O>Q){m['x']=Q-O+m['x'],c['CameraRotate'](m,n);return;}}let u=new b['Matrix4']()['multiplyMatrices'](a['Camera']['cameraMatrix'],t);a['Camera']['cameraMatrix']=new b['Matrix4']()['multiplyMatrices'](s,u),a['Camera']['ResizeGLWindow'](),a['Avatar']['UpdateCamera']();}};function l(){for(let m=0x0;m<e;m++){for(let n=0x0;n<d[m]['object']['length'];n++){a['RenderWGL']['InitRenderPipeline'](d[m]['object'][n],![]);}}if(g>=0x0)a['SHWebSocket']['UpdatePlayerChatBoxPos'](d[g]['position']);}this['RenderPreprocessing']=function(){if(a['IsVIZWide3DProduct']()===![])return;if(c['ShowAvatar']===![])return;let m=a['Control']['GetMode']();if(m!==b['Enum']['CONTROL_STATE']['WALKTHROUGH'])return;if(g<0x0)return;l();let n=c['AvatarCurrentTime'];if(g>=0x0&&g<d['length']){let o=g;if(d[o]['visible']){if(d[o]['currentAnimationNum']>=0x0){let p=d[o]['animation'][d[o]['currentAnimationNum']],q=p['playAnimation'],r=p['lastAnimation'];if(q>=0x0)p['animationSecond']+=n;if(r>=0x0)p['lastAnimationSecond']+=n;}}}},this['Render']=function(){if(a['IsVIZWide3DProduct']()===![])return;if(c['ShowAvatar']===![])return;let m=a['Control']['GetMode']();if(m!==b['Enum']['CONTROL_STATE']['WALKTHROUGH'])return;if(g<0x0)return;l();let n=c['AvatarCurrentTime'];a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['ANIMATIONPBR']),a['Shader']['SetGLCameraData'](),a['Shader']['SetGLLight'](),a['gl']['enable'](a['gl']['BLEND']),a['gl']['enable'](a['gl']['DEPTH_TEST']);const o=new b['Matrix4']()['copy'](a['Camera']['matMV']),p=new b['Matrix4']()['copy'](a['Camera']['matMVP']);a['Shader']['SetMatrix'](p,o),a['Shader']['SetClipping'](undefined);if(g>=0x0&&g<d['length']){let q=g;a['Shader']['SetUpdateCurrentMatrixData']();if(d[q]['visible']){if(d[q]['currentAnimationNum']>=0x0){let r=d[q]['animation'][d[q]['currentAnimationNum']],s=r['playAnimation'],t=r['lastAnimation'];if(s>=0x0){let u=0x0,v=0x0;if(s>=0x0)u=r['animationSecond']/r['layer'][s]['step'];if(t>=0x0)v=r['lastAnimationSecond']/r['layer'][t]['step'];let w=[];for(let y=0x0;y<r['layer'][s]['data']['length'];y++){if(r['layer'][s]['data'][y]['transform']['length']>0x0){let z=Math['floor'](u)%Math['floor'](r['layer'][s]['data'][y]['transform']['length']);w['push'](new b['Matrix4']()['copy'](r['layer'][s]['data'][y]['transform'][z]));}else w['push'](new b['Matrix4']());}let x=0.5;if(r['animationSecond']<x&&t>=0x0){let A=r['animationSecond']/x;for(let B=0x0;B<r['layer'][t]['data']['length'];B++){let C=new b['Matrix4']();if(r['layer'][t]['data'][B]['transform']['length']>0x0){let F=Math['floor'](v)%Math['floor'](r['layer'][t]['data'][B]['transform']['length']);C['copy'](r['layer'][t]['data'][B]['transform'][F]);}let D=new b['Matrix4']()['copy'](w[B])['multiplyScalar'](A),E=C['multiplyScalar'](0x1-A);for(let G=0x0;G<0x10;G++){w[B]['elements'][G]=D['elements'][G]+E['elements'][G];}}}a['Shader']['SetUpdateCurrentMatrixData'](w);}}for(let H=0x0;H<d[q]['object']['length'];H++){a['RenderWGL']['UpdateRenderProcessByAnimationObject_v2'](d[q]['object'][H]);}}}a['gl']['disable'](a['gl']['BLEND']),a['gl']['depthMask'](!![]),a['gl']['disable'](a['gl']['BLEND']),a['gl']['disable'](a['gl']['DEPTH_TEST']),a['Shader']['EndShader'](),c['AvatarCurrentTime']=0x0;},this['PickRender']=function(){if(c['ShowAvatar']===![])return;let m=a['Control']['GetMode']();if(m!==b['Enum']['CONTROL_STATE']['WALKTHROUGH'])return;if(g<0x0)return;l(),a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['PICK']),a['Shader']['SetGLCameraData'](),a['gl']['enable'](a['gl']['BLEND']),a['gl']['enable'](a['gl']['DEPTH_TEST']);const n=new b['Matrix4']()['copy'](a['Camera']['matMV']),o=new b['Matrix4']()['copy'](a['Camera']['matMVP']);a['Shader']['SetMatrix'](o,n),a['Shader']['SetClipping'](undefined);if(g>=0x0&&g<d['length']){let p=g;a['Shader']['SetUpdateCurrentMatrixData']();if(d[p]['visible'])for(let q=0x0;q<d[p]['object']['length'];q++){a['RenderWGL']['UpdateRenderProcessByPickAnimationObject_v2'](d[p]['object'][q]);}}a['gl']['disable'](a['gl']['BLEND']),a['gl']['depthMask'](!![]),a['gl']['disable'](a['gl']['BLEND']),a['gl']['disable'](a['gl']['DEPTH_TEST']),a['Shader']['EndShader']();},this['OneColorRender']=function(m,n){if(c['ShowAvatar']===![])return;let o=a['Control']['GetMode']();if(o!==b['Enum']['CONTROL_STATE']['WALKTHROUGH'])return;if(g<0x0)return;if(m===undefined)m=b['Enum']['SHADER_TYPES']['ANIMATIONBASIC2D'];let p=new b['Matrix4']()['copy'](a['Camera']['matMVP']),q=new b['Matrix4']()['copy'](a['Camera']['matMV']);a['Shader']['BeginShader'](m),a['Shader']['SetGLCameraData'](),a['gl']['enable'](a['gl']['BLEND']),a['gl']['enable'](a['gl']['DEPTH_TEST']),a['Shader']['SetMatrix'](p,q),a['Shader']['SetClipping'](undefined);if(g>=0x0&&g<d['length']){let r=g;a['Shader']['SetUpdateCurrentMatrixData']();if(d[r]['visible']){if(d[r]['currentAnimationNum']>=0x0){let s=d[r]['animation'][d[r]['currentAnimationNum']],t=s['playAnimation'],u=s['lastAnimation'];if(t>=0x0){let v=0x0,w=0x0;if(t>=0x0)v=s['animationSecond']/s['layer'][t]['step'];if(u>=0x0)w=s['lastAnimationSecond']/s['layer'][u]['step'];let x=[];for(let z=0x0;z<s['layer'][t]['data']['length'];z++){if(s['layer'][t]['data'][z]['transform']['length']>0x0){let A=Math['floor'](v)%Math['floor'](s['layer'][t]['data'][z]['transform']['length']);x['push'](new b['Matrix4']()['copy'](s['layer'][t]['data'][z]['transform'][A]));}else x['push'](new b['Matrix4']());}let y=0.5;if(s['animationSecond']<y&&u>=0x0){let B=s['animationSecond']/y;for(let C=0x0;C<s['layer'][u]['data']['length'];C++){let D=new b['Matrix4']();if(s['layer'][u]['data'][C]['transform']['length']>0x0){let G=Math['floor'](w)%Math['floor'](s['layer'][u]['data'][C]['transform']['length']);D['copy'](s['layer'][u]['data'][C]['transform'][G]);}let E=new b['Matrix4']()['copy'](x[C])['multiplyScalar'](B),F=D['multiplyScalar'](0x1-B);for(let H=0x0;H<0x10;H++){x[C]['elements'][H]=E['elements'][H]+F['elements'][H];}}}a['Shader']['SetUpdateCurrentMatrixData'](x);}}for(let I=0x0;I<d[r]['object']['length'];I++){a['RenderWGL']['UpdateRenderProcessByAnimationObjectOneColor_v2'](d[r]['object'][I],n);}}}a['Shader']['EndShader'](),a['gl']['disable'](a['gl']['BLEND']),a['gl']['depthMask'](!![]),a['gl']['disable'](a['gl']['BLEND']),a['gl']['disable'](a['gl']['DEPTH_TEST']);},this['GLSLPreprocessing']=function(m,n){if(a['IsVIZWide3DProduct']()===![])return;{a['Shader']['BeginFramebuffer'](b['Enum']['FB_RENDER_TYPES']['AVATAROBJECT']),a['gl']['disable'](a['gl']['BLEND']),a['gl']['enable'](a['gl']['DEPTH_TEST']);m&&(a['gl']['clearColor'](0x0,0x0,0x0,0x0),a['gl']['clear'](a['gl']['COLOR_BUFFER_BIT']|a['gl']['DEPTH_BUFFER_BIT']));let o=new b['Color'](0xff,0xff,0xff,0xff),p=a['Renderer']['GetAvatarEdgeTypeEffect']();p==0x0&&c['OneColorRender'](b['Enum']['SHADER_TYPES']['ANIMATIONBASIC2D'],o);if(p==0x1){a['gl']['depthFunc'](a['gl']['LEQUAL']);let q=new b['Color'](0x0,0x0,0x0,0xff);a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['BASIC2D']),a['Shader']['SetGLCameraData']();for(let r=0x0;r<n;r++){a['RenderWGL']['UpdateRenderProcessByObjectOneColor_v3'](a['Data']['Objects'][r],q);}a['Shader']['EndShader']();{a['CustomObject']['OneColorRender'](b['Enum']['SHADER_TYPES']['BASIC2D'],q);}a['gl']['depthFunc'](a['gl']['GREATER']),c['OneColorRender'](b['Enum']['SHADER_TYPES']['ANIMATIONBASIC2D'],o),a['gl']['depthFunc'](a['gl']['LEQUAL']);}a['Shader']['EndFramebuffer']();}};}}export default Avatar;