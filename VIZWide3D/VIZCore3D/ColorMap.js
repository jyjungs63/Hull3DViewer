class ColorMap{constructor(a,b){let c=new Map(),d=0x100;this['ColorMapInfoItem']=function(){let n={'IDCount':0x0,'IDOffset':0x0,'IDColorMap':[],'ColorMapArray':[],'releaseList':new Set(),'referenceList':new Set()};return n;},this['triCountList']=[];let e=undefined,f=undefined,g=undefined,h=undefined,i=undefined,j=[],k=[],l=0x0;m();function m(){a['ColorMap']!==undefined&&(c['clear'](),c=new Map()),e=undefined,f=undefined,g=undefined,h=undefined,i=undefined,j=[],k=[],l=0x0,e===undefined&&(e=a['gl']['createTexture'](),a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],e),a['gl']['texImage2D'](a['gl']['TEXTURE_2D'],0x0,a['gl']['RGBA32F'],d,d,0x0,a['gl']['RGBA'],a['gl']['FLOAT'],null),a['gl']['texParameteri'](a['gl']['TEXTURE_2D'],a['gl']['TEXTURE_MIN_FILTER'],a['gl']['NEAREST']),a['gl']['texParameteri'](a['gl']['TEXTURE_2D'],a['gl']['TEXTURE_MAG_FILTER'],a['gl']['NEAREST']),a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],null));}this['GetColorMapWidth']=function(){return d;},this['SetColorMapWidth']=function(n){d=n;},this['GetColorMapTexture']=function(){return e;},this['SetColorMapTexture']=function(n){a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],e),a['gl']['texSubImage2D'](a['gl']['TEXTURE_2D'],0x0,0x0,0x0,d,d,a['gl']['RGBA'],a['gl']['FLOAT'],i['ColorMapArray'][n]),a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],null);},this['CheckColorMapArray']=function(n){(i['ColorMapArray'][n]===undefined||i['ColorMapArray'][n]['length']===0x0)&&(i['ColorMapArray'][n]=new Float32Array(0x4*d*d));},this['SetCurrentObject']=function(n){f=n;},this['SetCurrentBody']=function(n){g=n;},this['SetCurrentProcess']=function(n){h=n;},this['SetCurrentColorMapInfo']=function(n){let o=c['get'](n);o===undefined&&(o=new a['ColorMap']['ColorMapInfoItem'](),c['set'](n,o)),i=o;},this['SetColorMapArray_Body']=function(n){let o=new Set(),p=-0x1;for(let q=g['m_triIdx'];q<g['m_triIdx']+0x1;q=q+0x1){let r=f['attribs']['a_index']['array'][q];if(r<=p)continue;p=r;let s=f['attribs']['a_color']['array'][r<<0x2]+(f['attribs']['a_color']['array'][(r<<0x2)+0x1]<<0x8)+(f['attribs']['a_color']['array'][(r<<0x2)+0x2]<<0x10)+f['attribs']['a_color']['array'][(r<<0x2)+0x3]*0x1000000,t=i['IDColorMap'][f['mapId']]['get'](s);o['add'](t);}o['forEach'](u=>{let v=u*0x4;i['ColorMapArray'][f['mapId']][v]=n['r']/0xff,i['ColorMapArray'][f['mapId']][v+0x1]=n['g']/0xff,i['ColorMapArray'][f['mapId']][v+0x2]=n['b']/0xff,i['ColorMapArray'][f['mapId']][v+0x3]=n['a']/0xff;});},this['SetColorMapArray_Body_2']=function(n){let o=new Set(),p=-0x1;for(let q=g['m_triIdx'];q<g['m_triIdx']+0x1;q=q+0x1){let r=f['attribs']['a_index']['array'][q];if(r<=p)continue;p=r;let s=f['attribs']['a_color']['array'][r<<0x2]+(f['attribs']['a_color']['array'][(r<<0x2)+0x1]<<0x8)+(f['attribs']['a_color']['array'][(r<<0x2)+0x2]<<0x10)+f['attribs']['a_color']['array'][(r<<0x2)+0x3]*0x1000000,t=i['IDColorMap'][f['mapId']]['get'](s);o['add'](t);}o['forEach'](u=>{let v=u*0x4;if(n['r']===undefined)i['ColorMapArray'][f['mapId']][v+0x3]+=n/0xff;else i['ColorMapArray'][f['mapId']][v]+=n['r']/0xff,i['ColorMapArray'][f['mapId']][v+0x1]+=n['g']/0xff,i['ColorMapArray'][f['mapId']][v+0x2]+=n['b']/0xff,i['ColorMapArray'][f['mapId']][v+0x3]+=n['a']/0xff;});},this['SetColorMapArray_Pipeline']=function(n){let o=new Set(),p=-0x1,q=0x0,r=0x0;for(;r<a['ColorMap']['triCountList']['length'];r++){if(q===h['start'])break;q+=a['ColorMap']['triCountList'][r];}for(let s=h['start'];s<h['start']+h['length'];s=s+a['ColorMap']['triCountList'][r],r++){let t=f['attribs']['a_index']['array'][s];if(t<=p)continue;p=t;let u=f['attribs']['a_color']['array'][t<<0x2]+(f['attribs']['a_color']['array'][(t<<0x2)+0x1]<<0x8)+(f['attribs']['a_color']['array'][(t<<0x2)+0x2]<<0x10)+f['attribs']['a_color']['array'][(t<<0x2)+0x3]*0x1000000,v=i['IDColorMap'][f['mapId']]['get'](u);o['add'](v);}o['forEach'](w=>{let x=w*0x4;if(n['r']===undefined)i['ColorMapArray'][f['mapId']][x+0x3]=n/0xff;else i['ColorMapArray'][f['mapId']][x]=n['r']/0xff,i['ColorMapArray'][f['mapId']][x+0x1]=n['g']/0xff,i['ColorMapArray'][f['mapId']][x+0x2]=n['b']/0xff,i['ColorMapArray'][f['mapId']][x+0x3]=n['a']/0xff;});},this['SetColorMapArray_Pipeline_v2']=function(n){let o=new Set(),p=-0x1,q=0x0,r=0x0;for(;r<a['ColorMap']['triCountList']['length'];r++){if(q===h['start'])break;q+=a['ColorMap']['triCountList'][r];}for(let s=h['start'];s<h['start']+h['length'];s=s+a['ColorMap']['triCountList'][r],r++){let t=f['attribs']['a_index']['array'][s];if(t<=p)continue;p=t;let u=f['attribs']['a_color']['array'][t<<0x2]+(f['attribs']['a_color']['array'][(t<<0x2)+0x1]<<0x8)+(f['attribs']['a_color']['array'][(t<<0x2)+0x2]<<0x10)+f['attribs']['a_color']['array'][(t<<0x2)+0x3]*0x1000000,v=i['IDColorMap'][f['mapId']]['get'](u);o['add'](v);}o['forEach'](w=>{let x=w*0x4;if(n['r']===undefined)i['ColorMapArray'][f['mapId']][x+0x3]+=n/0xff;else i['ColorMapArray'][f['mapId']][x]+=n['r']/0xff,i['ColorMapArray'][f['mapId']][x+0x1]+=n['g']/0xff,i['ColorMapArray'][f['mapId']][x+0x2]+=n['b']/0xff,i['ColorMapArray'][f['mapId']][x+0x3]+=n['a']/0xff;});},this['GetColorMapArray_Pipeline']=function(){let n=new Set(),o=-0x1,p=0x0,q=0x0;for(;q<a['ColorMap']['triCountList']['length'];q++){if(p===h['start'])break;p+=a['ColorMap']['triCountList'][q];}for(let s=h['start'];s<h['start']+h['length'];s=s+a['ColorMap']['triCountList'][q],q++){let t=f['attribs']['a_index']['array'][s];if(t<=o)continue;o=t;let u=f['attribs']['a_color']['array'][t<<0x2]+(f['attribs']['a_color']['array'][(t<<0x2)+0x1]<<0x8)+(f['attribs']['a_color']['array'][(t<<0x2)+0x2]<<0x10)+f['attribs']['a_color']['array'][(t<<0x2)+0x3]*0x1000000,v=i['IDColorMap'][f['mapId']]['get'](u);n['add'](v);break;}let r;return n['forEach'](w=>{let x=w*0x4;r=[i['ColorMapArray'][f['mapId']][x],i['ColorMapArray'][f['mapId']][x+0x1],i['ColorMapArray'][f['mapId']][x+0x2],i['ColorMapArray'][f['mapId']][x+0x3]];}),r;},this['SetColorMapArray_Obj']=function(n){if(i['ColorMapArray'][n['mapId']]===undefined){i['ColorMapArray'][n['mapId']]=new Float32Array(0x4*d*d);let o=0x0;for(let p=0x0;p<n['tag']['length'];p++){let q=n['attribs']['a_color']['array'][o*0x4]+(n['attribs']['a_color']['array'][o*0x4+0x1]<<0x8)+(n['attribs']['a_color']['array'][o*0x4+0x2]<<0x10)+n['attribs']['a_color']['array'][o*0x4+0x3]*0x1000000,r=i['IDColorMap'][n['mapId']]['get'](q),s=r*0x4,t=n['tag'][p]['color'];i['ColorMapArray'][n['mapId']][s]=t['r']/0xff,i['ColorMapArray'][n['mapId']][s+0x1]=t['g']/0xff,i['ColorMapArray'][n['mapId']][s+0x2]=t['b']/0xff,i['ColorMapArray'][n['mapId']][s+0x3]=t['a']/0xff,o=o+n['tag'][p]['m_nVtx']/0x3;}}},this['InitList']=function(){for(let [n,o]of c){o['releaseList']=new Set(),o['referenceList']=new Set();}},this['AddReleaseList']=function(n){let o=c['get'](n['id_file']);o['releaseList']['add'](n['mapId']);},this['AddReferenceList']=function(n){let o=c['get'](n['id_file']);o['referenceList']['add'](n['mapId']);},this['ReleaseColorMap']=function(){for(let [n,o]of c){let p=new Set();o['releaseList']['forEach'](q=>{!o['referenceList']['has'](q)&&o['ColorMapArray'][q]!==undefined&&p['add'](q);});if(p['size']>0x0)for(let q of p){o['ColorMapArray'][q]=undefined;}}},this['ReleaseIDColorMap']=function(n){let o=c['get'](n['id_file']),p=new Set();for(let q=0x0;q<n['attribs']['a_tInd']['array']['length'];q=q+0x1){p['add'](n['attribs']['a_tInd']['array'][q]);}for(let r of p){for(let [s,t]of o['IDColorMap'][n['mapId']]){if(t===r)o['IDColorMap'][n['mapId']]['delete'](s);}}},this['ClearProcess']=function(n){if(n===undefined)m();else for(let o=0x0;o<n['length'];o++){let p=c['get'](n[o]['Key']);p!==undefined&&(p=undefined),c['delete'](n[o]['Key']);}},this['InitLoad']=function(){j=[],k=[],l=0x0;},this['LoadAndSetColorMap']=function(n,o,p){const q=d*d;let r=n['m_nVtx']/0x3;j['push'](r);let s=Math['floor']((i['IDCount']+i['IDOffset'])/q);if(i['IDColorMap'][s]===undefined){i['IDColorMap']['push'](new Map());let v=0x0;if(o['mapId']!=s){for(let w=q-p,x=0x0;w<q;w++,x++){for(let [y,z]of i['IDColorMap'][s-0x1]['entries']()){if(z===w){i['IDColorMap'][s]['set'](y,x);for(let A=0x0;A<j[x];A++,v++){k[v]=x;}}}}i['IDOffset']=i['IDOffset']+p;}}let t=(i['IDCount']+i['IDOffset'])%q;for(let B=0x0;B<r;B=B+0x1){k[l+B]=t;}o['mapId']=s;let u=i['IDColorMap'][s]['get'](n['colorIdx']);u===undefined&&(i['IDColorMap'][s]['set'](n['colorIdx'],t),i['IDCount']++),l+=r;},this['ReLoadAndSetColorMap']=function(n,o){let p=n['m_nVtx']/0x3;for(let q=0x0;q<i['IDColorMap']['length'];q++){let r=i['IDColorMap'][q]['get'](n['colorIdx']);if(r!==undefined){o['mapId']=q;for(let s=0x0;s<p;s=s+0x1){k[l+s]=r;}}}l+=p;},this['GentIndArray']=function(){return new Uint32Array(k,0x0,l);};}}export default ColorMap;