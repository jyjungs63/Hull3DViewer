let UIMarkup_Measure_SurfaceDistance=function(a,b,c){let d=this;this['base']=c['UIMarkup_Base'],this['base'](a,b);let e=-0x1,f=undefined,g=new c['BBox'](),h=new c['Vector3'](),i=undefined,j=0.07;this['Start']=function(){let k='MG0004';b['UIManager']['ShowMessage'](k),d['base']['prototype']['Start']['call'](d);},this['Release']=function(){e=-0x1,f=undefined,i=undefined,d['base']['prototype']['Release']['call'](d);},this['SetSubType']=function(k){d['MarkupSubType']=k,d['MarkupSubType']===0x0?j=undefined:j=0.99;},this['PreviousStep']=function(){switch(a['GetStep']()){case 0x1:{b['Data']['DeleteReview'](a['currentReviewItem']['id']),b['Renderer']['Render'](),d['mouseAction']=!![];}break;}},this['ProcessStep']=function(k){switch(a['GetStep']()){case 0x0:{if(k===undefined)return;if(!k['pick'])return;if(!k['surface'])return;a['currentReviewItem']['drawitem']['position'][0x0]=k['position'],h=k['normal'];let l=b['Data']['GetTriangles']([k['body']],![]);if(d['MarkupSubType']===0x0)f=b['Data']['GetSurfaceTriangles'](k['triangle'],l);else{if(d['MarkupSubType']===0x1)f=b['Data']['GetSurfaceTriangles'](k['triangle'],l,j);else{if(d['MarkupSubType']===0x2)f=b['Data']['GetSurfaceTriangles'](k['triangle'],l,j);}}g=b['Util']['GetTrianglesBBox'](f),e=k['body']['bodyId'],b['Renderer']['Render'](),a['NextStep']();}break;case 0x1:{if(k===undefined)return;if(!k['pick'])return;if(!k['surface'])return;if(d['MarkupSubType']===0x0){let n=k['normal']['dot'](h);if(Math['abs'](n)>0.999){let o=new c['Plane']()['setFromNormalAndCoplanarPoint'](h,a['currentReviewItem']['drawitem']['position'][0x0]),p=o['distanceToPoint'](k['position']),q=new c['Vector3']()['addVectors'](a['currentReviewItem']['drawitem']['position'][0x0],new c['Vector3']()['copy'](h)['multiplyScalar'](p));a['currentReviewItem']['drawitem']['position'][0x1]=q;}else{let r=b['Data']['GetTriangles']([k['body']],![]);i=b['Data']['GetSurfaceTriangles'](k['triangle'],r);let s=new c['Vector3'](),t=new c['Vector3']();b['Data']['GetMinDistanceByTriangles'](f,i,s,t),a['currentReviewItem']['drawitem']['position'][0x0]=s,a['currentReviewItem']['drawitem']['position'][0x1]=t;}}else{if(d['MarkupSubType']===0x1){let u=b['Data']['GetTriangles']([k['body']],![]);i=b['Data']['GetSurfaceTriangles'](k['triangle'],u,j);let v=new c['Vector3'](),w=new c['Vector3']();b['Data']['GetMinDistanceByTriangles'](f,i,v,w),a['currentReviewItem']['drawitem']['position'][0x0]=v,a['currentReviewItem']['drawitem']['position'][0x1]=w;}else{if(d['MarkupSubType']===0x2){let x=new c['Vector3']();b['Data']['GetMinDistancePosByTriangles'](f,k['position'],x),a['currentReviewItem']['drawitem']['position'][0x0]=x,a['currentReviewItem']['drawitem']['position'][0x1]=k['position'];}}}let m=[a['currentReviewItem']['drawitem']['position'][0x0],a['currentReviewItem']['drawitem']['position'][0x1]];a['currentReviewItem']['itemType']=c['Enum']['REVIEW_TYPES']['RK_MEASURE_SURFACEDISTANCE'],b['Measure']['UpdateReviewStyle'](a['currentReviewItem']),b['Measure']['UpdateReviewText'](a['currentReviewItem'],m),a['currentReviewItem']['text']['position']=new c['Vector3']()['copy'](k['position']),b['Data']['Reviews']['push'](a['currentReviewItem']),b['Renderer']['Render'](),a['NextStep']();}break;case 0x2:{a['currentReviewItem']=undefined,b['Control']['RestoreMode'](),b['Renderer']['Render']();}break;}},this['mouseDown']=function(k,l,m){switch(a['GetStep']()){case 0x2:{d['mouseAction']=![],a['actionEnabled']=![];}break;}return a['base']['prototype']['mouseDown']['call'](a,k,l,m),a['actionEnabled']=!![],!![];},this['mouseMove']=function(k,l){a['base']['prototype']['mouseMove']['call'](a,k,l);switch(a['GetStep']()){case 0x2:{let m=new c['Matrix4']()['multiplyMatrices'](b['Camera']['projectionMatrix'],b['Camera']['cameraMatrix']),n=b['Camera']['world2ScreenWithMatrix'](m,new c['Vector3']()['copy'](a['currentReviewItem']['text']['position'])),o=b['Camera']['screen2WorldWithMatrix'](m,new c['Vector3'](k,l,n['z']));a['currentReviewItem']['text']['position']['copy'](o),b['Renderer']['Render']();}break;}},this['mouseUp']=function(k,l,m){a['actionEnabled']=![],a['base']['prototype']['mouseUp']['call'](a,k,l,m),a['actionEnabled']=!![];if(m===0x0&&a['GetMouseClick'](a['mouse']['x'],a['mouse']['y']))switch(a['GetStep']()){case 0x0:{let n=b['Renderer']['Picking'](a['mouse']['x'],a['mouse']['y']);n!==undefined&&(b['Data']['GetPickByBodyCacheDownload'](a['mouse']['x'],a['mouse']['y'],d['ProcessStep']),d['mouseAction']=![]);}break;case 0x1:{let o=b['Renderer']['Picking'](a['mouse']['x'],a['mouse']['y']);o!==undefined&&(b['Pick']['MakeMeasurePreselectInfoByID'](o['bodyId']),b['Data']['GetPickByBodyCacheDownload'](a['mouse']['x'],a['mouse']['y'],d['ProcessStep']),d['mouseAction']=![]);}break;case 0x2:{d['ProcessStep']();}break;}else b['MeshBlock']['Reset']();return d['mouseAction'];},this['mouseWheel']=function(k,l,m){a['GetStep']()!==0x2&&a['base']['prototype']['mouseWheel']['call'](a,k,l,m);},this['touchStart']=function(k){switch(k['length']){case 0x1:{d['GetProcessFlag'](c['Enum']['MARKUP_FLAG']['ROTATE'])===![]&&(d['mouseAction']=![],a['actionEnabled']=![]);}break;case 0x2:d['GetProcessFlag'](c['Enum']['MARKUP_FLAG']['ROTATE'])===![]&&(d['mouseAction']=![],a['actionEnabled']=![]);break;}a['base']['prototype']['touchStart']['call'](a,k),a['actionEnabled']=![],a['base']['prototype']['mouseDown']['call'](a,a['mouse']['x'],a['mouse']['y'],0x0),a['actionEnabled']=!![];},this['touchMove']=function(k){if(k['length']===0x0)return;a['base']['prototype']['touchMove']['call'](a,k),a['actionEnabled']=![],d['mouseMove'](a['mouse']['x'],a['mouse']['y']),a['actionEnabled']=!![];},this['touchEnd']=function(k){a['_touchLastCount']===0x1&&d['mouseUp'](a['mouse']['x'],a['mouse']['y'],0x0),a['actionEnabled']=![],a['base']['prototype']['touchEnd']['call'](a,k),a['actionEnabled']=!![];},this['Render']=function(){switch(a['GetStep']()){case 0x1:{let k=new c['Color'](0x64,0xff,0x0,0xff),l=new c['Color'](0x64,0xc8,0x0,0xff);b['Shader']['BeginShader'](c['Enum']['SHADER_TYPES']['PHONG']),b['Shader']['SetGLLight'](),b['Shader']['SetClipping'](undefined),b['gl']['enable'](b['gl']['DEPTH_TEST']),b['RenderWGL']['UpdateRenderProcessByTriangles'](f,k),b['Shader']['EndShader'](),b['gl']['disable'](b['gl']['DEPTH_TEST']);{b['Shader']['BeginShader'](c['Enum']['SHADER_TYPES']['BASIC2D']),b['Shader']['SetMatrix'](b['Camera']['matMVP'],b['Camera']['matMV']),b['Shader']['SetClipping'](undefined);let m=l,n=m['glColor']();b['Shader']['SetGLColor'](n['r'],n['g'],n['b'],n['a']);let o=[[0x0,0x4,0x4,0x5,0x5,0x1,0x1,0x0],[0x2,0x6,0x6,0x7,0x7,0x3,0x3,0x2],[0x0,0x2],[0x4,0x6],[0x1,0x3],[0x5,0x7]],p=b['Util']['GetBBox2Vertex'](g),q=b['gl']['createBuffer'](),r=[];b['gl']['bindBuffer'](b['gl']['ARRAY_BUFFER'],q),b['gl']['vertexAttribPointer'](b['Shader']['positionAttributeLocation'],0x3,b['gl']['FLOAT'],![],0x0,0x0);{let s=0x0;for(let t=0x0;t<o['length'];t++){for(let u=0x0;u<o[t]['length'];u++){r[s]=p[o[t][u]]['x'],s++,r[s]=p[o[t][u]]['y'],s++,r[s]=p[o[t][u]]['z'],s++;}}}b['gl']['bufferData'](b['gl']['ARRAY_BUFFER'],new Float32Array(r),b['gl']['STATIC_DRAW']),b['gl']['drawArrays'](b['gl']['LINES'],0x0,r['length']),b['gl']['deleteBuffer'](q);}b['Shader']['EndShader']();}break;}},this['Render2D']=function(k){const l=new c['Matrix4']()['copy'](b['Camera']['matMV']),m=new c['Matrix4']()['copy'](b['Camera']['matMVP']);switch(a['GetStep']()){case 0x0:break;case 0x1:{let n=0x3;k['fillStyle']='rgba(0,\x20255,\x200,\x201)';let o=b['Renderer']['Util']['GetScreenPositionByMatrix'](m,a['currentReviewItem']['drawitem']['position'][0x0]);k['beginPath'](),k['arc'](o['x'],o['y'],n,0x0,Math['PI']*0x2),k['fill']();}break;case 0x2:break;default:break;}};};export default UIMarkup_Measure_SurfaceDistance;