let UIMarkup_Sketch=function(a,b,c){let d=this;this['base']=c['UIMarkup_Base'],this['base'](a,b),this['SketchItem']=function(){let i={'subType':0x0,'position':[],'textarea':null};return i;};function e(i){}function f(j){let k,l=j['style']['font']['size']+'pt\x20'+j['style']['font']['face'];b['ctx_review']['font']=l;for(let m=0x0;m<j['text']['value']['length'];m++){let n=b['ctx_review']['measureText'](j['text']['value'][m]);if(m===0x0)k=n;else{if(k['width']<n['width'])k=n;}}return j['text']['value']['length']>0x0&&(k['height']=j['style']['font']['size']*1.5,k['ascent']=j['style']['font']['size']+j['style']['font']['size']*0.1),k;}function g(j){if(j['keyCode']===0x1b){let k=a['currentReviewItem']['drawitem']['custom']['textarea']['value'],l=k['split'](/(?:\r\n|\r|\n)/g);for(let m=0x0;m<l['length'];m++){a['currentReviewItem']['text']['value'][m]=l[m];}a['currentReviewItem']['text']['position']=a['currentReviewItem']['drawitem']['custom']['position'][0x0],document['body']['removeChild'](a['currentReviewItem']['drawitem']['custom']['textarea']),h();}else{let n=a['currentReviewItem']['drawitem']['custom']['textarea']['value'],o=n['split'](/(?:\r\n|\r|\n)/g);for(let t=0x0;t<o['length'];t++){a['currentReviewItem']['text']['value'][t]=o[t];}let p=a['currentReviewItem']['drawitem']['custom']['textarea'];const q=f(a['currentReviewItem']);let r=q['width']+0xa;if(r<0x64)r=0x64;p['style']['width']=r+'px';let s=a['currentReviewItem']['text']['value']['length']*q['height'];if(s<0x64)s=0x64;p['style']['height']=s+'px';}}function h(){b['Renderer']['Render'](),b['Data']['Reviews']['push'](a['currentReviewItem']),a['PreviousStep']();let i=d['MarkupSubType'];b['Review']['SetSketchMode'](!![]),b['Control']['SetSubType'](i);}this['Start']=function(){let i='';b['UIManager']['ShowMessage'](i),d['base']['prototype']['Start']['call'](d);{a['currentReviewItem']['itemType']=c['Enum']['REVIEW_TYPES']['RK_SKETCH'],a['currentReviewItem']['drawitem']['custom']=d['SketchItem'](),b['Measure']['UpdateReviewStyle'](a['currentReviewItem']);}},this['Release']=function(){d['base']['prototype']['Release']['call'](d);},this['PreviousStep']=function(){},this['ProcessStep']=function(i){switch(a['GetStep']()){case 0x0:{if(i===undefined)return;}break;case 0x1:{if(i===undefined)return;}break;case 0x2:{if(i===undefined)return;}break;case 0x3:{}break;}},this['mouseDown']=function(i,j,k){a['actionEnabled']=![],a['currentReviewItem']['drawitem']['custom']['subType']=d['MarkupSubType'],a['base']['prototype']['mouseDown']['call'](a,i,j,k),a['actionEnabled']=!![],a['currentReviewItem']['style']['line']['color']=b['Configuration']['Markup']['LineColor'],a['currentReviewItem']['style']['line']['thickness']=b['Configuration']['Markup']['LineWidth'];let l=b['Camera']['screen2WorldWithMatrix'](b['Camera']['matMVP'],new c['Vector3'](i,j,0x0));switch(d['MarkupSubType']){case c['Enum']['SKETCH_TYPES']['FREE']:{a['currentReviewItem']['drawitem']['custom']['position']['push'](new c['Vector3']()['copy'](l)),a['NextStep']();}break;case c['Enum']['SKETCH_TYPES']['LINE']:case c['Enum']['SKETCH_TYPES']['CIRCLE']:case c['Enum']['SKETCH_TYPES']['RECT']:{a['currentReviewItem']['drawitem']['custom']['position']['push'](new c['Vector3']()['copy'](l)),a['currentReviewItem']['drawitem']['custom']['position']['push'](new c['Vector3']()['copy'](l)),a['NextStep']();}break;case c['Enum']['SKETCH_TYPES']['TEXT']:{a['currentReviewItem']['drawitem']['custom']['position']['push'](new c['Vector3']()['copy'](l)),a['NextStep']();}break;}return!![];},this['mouseMove']=function(i,j){a['base']['prototype']['mouseMove']['call'](a,i,j);let k=b['Camera']['screen2WorldWithMatrix'](b['Camera']['matMVP'],new c['Vector3'](i,j,0x0));switch(d['MarkupSubType']){case c['Enum']['SKETCH_TYPES']['FREE']:{let l=a['GetStep']();l===0x1&&(a['currentReviewItem']['drawitem']['custom']['position']['push'](new c['Vector3']()['copy'](k)),b['Renderer']['Render']());}break;case c['Enum']['SKETCH_TYPES']['LINE']:case c['Enum']['SKETCH_TYPES']['CIRCLE']:case c['Enum']['SKETCH_TYPES']['RECT']:{let m=a['GetStep']();m===0x1&&(a['currentReviewItem']['drawitem']['custom']['position'][0x1]=new c['Vector3']()['copy'](k),b['Renderer']['Render']());}break;}},this['mouseUp']=function(k,l,m){a['actionEnabled']=![],a['base']['prototype']['mouseUp']['call'](a,k,l,m),a['actionEnabled']=!![];const n=new c['Matrix4']()['copy'](b['Camera']['matMVP']);let o=b['Camera']['screen2WorldWithMatrix'](n,new c['Vector3'](k,l,0x0));switch(d['MarkupSubType']){case c['Enum']['SKETCH_TYPES']['NONE']:{if(!a['GetMouseClick'](k,l))break;let p=new c['Vector3'](k,l,0x0),q=0xa;for(let s=0x0;s<b['Data']['Reviews']['length'];s++){let t=b['Data']['Reviews'][s];if(!t['visible'])continue;if(t['itemType']!==c['Enum']['REVIEW_TYPES']['RK_SKETCH'])continue;if(!t['drawitem']['custom'])continue;let u=t['style']['line']['thickness']+q,v=![];switch(t['drawitem']['custom']['subType']){case c['Enum']['SKETCH_TYPES']['FREE']:{for(let w=0x1;w<t['drawitem']['custom']['position']['length'];w++){let z=t['drawitem']['custom']['position'][w-0x1],A=t['drawitem']['custom']['position'][w],B=b['Camera']['world2ScreenWithMatrix'](n,new c['Vector3']()['copy'](z)),C=b['Camera']['world2ScreenWithMatrix'](n,new c['Vector3']()['copy'](A));B['z']=0x0,C['z']=0x0;let D=new c['Vector3'](),E=b['Util']['Point2LineDistance'](p,B,C,D);if(E>u)continue;v=!![];break;}}break;case c['Enum']['SKETCH_TYPES']['LINE']:{for(let F=0x1;F<t['drawitem']['custom']['position']['length'];F++){let G=t['drawitem']['custom']['position'][F-0x1],H=t['drawitem']['custom']['position'][F],I=b['Camera']['world2ScreenWithMatrix'](n,new c['Vector3']()['copy'](G)),J=b['Camera']['world2ScreenWithMatrix'](n,new c['Vector3']()['copy'](H));I['z']=0x0,J['z']=0x0;let K=new c['Vector3'](),L=b['Util']['Point2LineDistance'](p,I,J,K);if(L>u)continue;v=!![];break;}}break;case c['Enum']['SKETCH_TYPES']['CIRCLE']:{let M=t['drawitem']['custom']['position'][0x0],N=t['drawitem']['custom']['position'][0x1],O=b['Camera']['world2ScreenWithMatrix'](n,new c['Vector3']()['copy'](M)),P=b['Camera']['world2ScreenWithMatrix'](n,new c['Vector3']()['copy'](N));O['z']=0x0,P['z']=0x0;let Q=new c['Vector2']((O['x']+P['x'])/0x2,(O['y']+P['y'])/0x2),R=new c['Vector2']()['subVectors'](O,P)['length']()/0x2,S=0x0,T=0x168,U=b['MeshProcess']['Get2DCircleVertices'](Q,R,R,S,T);for(let V=0x1;V<U['vertices']['length'];V++){let W=U['vertices'][V-0x1],X=U['vertices'][V],Y=new c['Vector3'](),Z=b['Util']['Point2LineDistance'](p,W,X,Y);if(Z>u)continue;v=!![];break;}}break;case c['Enum']['SKETCH_TYPES']['RECT']:{let a0=t['drawitem']['custom']['position'][0x0],a1=t['drawitem']['custom']['position'][0x1],a2=b['Camera']['world2ScreenWithMatrix'](n,new c['Vector3']()['copy'](a0)),a3=b['Camera']['world2ScreenWithMatrix'](n,new c['Vector3']()['copy'](a1)),a4=new c['Vector3'](a2['x'],a2['y'],0x0),a5=new c['Vector3'](a2['x'],a3['y'],0x0),a6=new c['Vector3'](a3['x'],a2['y'],0x0),a7=new c['Vector3'](a3['x'],a3['y'],0x0),a8=new c['Vector3']();{let a9=b['Util']['Point2LineDistance'](p,a4,a5,a8);if(a9<u){v=!![];break;}}{let aa=b['Util']['Point2LineDistance'](p,a4,a6,a8);if(aa<u){v=!![];break;}}{let ab=b['Util']['Point2LineDistance'](p,a6,a7,a8);if(ab<u){v=!![];break;}}{let ac=b['Util']['Point2LineDistance'](p,a5,a7,a8);if(ac<u){v=!![];break;}}}break;case c['Enum']['SKETCH_TYPES']['TEXT']:{for(let ad=0x0;ad<t['rect']['length'];ad++){let ae=t['rect'][ad];if(ae['isPointInRect'](k,l)===![])continue;v=!![];break;}}break;}if(!v)continue;t['selection']=!t['selection'],b['Renderer']['Render']();}}break;case c['Enum']['SKETCH_TYPES']['FREE']:{let af=a['GetStep']();af===0x1&&(a['currentReviewItem']['drawitem']['custom']['position']['push'](new c['Vector3']()['copy'](o)),h());}break;case c['Enum']['SKETCH_TYPES']['LINE']:case c['Enum']['SKETCH_TYPES']['CIRCLE']:case c['Enum']['SKETCH_TYPES']['RECT']:{let ag=a['GetStep']();ag===0x1&&(a['currentReviewItem']['drawitem']['custom']['position'][0x1]=new c['Vector3']()['copy'](o),h());}break;case c['Enum']['SKETCH_TYPES']['TEXT']:{let ah=a['GetStep']();if(ah===0x1){let ai=b['Camera']['screen2WorldWithMatrix'](n,new c['Vector3'](k+0x64,l+0x64,0x0));a['currentReviewItem']['drawitem']['custom']['position'][0x1]=new c['Vector3']()['copy'](ai);}if(!a['currentReviewItem']['drawitem']['custom']['textarea']){a['currentReviewItem']['drawitem']['custom']['position'][0x1]=new c['Vector3']()['copy'](o);let aj=document['createElement']('textarea');aj['className']='sketch_textarea',aj['addEventListener']('mousedown',e),aj['addEventListener']('keydown',g),document['body']['appendChild'](aj),a['currentReviewItem']['drawitem']['custom']['textarea']=aj;let ak=a['currentReviewItem']['drawitem']['custom']['position'][0x0],al=b['Camera']['world2ScreenWithMatrix'](n,new c['Vector3']()['copy'](ak));aj['style']['top']=al['y']+'px',aj['style']['left']=al['x']+'px',aj['style']['width']='100px',aj['style']['height']='100px',aj['style']['background']='transparent',aj['style']['border']='solid\x201px',aj['style']['fontSize']=a['currentReviewItem']['style']['font']['size']+0x4+'px',aj['style']['fontFamily']=a['currentReviewItem']['style']['font']['face']+'';}}break;}return d['mouseAction'];},this['mouseWheel']=function(i,j,k){},this['keyUp']=function(j){if(d['MarkupSubType']===c['Enum']['SKETCH_TYPES']['NONE']){if(j===0x2e){for(let k=b['Data']['Reviews']['length']-0x1;k>=0x0;k--){let l=b['Data']['Reviews'][k];if(l['itemType']!==c['Enum']['REVIEW_TYPES']['RK_SKETCH'])continue;if(!l['selection'])continue;b['Data']['Review']['DeleteReview'](l['id']);}b['Renderer']['Render']();}}return!![];},this['mouseDoubleClick']=function(i,j,k){},this['Render2D']=function(j){j['fillStyle']='rgba('+b['Configuration']['Markup']['LineColor']['r']+','+b['Configuration']['Markup']['LineColor']['g']+','+b['Configuration']['Markup']['LineColor']['b']+','+b['Configuration']['Markup']['LineColor']['glAlpha']()+')',j['strokeStyle']='rgba('+b['Configuration']['Markup']['LineColor']['r']+','+b['Configuration']['Markup']['LineColor']['g']+','+b['Configuration']['Markup']['LineColor']['b']+','+b['Configuration']['Markup']['LineColor']['glAlpha']()+')',j['lineWidth']=b['Configuration']['Markup']['LineWidth'];switch(d['MarkupSubType']){case c['Enum']['SKETCH_TYPES']['FREE']:{let k=a['GetStep']();if(k!==0x0){j['beginPath']();for(let l=0x0;l<a['currentReviewItem']['drawitem']['custom']['position']['length'];l++){if(l===0x0)continue;let m=a['currentReviewItem']['drawitem']['custom']['position'][l-0x1],n=a['currentReviewItem']['drawitem']['custom']['position'][l],o=b['Camera']['world2ScreenWithMatrix'](b['Camera']['matMVP'],new c['Vector3']()['copy'](m)),p=b['Camera']['world2ScreenWithMatrix'](b['Camera']['matMVP'],new c['Vector3']()['copy'](n));j['moveTo'](o['x'],o['y']),j['lineTo'](p['x'],p['y']);}j['stroke']();}}break;case c['Enum']['SKETCH_TYPES']['LINE']:{let q=a['GetStep']();if(q!==0x0){let r=a['currentReviewItem']['drawitem']['custom']['position'][0x0],s=a['currentReviewItem']['drawitem']['custom']['position'][0x1],t=b['Camera']['world2ScreenWithMatrix'](b['Camera']['matMVP'],new c['Vector3']()['copy'](r)),u=b['Camera']['world2ScreenWithMatrix'](b['Camera']['matMVP'],new c['Vector3']()['copy'](s));j['beginPath'](),j['moveTo'](t['x'],t['y']),j['lineTo'](u['x'],u['y']),j['stroke']();}}break;case c['Enum']['SKETCH_TYPES']['CIRCLE']:{let v=a['GetStep']();if(v!==0x0){let w=a['currentReviewItem']['drawitem']['custom']['position'][0x0],x=a['currentReviewItem']['drawitem']['custom']['position'][0x1],y=b['Camera']['world2ScreenWithMatrix'](b['Camera']['matMVP'],new c['Vector3']()['copy'](w)),z=b['Camera']['world2ScreenWithMatrix'](b['Camera']['matMVP'],new c['Vector3']()['copy'](x)),A=0x0,B=0x2*Math['PI'],C=new c['Vector2']((y['x']+z['x'])/0x2,(y['y']+z['y'])/0x2),D=new c['Vector2']()['subVectors'](y,z),E=Math['abs'](D['length']()/0x2);j['beginPath'](),j['arc'](C['x'],C['y'],E,A,B,!![]),j['stroke']();}}break;case c['Enum']['SKETCH_TYPES']['RECT']:{let F=a['GetStep']();if(F!==0x0){let G=a['currentReviewItem']['drawitem']['custom']['position'][0x0],H=a['currentReviewItem']['drawitem']['custom']['position'][0x1],I=b['Camera']['world2ScreenWithMatrix'](b['Camera']['matMVP'],new c['Vector3']()['copy'](G)),J=b['Camera']['world2ScreenWithMatrix'](b['Camera']['matMVP'],new c['Vector3']()['copy'](H)),K=J['x']-I['x'],L=J['y']-I['y'];j['beginPath'](),j['rect'](I['x'],I['y'],K,L),j['stroke']();}}break;case c['Enum']['SKETCH_TYPES']['TEXT']:{}break;}},this['GetProcessFlag']=function(i){return![];},this['touchStart']=function(i){let j=document['getElementById'](b['GetViewID']())['getBoundingClientRect'](),k=new c['Vector2'](i[0x0]['pageX']-j['left'],i[0x0]['pageY']-j['top']);d['mouseDown'](k['x'],k['y'],0x0);},this['touchMove']=function(i){let j=document['getElementById'](b['GetViewID']())['getBoundingClientRect'](),k=new c['Vector2'](i[0x0]['pageX']-j['left'],i[0x0]['pageY']-j['top']);d['mouseMove'](k['x'],k['y'],0x0);},this['touchEnd']=function(i){d['mouseUp'](d['uiBase']['mouse']['x'],d['uiBase']['mouse']['y'],0x0);};};export default UIMarkup_Sketch;