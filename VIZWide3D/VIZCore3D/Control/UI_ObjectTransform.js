let UIObjectTransform=function(a,b){let c=this;this['base']=b['UIBase'],this['base'](a,b);let d=undefined,e=!![],f=!![],g=[],h=[],i=new b['Vector3']();j();function j(){}this['UIBegin']=function(){c['base']['prototype']['UIBegin']['call'](c);let k='MG0012';a['UIManager']['ShowMessage'](k);{let l=a['Data']['GetBBox'](),m=l['center'];d=a['Handle']['Add'](b['Enum']['HANDLER_TYPE']['MODEL']),d['center']=m,d['object']=undefined,d['axis']['x']['enable']=!![],d['axis']['y']['enable']=!![],d['axis']['z']['enable']=!![],d['panel']['xy']['enable']=!![],d['panel']['yz']['enable']=!![],d['panel']['zx']['enable']=!![],d['rotate']['x']['enable']=!![],d['rotate']['y']['enable']=!![],d['rotate']['z']['enable']=!![],d['sphere']['enable']=![],d['axis']['x']['visible']=!![],d['axis']['y']['visible']=!![],d['axis']['z']['visible']=!![],d['panel']['xy']['visible']=!![],d['panel']['yz']['visible']=!![],d['panel']['zx']['visible']=!![],d['rotate']['x']['visible']=!![],d['rotate']['y']['visible']=!![],d['rotate']['z']['visible']=!![],d['sphere']['visible']=!![];}c['SetSelectObjectHandler']();},this['UIEnd']=function(){a['UIManager']['HideMessage'](),d!==undefined&&(a['Handle']['ClearStateById'](d['id']),a['Handle']['Delete'](d['id']),d=undefined),c['base']['prototype']['UIEnd']['call'](c),g=[],h=[];},this['SetSelectObjectHandler']=function(){if(d===undefined)return;g=[],h=[],d['object']=undefined;let k=!![],l=new b['BBox']();if(e){if(a['useTree']){let m=a['Data']['GetSelection']();for(let n=0x0;n<m['length'];n++){h['push'](m[n]);}l=a['Tree']['GetBBoxArrayID'](m);if(h['length']>0x0&&l['radius']!==0x0)k=![];}else{let o=a['Data']['GetSelection'](),p=a['Data']['GetBodies'](o);if(p['length']>0x0){let q=a['Data']['GetBBoxFormMatrix'](p);k?(l['min']['copy'](q['min']),l['max']['copy'](q['max']),k=![]):(l['min']['min'](q['min']),l['min']['min'](q['max']),l['max']['min'](q['min']),l['max']['max'](q['max']));}for(let r=0x0;r<p['length'];r++){g['push'](p[r]);}}}if(f){let s=a['CustomObject']['GetSelection']();if(s['length']>0x0)for(let t=0x0;t<s['length'];t++){let u=a['CustomObject']['GetBodyFormObject'](s[t]),v=a['Data']['GetBBoxFormMatrix'](u);k?(l['min']['copy'](v['min']),l['max']['copy'](v['max']),k=![]):(l['min']['min'](v['min']),l['min']['min'](v['max']),l['max']['min'](v['min']),l['max']['max'](v['max']));for(let w=0x0;w<u['length'];w++){g['push'](u[w]);}}}d!==undefined&&(!k?(d['object']=null,l['update'](),d['center']=l['center']):d['object']=undefined);},this['mouseDown']=function(k,l,m){d!==undefined&&(d['enable']&&d['state']===b['Enum']['HANDLE_MOUSE_STATE']['OVER']&&(d['state']=b['Enum']['HANDLE_MOUSE_STATE']['DOWN'],c['actionEnabled']=![],i['set'](0x0,0x0,0x0),a['Handle']['ReleaseInterval']()));if(a['IsUseProgressive']())a['Renderer']['enableRenderLimit']=!![];let n=c['base']['prototype']['mouseDown']['call'](c,k,l,m);return n;},this['mouseMove']=function(k,l){let m=a['Handle']['Handler']();if(m['length']>0x0){const n=new b['Matrix4']()['copy'](a['Camera']['matMVP']);if(d!==undefined&&d['state']===b['Enum']['HANDLE_MOUSE_STATE']['DOWN']){c['actionEnabled']=![];if(k!==c['mouseLastPosition']['x']||l!==c['mouseLastPosition']['y']){let o=d;switch(o['itemType']){case b['Enum']['HANDLER_TYPE']['MODEL']:{let p=a['Handle']['UpdateTransformByMouseMove'](d,k,l,c['mouseLastPosition']['x'],c['mouseLastPosition']['y'],c['KeyPress']['shiftKey']);if(p!==undefined){for(let q=0x0;q<g['length'];q++){let r=g[q],s=a['Data']['ShapeAction']['GetAction'](r['object']['id_file'],r['origin_id']);s['transform']=new b['Matrix4']()['multiplyMatrices'](p['matrix'],s['transform']);if(s['transInfo']===undefined)s['transInfo']=a['Data']['TransInfoItem']();s['transInfo']['translate']['add'](p['move']),s['transInfo']['rotate']['add'](p['rotate']),r['object']['flag']['updateProcess']=!![];}if(a['useTree']){let t=[];for(let u=0x0;u<h['length'];u++){let v=a['Data']['ModelFileManager']['GetFileKeyByNodeID'](h[u]),w=a['Data']['GetOriginNodeID'](v,h[u]),z=a['Data']['ShapeAction']['GetAction'](v,w);if(z===undefined)continue;let A=new b['Matrix4']()['multiplyMatrices'](p['matrix'],z['transform']);if(z['transInfo']===undefined)z['transInfo']=a['Data']['TransInfoItem']();z['transInfo']['translate']['add'](p['move']),z['transInfo']['rotate']['add'](p['rotate']);let B=a['Handle']['ResultTransformInfoItem'](A,z['transInfo']['translate'],z['transInfo']['rotate']);t['push'](B);}a['Tree']['SetMultiObjectFormTransformInfoItem'](h,t);}a['ViewRefresh']();}}break;}}}else{if(!c['mouseLeftDown']){if(d!==undefined&&d['state']===b['Enum']['HANDLE_MOUSE_STATE']['OVER'])a['Renderer']['Render']();a['Handle']['ClearState'](),a['Clipping']['PickPlane'](k,l);let C=a['Handle']['Pick'](k,l);C!==undefined&&d['id']===C['id']&&(d['state']=b['Enum']['HANDLE_MOUSE_STATE']['OVER'],a['Renderer']['Render']());}}}c['base']['prototype']['mouseMove']['call'](c,k,l),c['actionEnabled']=!![];},this['mouseUp']=function(k,l,m){if(d!==undefined){if(d['state']===b['Enum']['HANDLE_MOUSE_STATE']['DOWN'])c['actionEnabled']=![],a['Handle']['ClearStateById'](d['id']),a['Renderer']['Render']();else{if(a['IsUseProgressive']())a['Renderer']['enableRenderLimit']=![];}}if(c['actionEnabled']&&m===b['Enum']['MOUSE_STATE']['PAN']){if(c['base']['prototype']['GetMouseClick']['call'](c,k,l)===!![]){let o=new b['Vector2']()['subVectors'](c['mouseDownPosition'],c['mouse']);o['length']()<0x5&&(c['actionEnabled']=![],a['Control']['RestoreMode'](),a['Renderer']['Render']());}}let n=c['base']['prototype']['mouseUp']['call'](c,k,l,m);return c['actionEnabled']&&c['SetSelectObjectHandler'](),c['actionEnabled']=!![],n;},this['touchStart']=function(k){if(k['length']>0x0){if(k['length']===0x1){let l=this['view']['Control']['GetCalcTouchPos'](k[0x0]),m=l['x'],n=l['y'],o=a['Handle']['Handler']();if(o['length']>0x0){if(!c['mouseLeftDown']){if(d!==undefined&&d['state']===b['Enum']['HANDLE_MOUSE_STATE']['OVER'])a['Renderer']['Render']();a['Handle']['ClearState'](),a['Clipping']['PickPlane'](m,n);let p=a['Handle']['Pick'](m,n);if(p!==undefined)d=p;else c['base']['prototype']['touchStart']['call'](c,k),c['base']['prototype']['touchEnd']['call'](c,k),c['SetSelectObjectHandler'](),a['Renderer']['Render']();d!==undefined&&(d['state']=b['Enum']['HANDLE_MOUSE_STATE']['OVER'],a['Renderer']['Render']());}}}if(a['IsUseProgressive']())a['Renderer']['enableRenderLimit']=!![];}c['base']['prototype']['touchStart']['call'](c,k);},this['touchMove']=function(k){let l=a['Handle']['Handler']();if(l['length']>0x0){const m=new b['Matrix4']()['copy'](a['Camera']['matMVP']);if(d!==undefined&&d['state']===b['Enum']['HANDLE_MOUSE_STATE']['OVER']){c['actionEnabled']=![];let n=this['view']['Control']['GetCalcTouchPos'](k[0x0]),o=n['x'],p=n['y'];if(o!==c['mouseLastPosition']['x']||p!==c['mouseLastPosition']['y']){let q=d;switch(q['itemType']){case b['Enum']['HANDLER_TYPE']['MODEL']:{let r=a['Handle']['UpdateTransformByMouseMove'](d,o,p,c['mouseLastPosition']['x'],c['mouseLastPosition']['y'],c['KeyPress']['shiftKey']);if(r!==undefined){for(let s=0x0;s<g['length'];s++){let t=g[s],u=a['Data']['ShapeAction']['GetAction'](t['object']['id_file'],t['origin_id']);u['transform']=new b['Matrix4']()['multiplyMatrices'](r['matrix'],u['transform']);if(u['transInfo']===undefined)u['transInfo']=a['Data']['TransInfoItem']();u['transInfo']['translate']['add'](r['move']),u['transInfo']['rotate']['add'](r['rotate']),t['object']['flag']['updateProcess']=!![];}if(a['useTree']){let v=[];for(let w=0x0;w<h['length'];w++){let z=a['Data']['ModelFileManager']['GetFileKeyByNodeID'](h[w]),A=a['Data']['GetOriginNodeID'](z,h[w]),B=a['Data']['ShapeAction']['GetAction'](z,A);if(B===undefined)continue;let C=new b['Matrix4']()['multiplyMatrices'](r['matrix'],B['transform']);if(B['transInfo']===undefined)B['transInfo']=a['Data']['TransInfoItem']();B['transInfo']['translate']['add'](r['move']),B['transInfo']['rotate']['add'](r['rotate']);let D=a['Handle']['ResultTransformInfoItem'](C,B['transInfo']['translate'],B['transInfo']['rotate']);v['push'](D);}a['Tree']['SetMultiObjectFormTransformInfoItem'](h,v);}a['ViewRefresh']();}}break;}}}else{if(!c['mouseLeftDown']){if(d!==undefined&&d['state']===b['Enum']['HANDLE_MOUSE_STATE']['OVER'])a['Renderer']['Render']();let E=this['view']['Control']['GetCalcTouchPos'](k[0x0]),F=E['x'],G=E['y'];a['Handle']['ClearState'](),a['Clipping']['PickPlane'](F,G);let H=a['Handle']['Pick'](F,G);H!==undefined&&d['id']===H['id']&&(d['state']=b['Enum']['HANDLE_MOUSE_STATE']['OVER'],a['Renderer']['Render']());}}}c['base']['prototype']['touchMove']['call'](c,k),c['actionEnabled']=!![];},this['touchEnd']=function(k){if(k['length']===0x0){d!==undefined&&(c['actionEnabled']=![],a['Handle']['ClearStateById'](d['id']),a['Renderer']['Render']());if(a['IsUseProgressive']())a['Renderer']['enableRenderLimit']=![];}c['actionEnabled']&&c['SetSelectObjectHandler'](),c['actionEnabled']=!![],c['_touchLastCount']=0x0,c['base']['prototype']['touchEnd']['call'](c,k);},this['mouseDoubleClick']=function(k,l,m){c['base']['prototype']['mouseDoubleClick']['call'](c,k,l,m);},this['Render']=function(){if(d===undefined)return;const k=new b['Matrix4']()['copy'](a['Camera']['matMV']),l=new b['Matrix4']()['copy'](a['Camera']['matMVP']);a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['BASIC2D']),a['Shader']['SetGLLight'](),a['Shader']['SetClipping'](undefined),a['Shader']['SetMatrix'](l,k),a['Handle']['RenderItem'](d),a['Shader']['EndShader']();};};export default UIObjectTransform;