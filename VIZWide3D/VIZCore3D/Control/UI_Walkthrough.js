let UIWalkthrough=function(a,b){let c=this;this['base']=b['UIBase'],this['base'](a,b);let d=![],e=![],f=![],g=![],h=![],i=![],j=![],k=![],l=![],m=![],n=![],o=![],p=![],q=![];this['movementSpeed']=0x7d0,this['aroundSpeed']=0.12,this['aroundKeySpeed']=0x12c,this['aroundWheelFactor']=0xa,this['aroundMoveKeyChanged']=!![],this['timeLastUpdate']=undefined,this['aroundTimer']=undefined,this['EventCnt']=0x0;let r=!![],s=![],t=new Map(),u=0x0,v=new b['Vector2']();w();function w(){}function x(z,A){let B=new b['Vector3'](),C=new b['Vector3'](),D=0x0,E=0x0,F=new Date()['getTime'](),G=F-c['timeLastUpdate'];G/=0x3e8,c['timeLastUpdate']=F;let H=c['movementSpeed'];H=a['Data']['GetUnitValue'](H);let I=![];if(a['Avatar']['ShowAvatar']){let S=a['Avatar']['GetObject']();S!==undefined&&(j&&(p?(a['Avatar']['SetZoom'](a['Avatar']['AvatarZoom']-a['Avatar']['ZoomRate']),I=!![],j=![]):E=-0x1*c['aroundSpeed']),k&&(p?(a['Avatar']['SetZoom'](a['Avatar']['AvatarZoom']+a['Avatar']['ZoomRate']),I=!![],k=![]):E=0x1*c['aroundSpeed']));}else j&&(p?(a['Avatar']['SetZoom'](a['Avatar']['AvatarZoom']-a['Avatar']['ZoomRate']),I=!![],j=![]):E=-0x1*c['aroundSpeed']),k&&(p?(a['Avatar']['SetZoom'](a['Avatar']['AvatarZoom']+a['Avatar']['ZoomRate']),I=!![],k=![]):E=0x1*c['aroundSpeed']);let J=0x0,K=0x0,L=![];if(o){J=z-v['x'],K=A-v['y'];if(J!==0x0||K!==0x0)L=!![];}if(n){D=z-c['mouseDownPosition']['x'],E=A-c['mouseDownPosition']['y'],D=D*c['aroundSpeed']*G,E=E*H*G;if(D<0x0)l=!![],m=![];else D>0x0?(l=![],m=!![]):(l=![],m=![]);if(E<0x0)d=!![],e=![];else E>0x0?(d=![],e=!![]):(d=![],e=![]);H*=Math['abs'](E)/a['Data']['GetWalkthroughUnitValue'](0x2710),E=0x0;}let M=new b['Vector3'](0x1,0x0,0x0),N=new b['Vector3'](0x0,0x1,0x0),O=new b['Vector3'](0x0,0x0,0x1),P=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),Q=new b['Matrix4']()['getInverse'](P),R=Q['multiplyVector'](a['Camera']['cameraPosition']);if(!d&&!e&&!f&&!g&&!h&&!i&&!j&&!k&&!l&&!m){if(a['Avatar']['ShowAvatar']){let T=a['Avatar']['GetObject']();if(T!==undefined){R['copy'](T['position']),a['Avatar']['AvatarCurrentTime']+=G;if(!n&&!o)a['Avatar']['SetAnimationByIndex'](T['uuid'],0x0,0x0);a['Renderer']['MainFBClear'](![]),a['Renderer']['Render']();if(L){let U=new b['Vector3'](K/0x64,J/0x96,J/0x96);a['Avatar']['CameraRotate'](U,R);let V=new b['Vector3']()['copy'](T['position']),W=new b['Vector3']()['copy'](T['direction']),X=new b['Vector3']()['copy'](T['up']);{let Y=new b['Matrix4']()['makeRotationZ'](-J/0x96);W['applyMatrix4'](Y);}a['Avatar']['SetPosAndDirection'](undefined,V,W,X);}}}}else{if(a['Avatar']['ShowAvatar']){let Z=a['Avatar']['GetObject']();if(Z!==undefined){let a0=new b['Vector3']()['copy'](Z['direction']),a1=new b['Vector3']()['copy'](Z['up']),a2=new b['Vector3']()['crossVectors'](a1,a0),a3=new b['Vector3']()['copy'](a0);a3['cross'](a2),a3['normalize'](),R['copy'](Z['position']);let a4=new b['Vector3']()['copy'](Z['position']),a5=new b['Vector3']()['copy'](Z['direction']),a6=new b['Vector3']()['copy'](Z['up']),a7=new b['Vector3'](),a8=new b['Vector3']();{d&&!e&&(B['add'](new b['Vector3']()['copy'](O)['multiplyScalar'](H)['multiplyScalar'](G)),a7['sub'](new b['Vector3']()['copy'](a2)['multiplyScalar'](H)['multiplyScalar'](G)));!d&&e&&(B['sub'](new b['Vector3']()['copy'](O)['multiplyScalar'](H)['multiplyScalar'](G)),a7['add'](new b['Vector3']()['copy'](a2)['multiplyScalar'](H)['multiplyScalar'](G)));f&&!g&&(B['add'](new b['Vector3']()['copy'](M)['multiplyScalar'](H)['multiplyScalar'](G)),a7['add'](new b['Vector3']()['copy'](a0)['multiplyScalar'](H)['multiplyScalar'](G)));!f&&g&&(B['sub'](new b['Vector3']()['copy'](M)['multiplyScalar'](H)['multiplyScalar'](G)),a7['sub'](new b['Vector3']()['copy'](a0)['multiplyScalar'](H)['multiplyScalar'](G)));h&&!i&&(C['sub'](new b['Vector3']()['copy'](N)['multiplyScalar'](H)['multiplyScalar'](G)),a8['add'](new b['Vector3']()['copy'](a3)['multiplyScalar'](H)['multiplyScalar'](G)));!h&&i&&(C['add'](new b['Vector3']()['copy'](N)['multiplyScalar'](H)['multiplyScalar'](G)),a8['sub'](new b['Vector3']()['copy'](a3)['multiplyScalar'](H)['multiplyScalar'](G)));{let a9=new b['Vector3']()['copy'](B),aa=new b['Vector3'](0x0,0x0,0x1),ab=new b['Vector3'](0x0,0x0,0x0),ac=new b['Matrix4']()['copy'](P);aa=ac['multiplyVector'](aa),ab=ac['multiplyVector'](ab);let ad=aa['sub'](ab);ad['normalize']();let ae=B['dot'](ad);ad['multiplyScalar'](ae),B['sub'](ad);{let af=new b['Vector3']()['subVectors'](B,a9),ag=af['length'](),ah=new b['Vector3']()['copy'](a7);ah['normalize'](),ah['multiplyScalar'](ag),a7['sub'](ah);}}{let ai=new b['Vector3'](0x0,0x1,0x0),aj=new b['Matrix4']()['copy'](P);aj['setPosition'](new b['Vector3']()),ai=aj['multiplyVector'](ai);let ak=C['dot'](ai);ai['multiplyScalar'](ak),C['sub'](ai),B['add'](C);let al=new b['Vector3']()['copy'](a8);al['normalize'](),al['multiplyScalar'](ak),a8['sub'](al),a7['add'](a8);}a4['add'](a7);{if(d||e||f||g||h||i){}}}if(j||k||l||m){n?(j&&(E=-0x1*c['aroundSpeed']),k&&(E=0x1*c['aroundSpeed'])):(l&&(D=-c['aroundKeySpeed']*c['aroundSpeed']*G),m&&(D=c['aroundKeySpeed']*c['aroundSpeed']*G));j=![],k=![];let am=D,an=new b['Matrix4'](),ao=new b['Matrix4'](),ap=new b['Matrix4']()['makeRotationX'](E/0x64),aq=new b['Matrix4']()['makeRotationY'](D/0x64),ar=new b['Matrix4']()['makeRotationZ'](D/0x64);{{let at=new b['Matrix4']()['copy'](P),au=new b['Vector3'](0x0,0x0,0x1),av=new b['Vector3'](0x0,0x0,0x0);au['applyMatrix4'](at),av['applyMatrix4'](at),au['y']<av['y']&&(ar=new b['Matrix4']()['makeRotationZ'](-D/0x64),am=-D);}{let aw=new b['Matrix4']()['copy'](P),ax=new b['Vector3']()['copy'](R);ax['applyMatrix4'](aw);let ay=new b['Matrix4'](),az=new b['Vector3']()['copy'](ax)['multiplyScalar'](-0x1);ay['setPosition'](az);let aA=new b['Matrix4']()['copy'](ap),aB=new b['Matrix4']()['setPosition'](ax),aC=new b['Matrix4']()['multiplyMatrices'](aA,ay);an=new b['Matrix4']()['multiplyMatrices'](aB,aC);}{let aD=new b['Vector3']()['copy'](R),aE=new b['Matrix4'](),aF=new b['Vector3']()['copy'](aD)['multiplyScalar'](-0x1);aE['setPosition'](aF);let aG=new b['Matrix4']()['copy'](ar),aH=new b['Matrix4']()['setPosition'](aD),aI=new b['Matrix4']()['multiplyMatrices'](aG,aE);ao=new b['Matrix4']()['multiplyMatrices'](aH,aI);}}{let aJ=new b['Matrix4']()['makeRotationZ'](-am/0x64);a5['applyMatrix4'](aJ);}let as=new b['Matrix4']()['multiplyMatrices'](P,ao);P=new b['Matrix4']()['multiplyMatrices'](an,as);}a['Camera']['cameraMatrix']['copy'](P),a['Camera']['ResizeGLWindow'](),a['Avatar']['SetPosAndDirection'](undefined,a4,a5,a6),a['Avatar']['UpdateCamera']();if(n){let aK=0x64,aL=Math['abs'](z-c['mouseDownPosition']['x'])+Math['abs'](A-c['mouseDownPosition']['y']);a['Avatar']['AvatarCurrentTime']+=G;if(aL<aK)a['Avatar']['SetAnimationByIndex'](Z['uuid'],0x0,0x1);else a['Avatar']['SetAnimationByIndex'](Z['uuid'],0x0,0x2);}else!o?(a['Avatar']['AvatarCurrentTime']+=G,a['Avatar']['SetAnimationByIndex'](Z['uuid'],0x0,0x2)):(a['Avatar']['AvatarCurrentTime']+=G,a['Avatar']['SetAnimationByIndex'](Z['uuid'],0x0,0x2));}}else{d&&!e&&B['add'](new b['Vector3']()['copy'](O)['multiplyScalar'](H)['multiplyScalar'](G));!d&&e&&B['sub'](new b['Vector3']()['copy'](O)['multiplyScalar'](H)['multiplyScalar'](G));f&&!g&&B['add'](new b['Vector3']()['copy'](M)['multiplyScalar'](H)['multiplyScalar'](G));!f&&g&&B['sub'](new b['Vector3']()['copy'](M)['multiplyScalar'](H)['multiplyScalar'](G));h&&!i&&C['sub'](new b['Vector3']()['copy'](N)['multiplyScalar'](H)['multiplyScalar'](G));!h&&i&&C['add'](new b['Vector3']()['copy'](N)['multiplyScalar'](H)['multiplyScalar'](G));{let aM=new b['Vector3']()['copy'](O),aN=new b['Vector3'](0x0,0x0,0x0),aO=new b['Matrix4']()['copy'](P);aM=aO['multiplyVector'](aM),aN=aO['multiplyVector'](aN);let aP=aM['sub'](aN);aP['normalize']();let aQ=B['dot'](aP);aP['multiplyScalar'](aQ),B['sub'](aP);}{let aR=new b['Vector3']()['copy'](N),aS=new b['Matrix4']()['copy'](P);aS['setPosition'](new b['Vector3']()),aR=aS['multiplyVector'](aR);let aT=C['dot'](aR);aR['multiplyScalar'](aT),C['sub'](aR),B['add'](C);}if(j&&!k){}if(!j&&k){}(d||e||f||g||h||i)&&P['translate'](B['x'],B['y'],B['z']);if(j||k||l||m){n?(j&&(E=-0x1*c['aroundSpeed']),k&&(E=0x1*c['aroundSpeed'])):(l&&(D=-c['aroundKeySpeed']*c['aroundSpeed']*G),m&&(D=c['aroundKeySpeed']*c['aroundSpeed']*G));j=![],k=![];let aU=new b['Matrix4'](),aV=new b['Matrix4']();{let aW=new b['Matrix4']()['makeRotationX'](E/0x64),aX=new b['Matrix4']()['makeRotationY'](D/0x64),aY=new b['Matrix4']()['makeRotationZ'](D/0x64);{let b0=new b['Matrix4']()['copy'](P),b1=new b['Vector3'](0x0,0x0,0x1),b2=new b['Vector3'](0x0,0x0,0x0);b1['applyMatrix4'](b0),b2['applyMatrix4'](b0);if(b1['y']<b2['y'])aY=new b['Matrix4']()['makeRotationZ'](-D/0x64);}{let b3=new b['Matrix4']()['copy'](P),b4=new b['Vector3']()['copy'](R);b4['applyMatrix4'](b3);let b5=new b['Matrix4'](),b6=new b['Vector3']()['copy'](b4)['multiplyScalar'](-0x1);b5['setPosition'](b6);let b7=new b['Matrix4']()['copy'](aW),b8=new b['Matrix4']()['setPosition'](b4),b9=new b['Matrix4']()['multiplyMatrices'](b7,b5);aU=new b['Matrix4']()['multiplyMatrices'](b8,b9);}{let ba=new b['Vector3']()['copy'](R),bb=new b['Matrix4'](),bc=new b['Vector3']()['copy'](ba)['multiplyScalar'](-0x1);bb['setPosition'](bc);let bd=new b['Matrix4']()['copy'](aY),be=new b['Matrix4']()['setPosition'](ba),bf=new b['Matrix4']()['multiplyMatrices'](bd,bb);aV=new b['Matrix4']()['multiplyMatrices'](be,bf);}let aZ=new b['Matrix4']()['multiplyMatrices'](P,aV);P=new b['Matrix4']()['multiplyMatrices'](aU,aZ);}}a['Camera']['cameraMatrix']['copy'](P);}a['Camera']['ResizeGLWindow'](),u%0x32===0x0&&(a['MeshBlock']['Reset'](),u=0x0),a['Renderer']['MainFBClear'](![]),a['Renderer']['Render'](),u++;}if(!j&&!k&&!l&&!m){}else{if(0x0){let bg=new b['Matrix4']()['makeRotationX'](E/0x64),bh=new b['Matrix4']()['makeRotationY'](D/0x64);{let bi=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),bj=new b['Matrix4']()['getInverse'](bi),bk=new b['Vector3']()['copy'](a['Camera']['pivot']),bl=bj['multiplyVector'](a['Camera']['cameraPosition']),bm=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),bn=new b['Vector3']()['copy'](bl);bn['applyMatrix4'](bm);let bo=new b['Matrix4'](),bp=new b['Vector3']()['copy'](bn)['multiplyScalar'](-0x1);bo['setPosition'](bp);let bq;bq=new b['Matrix4']()['multiplyMatrices'](bg,bh);let br=new b['Matrix4']()['setPosition'](bn),bs=new b['Matrix4']()['multiplyMatrices'](bq,bo),bt=new b['Matrix4']()['multiplyMatrices'](br,bs);}}}v['x']=z,v['y']=A;}this['UIBegin']=function(){c['base']['prototype']['UIBegin']['call'](c);for(let y=0x0;y<0x10;y++)a['Camera']['SetZAxis2Up']();a['Avatar']['InitPosAndDirection'](),a['Avatar']['ShowAvatar']&&a['Camera']['ResizeGLWindow'](),r=![],s=![],c['timeLastUpdate']=new Date()['getTime'](),c['aroundTimer']=setInterval(function(){if(n||o)r=!![];if(a['Avatar']['ShowAvatar'])r=!![];if(s!==r)c['timeLastUpdate']=new Date()['getTime']();if(r)x(c['mouse']['x'],c['mouse']['y']);s=r;},0xa);},this['UIEnd']=function(){c['aroundTimer']!==null&&(clearInterval(c['aroundTimer']),c['aroundTimer']=null),c['base']['prototype']['UIEnd']['call'](c);},this['mouseDown']=function(z,A,B){if(B!==0x1)c['actionEnabled']=![];else B===0x1&&(q=!![]);let C=c['base']['prototype']['mouseDown']['call'](c,z,A,B);c['actionEnabled']=!![];if(q)return C;v['x']=z,v['y']=A;B===0x2?o=!![]:n=!![];if(a['IsUseProgressive']())a['Renderer']['enableRenderLimit']=!![];return C;},this['mouseMove']=function(z,A){if(q!==!![])c['actionEnabled']=![];c['base']['prototype']['mouseMove']['call'](c,z,A),c['actionEnabled']=!![];},this['mouseUp']=function(z,A,B){let C=c['base']['prototype']['mouseUp']['call'](c,z,A,B);q=![];B===0x2?o=![]:(d=![],e=![],l=![],m=![],n=![]);if(a['IsUseProgressive']())a['Renderer']['enableRenderLimit']=![];return C;},this['mouseWheel']=function(z,A,B){c['EventCnt']++,p=!![];if(a['IsUseProgressive']())a['Renderer']['enableRenderLimit']=!![];if(B<0x0)k=!![],j=![],r=!![];else B>0x0&&(k=![],j=!![],r=!![]);setTimeout(function(){c['EventCnt']--;if(c['EventCnt']===0x0){p=![],k=![],j=![];if(a['IsUseProgressive']())a['Renderer']['enableRenderLimit']=![];}},0x1e);},this['mouseOver']=function(){c['base']['prototype']['mouseOver']['call'](c);},this['mouseOut']=function(z,A,B){n=![];if(a['IsUseProgressive']())a['Renderer']['enableRenderLimit']=![];c['actionEnabled']=![];let C=c['base']['prototype']['mouseUp']['call'](c,z,A,B);c['actionEnabled']=!![],a['MeshBlock']['Reset'](),a['Renderer']['MainFBClear'](),a['Renderer']['Render']();},this['keyPress']=function(y){switch(y){case 0x2b:{c['mouseWheel'](0x0,0x0,0x78);}break;case 0x2d:{c['mouseWheel'](0x0,0x0,-0x78);}break;case 0x26:case 0x77:case 0x57:{t['set'](0x0,!![]),d=!![];}break;case 0x25:case 0x61:case 0x41:{!c['aroundMoveKeyChanged']?(t['set'](0x1,!![]),f=!![]):(t['set'](0x6,!![]),l=!![]);}break;case 0x28:case 0x73:case 0x53:{t['set'](0x2,!![]),e=!![];}break;case 0x27:case 0x64:case 0x44:{!c['aroundMoveKeyChanged']?(t['set'](0x3,!![]),g=!![]):(t['set'](0x7,!![]),m=!![]);}break;case 0x71:case 0x51:{!c['aroundMoveKeyChanged']?(t['set'](0x6,!![]),l=!![]):(t['set'](0x1,!![]),f=!![]);}break;case 0x65:case 0x45:{!c['aroundMoveKeyChanged']?(t['set'](0x7,!![]),m=!![]):(t['set'](0x3,!![]),g=!![]);}break;case 0x72:case 0x52:{t['set'](0x4,!![]),h=!![];}break;case 0x66:case 0x46:{t['set'](0x5,!![]),i=!![];}break;}r=!![];if(a['IsUseProgressive']())a['Renderer']['enableRenderLimit']=!![];},this['keyUp']=function(y){switch(y){case 0x26:case 0x77:case 0x57:{t['set'](0x0,![]),d=![];}break;case 0x25:case 0x61:case 0x41:{!c['aroundMoveKeyChanged']?(t['set'](0x1,![]),f=![]):(t['set'](0x6,![]),l=![]);}break;case 0x28:case 0x73:case 0x53:{t['set'](0x2,![]),e=![];}break;case 0x27:case 0x64:case 0x44:{!c['aroundMoveKeyChanged']?(t['set'](0x3,![]),g=![]):(t['set'](0x7,![]),m=![]);}break;case 0x71:case 0x51:{!c['aroundMoveKeyChanged']?(t['set'](0x6,![]),l=![]):(t['set'](0x1,![]),f=![]);}break;case 0x65:case 0x45:{!c['aroundMoveKeyChanged']?(t['set'](0x7,![]),m=![]):(t['set'](0x3,![]),g=![]);}break;case 0x72:case 0x52:{t['set'](0x4,![]),h=![];}break;case 0x66:case 0x46:{t['set'](0x5,![]),i=![];}break;}let z=![],A=function(B,C,D){if(B)z=!![];};t['forEach'](A),r=z;if(a['IsUseProgressive']())a['Renderer']['enableRenderLimit']=![];a['Renderer']['MainFBClear'](),a['Renderer']['Render'](),a['MeshBlock']['Reset']();},this['mouseDoubleClick']=function(z,A,B){d=![],e=![],f=![],g=![],h=![],i=![],j=![],k=![],l=![],m=![],n=![],o=![];const C=a['Renderer']['Picking'](z,A);if(C===undefined)return;const D=a['Data']['GetPickByBody'](C['bodyId'],z,A);if(!D['pick'])return;let E=D['position'];if(E===undefined)return;let F=0x690;F=a['Data']['GetUnitValue'](F),a['Camera']['pivot']=E;for(let K=0x0;K<0x10;K++)a['Camera']['SetZAxis2Up']();let G=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),H=new b['Matrix4']()['multiplyMatrices'](a['Camera']['projectionMatrix'],G),I=new b['Vector3']()['copy'](E);I['z']+=F;let J=a['Camera']['cameraMatrix']['multiplyVector'](new b['Vector3']()['copy'](I));a['Camera']['cameraMatrix']['translate'](-J['x'],-J['y'],-J['z']+a['Camera']['viewDistance']),a['Camera']['pivot']=I,a['Camera']['ResizeGLWindow'](),a['Avatar']['ShowAvatar']&&a['Avatar']['GetObject']()!==undefined&&a['Avatar']['InitPosAndDirection'](),a['MeshBlock']['Reset'](),a['Renderer']['MainFBClear'](),a['Renderer']['Render']();},this['MouseLog']=function(){console['log']('UIWalkthrough.mouse\x20:\x20'+c['mouse']['x']+','+c['mouse']['y']);},this['Render2D']=function(y){if(c['mouseLeftDown']&&n){if(c['mouseDownPosition']['x']!==c['mouse']['x']&&c['mouseDownPosition']['y']!==c['mouse']['y']){let z=0x5,A=0x2,B=0x23;y['fillStyle']='rgba(255,255,255,0.6)',y['strokeStyle']='rgba(64,64,64,0.3)',y['lineWidth']=z,y['strokeRect'](c['mouseDownPosition']['x']-B,c['mouseDownPosition']['y']-z/0x2,B-z-A,z),y['fillRect'](c['mouseDownPosition']['x']-B,c['mouseDownPosition']['y']-z/0x2,B-z-A,z),y['strokeRect'](c['mouseDownPosition']['x']+z+A,c['mouseDownPosition']['y']-z/0x2,B-z,z),y['fillRect'](c['mouseDownPosition']['x']+z+A,c['mouseDownPosition']['y']-z/0x2,B-z,z),y['strokeRect'](c['mouseDownPosition']['x']-z/0x2,c['mouseDownPosition']['y']-B,z,B-z-A),y['fillRect'](c['mouseDownPosition']['x']-z/0x2,c['mouseDownPosition']['y']-B,z,B-z-A),y['strokeRect'](c['mouseDownPosition']['x']-z/0x2,c['mouseDownPosition']['y']+z+A,z,B-z),y['fillRect'](c['mouseDownPosition']['x']-z/0x2,c['mouseDownPosition']['y']+z+A,z,B-z);}}};};export default UIWalkthrough;