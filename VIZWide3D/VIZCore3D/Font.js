class Font{constructor(a,b){let c=this,d=undefined,e=[],f=0x1,g=0x400,h=0x4/g;this['FontStyleItem']=function(){let p={'font':{'face':'Arial','size':0x1e,'color':new b['Color'](0x0,0x0,0x0,0xff)},'border':{'enable':!![],'color':new b['Color'](0x0,0x0,0x0,0xff),'thickness':0x1,'type':0x0,'round':0x5,'offset':0x5},'background':{'enable':!![],'color':new b['Color'](0xff,0xff,0xff,0xff)}};return p;};let i=function(p,q){let r={'id':e[p]['id'],'targetTexture':e[p]['targetTexture'],'width':e[p]['width'],'height':e[p]['height'],'fontInfo':e[p]['fontInfo'][q]};return r['fontInfo']['useCache']=!![],r;},j=function(){let p={'id':0x0,'targetTexture':0x0,'width':0x400,'height':0x400,'fontInfo':[]};return p;},k=function(){let p={'x':0x0,'y':0x0,'u':0x0,'v':0x0,'text':[],'style':c['FontStyleItem'](),'useCache':!![]};return p;};l();function l(){if(d===undefined){let p=document['createElement']('canvas');p['id']=a['GetViewID']()+'FontCanvas',d=p['getContext']('2d'),d['imageSmoothingEnabled']=![],d['textAlign']='center',d['canvas']['width']=g,d['canvas']['height']=g,a['Container']['appendChild'](p);}f=0x1;}this['GetFontTextureItem']=function(p){for(let q=e['length']-0x1;q>=0x0;q--){if(e[q]['id']!==p)continue;return e[q];}return undefined;},this['Clear']=function(){for(let p=e['length']-0x1;p>=0x0;p--){if(e[p]['texture']!==0x0)a['gl']['deleteTexture'](e[p]['texture']);e['splice'](p,0x1);}f=0x1;},this['BeginFontCache']=function(){for(let p=e['length']-0x1;p>=0x0;p--){for(let q=e[p]['fontInfo']['length']-0x1;q>=0x0;q--){e[p]['fontInfo'][q]['useCache']=![];}}},this['EndFontCache']=function(){for(let p=e['length']-0x1;p>=0x0;p--){let q=![];for(let r=e[p]['fontInfo']['length']-0x1;r>=0x0;r--){if(e[p]['fontInfo'][r]['useCache'])continue;q=!![],e[p]['fontInfo']['splice'](r,0x1);}if(e[p]['fontInfo']['length']===0x0){if(e[p]['texture']!==0x0)a['gl']['deleteTexture'](e[p]['texture']);e['splice'](p,0x1);}else q&&o(p,!![]);}};function m(p,q,r,s,t,u){p['canvas']['width']=0x80,p['canvas']['height']=0x80,p['fillStyle']=s,p['fillRect'](0x0,0x0,q,r),p['textAlign']='center',p['textBaseline']='middle',p['fillStyle']=t,p['fillText'](u,q/0x2,r/0x2);}function n(p,q,r,s){let t=0x0,w=0x0,z=0x0,A=0x0;d['font']=a['Renderer']['Util']['GetFontString'](q);const B=a['Renderer']['Util']['GetTextMetricsByFont'](d,p,q);let C=B['width']+r['offset']*0x2,D=B['height']*p['length']+r['offset']*0x2,E=C/g,F=D/g,G=g,H=g,I=-0x1,J=-0x1,K=h,L=h,M=0x0,N=0x0,O=0x0,P=![];if(E<0x1&&F<0x1)for(let Q=0x0;Q<e['length'];Q++){K=h,L=h,M=0x0,N=0x0,O=h;for(let R=0x0;R<e[Q]['fontInfo']['length'];R++){let S=e[Q]['fontInfo'][R];K=S['x']+S['u'],L=S['y']+S['v'],M=Math['max'](K,M),N=Math['max'](L,N);if(N+F>0x1)break;if(M+E>0x1){M=0x0,O=N+h;continue;}else{if(S['y']!==O){M=0x0,O=N;continue;}}O=S['y'];}if(M+h+E<=0x1&&N+h+F<=0x1){I=Q,J=-0x1,P=!![],K=M+h,L=O;K+E>0x1&&(K=h,L=N+h);break;}}else K=0x4/C,L=0x4/D,G=C+0x4*0x4,H=D+0x4*0x4,E=C/G+0x1/G,F=D/H;if(!P){K=h,L=h;let T=j();T['id']=f,f++,T['width']=G,T['height']=H,e['push'](T),I=e['length']-0x1;}t=K,w=L,z=E,A=F;if(J<0x0){let U=k();U['x']=t,U['y']=w,U['u']=z,U['v']=A,U['text']['push'](...p),U['style']['font']['face']=q['face'],U['style']['font']['size']=q['size'],U['style']['font']['color']['copy'](q['color']),U['style']['border']['enable']=r['enable'],U['style']['border']['thickness']=r['thickness'],U['style']['border']['color']['copy'](r['color']),U['style']['border']['type']=r['type'],U['style']['border']['round']=r['round'],U['style']['border']['offset']=r['offset'],U['style']['background']['enable']=s['enable'],U['style']['background']['round']=s['round'],U['style']['background']['color']['copy'](s['color']),e[I]['fontInfo']['push'](U),J=e[I]['fontInfo']['length']-0x1;}return o(I,![]),i(I,J);}function o(p,q){e[p]['width']===d['canvas']['width']&&e[p]['height']===d['canvas']['height']?d['clearRect'](0x0,0x0,d['canvas']['width'],d['canvas']['height']):(d['canvas']['width']=e[p]['width'],d['canvas']['height']=e[p]['height'],d['clearRect'](0x0,0x0,d['canvas']['width'],d['canvas']['height']));e[p]['targetTexture']!==0x0&&a['gl']['deleteTexture'](e[p]['targetTexture']);let r=a['gl']['createTexture']();a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],r),a['gl']['texParameteri'](a['gl']['TEXTURE_2D'],a['gl']['TEXTURE_MIN_FILTER'],a['gl']['NEAREST']),a['gl']['texParameteri'](a['gl']['TEXTURE_2D'],a['gl']['TEXTURE_MAG_FILTER'],a['gl']['LINEAR']),a['gl']['texParameteri'](a['gl']['TEXTURE_2D'],a['gl']['TEXTURE_WRAP_S'],a['gl']['CLAMP_TO_EDGE']),a['gl']['texParameteri'](a['gl']['TEXTURE_2D'],a['gl']['TEXTURE_WRAP_T'],a['gl']['CLAMP_TO_EDGE']),e[p]['targetTexture']=r;let s=0x0,t=0x0,u=0x0,v=0x0,w=h;for(let x=0x0;x<e[p]['fontInfo']['length'];x++){let y=e[p]['fontInfo'][x];y['useCache']=!![];const z=a['Renderer']['Util']['GetTextMetricsByFont'](d,y['text'],y['style']['font']);let A=z['width']+y['style']['border']['offset']*0x2,B=z['height']*y['text']['length']+y['style']['border']['offset']*0x2;if(q){let E=y['u'],F=y['v'];v+E+h>0x1?(s=h,t=u+h,v=s,w=t):(s=v+h,t=w),y['x']=s,y['y']=t,v=s+E,w=t,u=Math['max'](t+F,u);}let C=y['x']*e[p]['width'],D=y['y']*e[p]['height'];y['style']['background']['enable']?d['fillStyle']='rgba('+y['style']['background']['color']['r']+','+y['style']['background']['color']['g']+','+y['style']['background']['color']['b']+','+y['style']['background']['color']['glAlpha']()+')':d['fillStyle']='rgba('+y['style']['background']['color']['r']+','+y['style']['background']['color']['g']+','+y['style']['background']['color']['b']+',\x200)';y['style']['border']['enable']?(d['strokeStyle']='rgba('+y['style']['border']['color']['r']+','+y['style']['border']['color']['g']+','+y['style']['border']['color']['b']+','+y['style']['border']['color']['glAlpha']()+')',d['lineWidth']=y['style']['border']['thickness']):(d['strokeStyle']='rgba('+y['style']['border']['color']['r']+','+y['style']['border']['color']['g']+','+y['style']['border']['color']['b']+','+0x0+')',d['lineWidth']=y['style']['border']['thickness']);{if(y['style']['border']['type']===0x0)a['Renderer']['Util']['DrawRect'](d,C,D,A,B,y['style']['background']['enable'],y['style']['border']['enable']);else{if(y['style']['border']['type']===0x1)a['Renderer']['Util']['DrawRoundRect'](d,C,D,A,B,y['style']['border']['round'],y['style']['background']['enable'],y['style']['border']['enable']);}}C+=y['style']['border']['offset'],D+=y['style']['border']['offset'],d['font']=a['Renderer']['Util']['GetFontString'](y['style']['font']),d['fillStyle']='rgba('+y['style']['font']['color']['r']+','+y['style']['font']['color']['g']+','+y['style']['font']['color']['b']+','+y['style']['font']['color']['glAlpha']()+')';for(let G=0x0;G<y['text']['length'];G++){d['fillText'](y['text'][G],C,D+(z['ascent']*G+z['ascent']+y['style']['border']['offset']*G));}}a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],r),a['gl']['texImage2D'](a['gl']['TEXTURE_2D'],0x0,a['gl']['RGBA'],a['gl']['RGBA'],a['gl']['UNSIGNED_BYTE'],d['canvas']),a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],null);}this['GetFontData']=function(p,q,r,s){for(let t=0x0;t<e['length'];t++){for(let u=0x0;u<e[t]['fontInfo']['length'];u++){let v=e[t]['fontInfo'][u];if(v['text']['length']!==p['length'])continue;let w=!![];for(let x=0x0;x<v['text']['length'];x++){if(v['text'][x]['localeCompare'](p[x])===0x0)continue;w=![];break;}if(!w)continue;if(v['style']['font']['size']!==q['size'])continue;if(v['style']['font']['face']['localeCompare'](q['face'])!==0x0)continue;if(r!==undefined){if(v['style']['border']['enable']!==r['enable'])continue;if(v['style']['border']['thickness']!==r['thickness'])continue;if(v['style']['border']['type']!==r['type'])continue;if(v['style']['border']['round']!==r['round'])continue;if(!v['style']['border']['color']['equals'](r['color']))continue;}else{if(v['style']['border']['enable'])continue;}if(s!==undefined){if(v['style']['background']['enable']!==s['enable'])continue;if(!v['style']['background']['color']['equals'](s['color']))continue;}else{if(v['style']['background']['enable'])continue;}return i(t,u);}}return n(p,q,r,s);},this['DEBUG_RenderFont']=function(){let p=[],q=a['Font']['FontStyleItem'](),r=undefined;for(let s=0x0;s<0x14;s++){p=[],r=undefined,p['push']('TEST_'+s),r=a['Font']['GetFontData'](p,q['font'],q['border'],q['background']);if(r!==undefined){a['gl']['enable'](a['gl']['BLEND']),a['gl']['blendFunc'](a['gl']['SRC_ALPHA'],a['gl']['ONE_MINUS_SRC_ALPHA']),a['gl']['enable'](a['gl']['DEPTH_TEST']),a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['TEXTURE2D']);const t=new b['Matrix4']()['copy'](a['Camera']['matMV']),u=new b['Matrix4']()['copy'](a['Camera']['matMVP']);a['Shader']['SetClipping'](undefined),a['Shader']['SetMatrix'](u,t),a['Shader']['SetGLColor'](0x1,0x1,0x1,0x1),a['Shader']['SetCurrentTexture']('u_Texture',a['gl']['TEXTURE_2D'],r['targetTexture']);let v=[-0x19+s*0x2,-0x17,0x5,-0x17+s*0x2,-0x17,0x5,-0x19+s*0x2,-0x19,0x5,-0x17+s*0x2,-0x19,0x5],w=[r['fontInfo']['x'],r['fontInfo']['y'],r['fontInfo']['x']+r['fontInfo']['u'],r['fontInfo']['y'],r['fontInfo']['x'],r['fontInfo']['y']+r['fontInfo']['v'],r['fontInfo']['x']+r['fontInfo']['u'],r['fontInfo']['y']+r['fontInfo']['v']],x=a['gl']['createBuffer']();a['gl']['bindBuffer'](a['gl']['ARRAY_BUFFER'],x),a['gl']['bufferData'](a['gl']['ARRAY_BUFFER'],new Float32Array(v),a['gl']['STATIC_DRAW']),a['gl']['vertexAttribPointer'](a['Shader']['positionAttributeLocation'],0x3,a['gl']['FLOAT'],![],0x0,0x0);let y=a['gl']['createBuffer']();a['gl']['bindBuffer'](a['gl']['ARRAY_BUFFER'],y),a['gl']['bufferData'](a['gl']['ARRAY_BUFFER'],new Float32Array(w),a['gl']['STATIC_DRAW']),a['gl']['vertexAttribPointer'](a['Shader']['uvAttributeLocation'],0x2,a['gl']['FLOAT'],![],0x0,0x0),a['gl']['drawArrays'](a['gl']['TRIANGLE_STRIP'],0x0,0x4),a['Shader']['EndShader'](),a['gl']['disable'](a['gl']['BLEND']),a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],null),a['gl']['deleteBuffer'](x),a['gl']['deleteBuffer'](y);}}},this['listPMIFont']=[],this['RenderPMIFont']=function(){let p=[],q=a['Font']['FontStyleItem']();q['background']['enable']=![],q['border']['enable']=![];let r=undefined;for(let s=0x0;s<c['listPMIFont']['length'];s++){let t=c['listPMIFont'][s];r=undefined,p=[],p['push'](t['m_apcText']),q['font']['color']=new b['Color'](t['m_adRGB'][0x0][0x0]*0xff,t['m_adRGB'][0x0][0x1]*0xff,t['m_adRGB'][0x0][0x2]*0xff,t['m_adRGB'][0x0][0x3]*0xff),q['font']['size']=t['m_dFontHeight'][0x0]*0x5,r=a['Font']['GetFontData'](p,q['font'],q['border'],q['background']);if(r!==undefined){a['gl']['enable'](a['gl']['BLEND']),a['gl']['blendFunc'](a['gl']['SRC_ALPHA'],a['gl']['ONE_MINUS_SRC_ALPHA']),a['gl']['enable'](a['gl']['DEPTH_TEST']),a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['TEXTURE2D']);const u=new b['Matrix4']()['copy'](a['Camera']['matMV']),v=new b['Matrix4']()['copy'](a['Camera']['matMVP']);a['Shader']['SetClipping'](undefined),a['Shader']['SetMatrix'](v,u),a['Shader']['SetGLColor'](0x1,0x1,0x1,0x1),a['Shader']['SetCurrentTexture']('u_Texture',a['gl']['TEXTURE_2D'],r['targetTexture']);let w=new b['Vector3'](t['m_dLeftPoints'][0x0][0x0]*0x3e8,t['m_dLeftPoints'][0x0][0x1]*0x3e8,t['m_dLeftPoints'][0x0][0x2]*0x3e8),x=new b['Vector3'](t['m_dRightPoints'][0x0][0x0]*0x3e8,t['m_dRightPoints'][0x0][0x1]*0x3e8,t['m_dRightPoints'][0x0][0x2]*0x3e8),y=new b['Matrix4']()['set'](t['m_WorldMatrix'][0x0][0x0],t['m_WorldMatrix'][0x0][0x1],t['m_WorldMatrix'][0x0][0x2],t['m_WorldMatrix'][0x0][0x3]*0x3e8,t['m_WorldMatrix'][0x0][0x4],t['m_WorldMatrix'][0x0][0x5],t['m_WorldMatrix'][0x0][0x6],t['m_WorldMatrix'][0x0][0x7]*0x3e8,t['m_WorldMatrix'][0x0][0x8],t['m_WorldMatrix'][0x0][0x9],t['m_WorldMatrix'][0x0][0xa],t['m_WorldMatrix'][0x0][0xb]*0x3e8,t['m_WorldMatrix'][0x0][0xc],t['m_WorldMatrix'][0x0][0xd],t['m_WorldMatrix'][0x0][0xe],t['m_WorldMatrix'][0x0][0xf],t['m_WorldMatrix'][0x0][0x10]);w=w['applyMatrix4'](y),x=x['applyMatrix4'](y);let z=new b['BBox']()['set'](w,x),A=[z['min']['x'],z['max']['y'],z['min']['z'],z['max']['x'],z['max']['y'],z['max']['z'],z['min']['x'],z['min']['y'],z['max']['z'],z['max']['x'],z['min']['y'],z['max']['z']],B=[r['fontInfo']['x'],r['fontInfo']['y'],r['fontInfo']['x']+r['fontInfo']['u'],r['fontInfo']['y'],r['fontInfo']['x'],r['fontInfo']['y']+r['fontInfo']['v'],r['fontInfo']['x']+r['fontInfo']['u'],r['fontInfo']['y']+r['fontInfo']['v']],C=a['gl']['createBuffer']();a['gl']['bindBuffer'](a['gl']['ARRAY_BUFFER'],C),a['gl']['bufferData'](a['gl']['ARRAY_BUFFER'],new Float32Array(A),a['gl']['STATIC_DRAW']),a['gl']['vertexAttribPointer'](a['Shader']['positionAttributeLocation'],0x3,a['gl']['FLOAT'],![],0x0,0x0);let D=a['gl']['createBuffer']();a['gl']['bindBuffer'](a['gl']['ARRAY_BUFFER'],D),a['gl']['bufferData'](a['gl']['ARRAY_BUFFER'],new Float32Array(B),a['gl']['STATIC_DRAW']),a['gl']['vertexAttribPointer'](a['Shader']['uvAttributeLocation'],0x2,a['gl']['FLOAT'],![],0x0,0x0),a['gl']['drawArrays'](a['gl']['TRIANGLE_STRIP'],0x0,0x4),a['Shader']['EndShader'](),a['gl']['disable'](a['gl']['BLEND']),a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],null),a['gl']['deleteBuffer'](C),a['gl']['deleteBuffer'](D);}}},this['listEdge']=[],this['bInitPositionBuffer']=[],this['bInitPosOffset']=[],this['bInitPosColor']=[],this['ClearEdgePositionBuffer']=()=>{c['bInitPositionBuffer']=[],c['bInitPosOffset']=[],c['bInitPosColor']=[];},this['RenderEdge']=function(){if(a['Data']['ModelFileManager']['HasLineData']()===![])return;a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['BASIC3D']),a['Shader']['SetLineThickness'](0xa),a['Shader']['SetResolutionData'](),a['Shader']['SetGLCameraData']();let p=new b['Matrix4']()['copy'](a['Camera']['matMVP']),q=new b['Matrix4']()['copy'](a['Camera']['matMV']);a['Shader']['SetMatrix'](p,q);if(c['bInitPositionBuffer']['length']===0x0){let r=[],s=undefined,t=0x0,u=undefined,v=a['Data']['ModelFileManager']['GetLineData']();for(let w=0x0;w<v['length'];w++){let x=v[w],y=a['Data']['ShapeAction']['GetVisible'](x['fileid'],x['index']);if(y===![])continue;let z=new b['Color'](x['color'][0x0]*0xff,x['color'][0x1]*0xff,x['color'][0x2]*0xff,x['color'][0x3]*0xff);u===undefined&&(u=z);t>0x0&&!z['equals'](u)&&(s=a['gl']['createBuffer'](),a['gl']['bindBuffer'](a['gl']['ARRAY_BUFFER'],s),a['gl']['bufferData'](a['gl']['ARRAY_BUFFER'],new Float32Array(r),a['gl']['STATIC_DRAW']),a['gl']['bindBuffer'](a['gl']['ARRAY_BUFFER'],null),c['bInitPositionBuffer']['push'](s),c['bInitPosOffset']['push'](t),c['bInitPosColor']['push'](new b['Color']()['copy'](u)),r=[],t=0x0,u['copy'](z));if(![])for(let A=0x0;A<x['nPts']-0x3;A+=0x3){let B=new b['Vector3'](x['vPts'][A+0x0],x['vPts'][A+0x1],x['vPts'][A+0x2]),C=new b['Vector3'](x['vPts'][A+0x3],x['vPts'][A+0x4],x['vPts'][A+0x5]),D=a['MeshProcess']['GetLine'](B,C,0x1f4);for(let E=0x0;E<D['vertices']['length'];E++){r[t+E*0x3+0x0]=D['vertices'][E]['x'],r[t+E*0x3+0x1]=D['vertices'][E]['y'],r[t+E*0x3+0x2]=D['vertices'][E]['z'];}t+=D['vertices']['length']*0x3;}for(let F=0x3;F<x['nPts'];F+=0x3){let G=new b['Vector3'](x['vPts'][F-0x3+0x0],x['vPts'][F-0x3+0x1],x['vPts'][F-0x3+0x2]),H=new b['Vector3'](x['vPts'][F-0x3+0x3],x['vPts'][F-0x3+0x4],x['vPts'][F-0x3+0x5]);r[t+0x0]=G['x'],r[t+0x1]=G['y'],r[t+0x2]=G['z'],r[t+0x3]=H['x'],r[t+0x4]=H['y'],r[t+0x5]=H['z'],t+=0x6;}}t>0x0&&(s=a['gl']['createBuffer'](),a['gl']['bindBuffer'](a['gl']['ARRAY_BUFFER'],s),a['gl']['bufferData'](a['gl']['ARRAY_BUFFER'],new Float32Array(r),a['gl']['STATIC_DRAW']),a['gl']['bindBuffer'](a['gl']['ARRAY_BUFFER'],null),c['bInitPositionBuffer']['push'](s),c['bInitPosOffset']['push'](t),c['bInitPosColor']['push'](u),r=[],t=0x0);}for(let I=0x0;I<c['bInitPositionBuffer']['length'];I++){let J=new b['Color']()['copy'](c['bInitPosColor'][I]),K=J['glColor']();a['Shader']['SetGLColor'](K['r'],K['g'],K['b'],K['a']),a['gl']['bindBuffer'](a['gl']['ARRAY_BUFFER'],c['bInitPositionBuffer'][I]),a['gl']['vertexAttribPointer'](a['Shader']['positionAttributeLocation'],0x3,a['gl']['FLOAT'],![],0x0,0x0),a['gl']['drawArrays'](a['gl']['LINES'],0x0,c['bInitPosOffset'][I]/0x3);}a['Shader']['EndShader']();},this['RenderEdgeTest']=function(p){return;for(let q=0x0;q<c['listEdge']['length'];q++){let r=c['listEdge'][q],s=new b['Color'](r['color'][0x0]*0xff,r['color'][0x1]*0xff,r['color'][0x2]*0xff,r['color'][0x3]*0xff),t=s['glColor'](),u=r['nPts']/0x3,v=0xc35000;for(let w=0x0;w<r['nPts']-0x3;w+=0x3){let x=new b['Vector3'](r['vPts'][w+0x0],r['vPts'][w+0x1],r['vPts'][w+0x2]),y=new b['Vector3'](r['vPts'][w+0x3],r['vPts'][w+0x4],r['vPts'][w+0x5]);x['x']-=v,x['y']-=v,y['x']-=v,y['y']-=v;let z=0.001;x=x['multiplyScalar'](z),y=y['multiplyScalar'](z),a['Renderer']['Util']['DrawLine'](p,x['x'],x['y'],y['x'],y['y']);}}};}}export default Font;