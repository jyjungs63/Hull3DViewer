class MiniView{constructor(a,b){let c=this;this['ctx_miniview']=undefined,this['canvas_miniview']=undefined,this['div_miniview']=undefined,this['viewFactor']=0x1,this['img_miniview']=undefined,this['CameraIndex']=-0x1;let d=![];this['resize']=!![],this['Option']={'Visible':![]},this['Element']={'Panel':undefined};let e=undefined,f=undefined,g=()=>{setTimeout(()=>{let q=document['createElement']('div');q['id']='VIZCore_MiniView',q['className']='VIZWeb\x20SH_minimap';let r=document['createElement']('canvas');r['id']='canvas_miniview',r['className']='VIZWeb\x20SH_minimap_canvas',q['appendChild'](r),q['addEventListener']('click',h,![]),c['ctx_miniview']=r['getContext']('2d'),c['canvas_miniview']=r,c['div_miniview']=q;let s=new a['Interface']['Panel'](a['Container']);s['SetContent'](q),s['SetContentBackgroundColor'](new b['Color'](0xf0,0xf0,0xf0,0xff)),s['SetTitleText']('RB0005');let t=a['Container']['clientWidth'],u=a['Container']['clientHeight'],v=t/0x4,w=t/v,x=t/u;s['SetLocationLeft'](t-v-0x32),s['SetSize'](v,v/x);let y=s['Element']['Panel']['getBoundingClientRect']();s['SetLocationTop'](u-y['height']-0x96);function z(){if(f!==undefined)f();};s['OnCloseButtonEvent'](z);let A=()=>{c['Resize']();};s['OnResizeEvent'](A),c['Element']['Panel']=s;let B=a['Mode']['AddCamera'](c['canvas_miniview']),C=a['Mode']['GetCameraIndex'](B);if(C<0x0)return;c['CameraIndex']=C,a['MultiView'][C]['ViewEntityInfo']['ShowReview']=![],a['MultiView'][C]['ViewEntityInfo']['ShowViewCube']=![],a['MultiView'][C]['ViewEntityInfo']['UseControlState']['Rotate']=![],a['MultiView'][C]['ViewEntityInfo']['UseControlState']['Touch_Rotate']=![],a['MultiView'][C]['ViewEntityInfo']['DelayTime']=0xbb8,a['MultiView'][C]['ViewEntityInfo']['UseContextMenu']=![],a['Mode']['Camera'](c['CameraIndex']),a['Camera']['SetPerspectiveView'](![]),a['Camera']['FitAll'](),a['Mode']['Camera'](0x0),a['MultiView'][C]['Show'](![]),s['Show'](![]),a['Interface']['UIElement']&&a['Interface']['UIElement']['SetLanguage'](a['Configuration']['Language']);},0x64);};this['Init']=function(){if(!a['useMiniView'])return;g();};function h(q){console['log']('Click\x20:\x20',q);let r=a['Camera']['CameraIndex'];a['Mode']['Camera'](c['CameraIndex']);let s=new b['Matrix4']()['copy'](a['Camera']['matMVP']),t=new b['Vector3'](q['offsetX'],q['offsetY'],0x0),u=a['Camera']['screen2WorldWithMatrix'](s,t),v=a['Data']['GetBBox']();u['z']=v['center']['z'],a['Mode']['Camera'](0x0),a['Camera']['FocusPivot'](u),a['Mode']['Camera'](r);};function i(q){let r=c['canvas_miniview']['width'],s=c['canvas_miniview']['height'],t=q['x'],u=q['y'],v=0xa;if(t>r-v)t=r-v;if(u>s-v)u=s-v;if(t<v)t=v;if(u<v)u=v;return new b['Vector2'](t,u);}function j(){let q=a['Camera']['CameraIndex'];a['Mode']['Camera'](0x0);let r=a['Camera']['GetViewDirection']();return a['Mode']['Camera'](q),r;};function k(){let q=a['Camera']['CameraIndex'];a['Mode']['Camera'](0x0);let r=new b['Matrix4']()['copy'](a['Camera']['matMV']);return a['Mode']['Camera'](q),r;};function l(){let q=a['Camera']['CameraIndex'];a['Mode']['Camera'](0x0);let r=new b['Matrix4']()['copy'](a['Camera']['matMVP']);return a['Mode']['Camera'](q),r;};function m(){let q=a['Camera']['CameraIndex'];a['Mode']['Camera'](0x0);let r=undefined;return r=new b['Vector3']()['copy'](a['Camera']['pivot']),a['Mode']['Camera'](q),r;};function n(){let q=a['Camera']['CameraIndex'];a['Mode']['Camera'](0x0);let r=undefined;if(a['Camera']['perspectiveView'])r=a['Camera']['GetPerspectiveEyePos']();else r=a['Camera']['GetCameraPos']();return a['Mode']['Camera'](q),r;};let o=![],p=undefined;this['Render']=function(){let q=r=>{let s=new b['Matrix4']()['copy'](a['Camera']['matMVP']),t=n(),u=new b['Vector3']()['copy'](t),v=a['Camera']['world2ScreenWithMatrix'](s,t),w=a['Data']['GetBBox'](),z=new b['Vector3'](c['canvas_miniview']['clientWidth']/0x2,c['canvas_miniview']['clientHeight']/0x2,w['center']['z']),A=i(v);r['shadowColor']='rgba(0,0,0,1)',r['shadowBlur']=0x1,r['shadowOffsetX']=0x1,r['shadowOffsetY']=0x1;let B=0x9;r['font']=B+'pt\x20'+'arial',r['fillStyle']='rgba(0,\x200,\x200,\x20200)';let C=0x14,D=0x14,E=undefined;r['fillStyle']='rgba(255,\x200,\x200,\x201)',E='X\x20:\x20',r['fillText'](E,C,D),E=u['x']['toFixed'](0x0),r['fillText'](E,C+0xf,D),r['fillStyle']='rgba(0,\x20255,\x200,\x201)',E='Y\x20:\x20',r['fillText'](E,C,D+0xf),E=u['y']['toFixed'](0x0),r['fillText'](E,C+0xf,D+0xf),r['fillStyle']='rgba(100,\x20100,\x20255,\x201)',r['strokeStyle']='rgba(100,\x20100,\x20255,\x201)',E='Z\x20:\x20',r['fillText'](E,C,D+0x1e),E=u['z']['toFixed'](0x0),r['fillText'](E,C+0xf,D+0x1e),r['shadowColor']='rgba(0,0,0,0.5)',r['shadowBlur']=0x3,r['shadowOffsetX']=0x0,r['shadowOffsetY']=0x0;let F=j(),G=0x41,H=new b['Vector3'](0x0,0x0,0x1);H['cross'](F),H['normalize']();let I=A['x']+H['x']*G,J=A['y']+H['y']*G,K=new b['Vector2'](I,J);function L(Q,R,S,T){let U=Math['atan2'](T-R,S-Q);return U*0xb4/Math['PI'];}let M=L(A['x'],A['y'],K['x'],K['y']);r['strokeStyle']='rgba(0,\x20255,\x200,\x201)',r['beginPath'](),r['strokeStyle']='rgba(255,\x200,\x200,\x201)',r['moveTo'](A['x'],A['y']);{let Q=new b['Vector3']()['addVectors'](new b['Vector3']()['copy'](t),new b['Vector3']()['copy'](F)['multiplyScalar'](0x64)),R=a['Renderer']['Util']['GetScreenPositionByMatrix'](s,Q);M=L(v['x'],v['y'],R['x'],R['y']);}r['stroke']();if(!![]){r['fillStyle']='rgba(255,\x20255,\x20255,\x201)',r['beginPath'](),r['fillStyle']='rgba(0,\x20255,\x200,\x201)',r['fill'](),r['globalAlpha']=0.1;let S=0x46/0x2;for(let T=0x0;T<0x7;T++){r['beginPath'](),r['moveTo'](A['x'],A['y']),r['arc'](A['x'],A['y'],0xa+0x4*T,Math['PI']/0xb4*(M-S),Math['PI']/0xb4*(M+S),![]),r['fill']();}r['closePath'](),r['fill']();}r['fillStyle']='rgba(0,\x20255,\x200,\x201)',r['globalAlpha']=0x1,r['beginPath']();for(let U=0x0;U<0x8;U++){r['arc'](A['x'],A['y'],U,0x0,Math['PI']*0x2);}r['fill'](),r['globalAlpha']=0x1;let N=m(),O=a['Camera']['world2ScreenWithMatrix'](s,N),P=i(O);r['fillStyle']='rgba(255,\x200,\x200,\x200.9)',r['beginPath'](),r['arc'](P['x'],P['y'],0x5,0x0,Math['PI']*0x2),r['fill'](),r['shadowColor']='rgba(0,0,0,0)',r['shadowBlur']=0x0,r['shadowOffsetX']=0x0,r['shadowOffsetY']=0x0;};if(a['Camera']['CameraIndex']===c['CameraIndex'])q(c['ctx_miniview']);},this['Resize']=function(){c['Option']['Visible']&&(a['Mode']['Camera'](c['CameraIndex']),a['Resize'](),a['MultiView'][c['CameraIndex']]['ClearDrawTime'](),a['Mode']['Camera'](0x0),a['ViewRefresh']());},this['Show']=function(q){c['Option']['Visible']=q;if(q)c['Resize']();c['Element']['Panel']['Show'](q),a['MultiView'][c['CameraIndex']]['Show'](q);},this['OnCloseButtonEvent']=function(q){f=q;};}}export default MiniView;