class MultiView{constructor(a,b){let c=this,d=!![];this['eventEnabled']=![],this['Container']=undefined,this['domElement']=undefined,this['canvasElement']=undefined;let e=![];this['Enable']=![];let f=0x0,g=undefined,h=undefined;this['CameraIndex']=0x0,this['CameraID']=0x0,this['UseDefaultViewColor']=!![],this['MultiViewBGColor']=new b['Color'](0xff,0xff,0xff,0xff),this['UpdateFramebuffer']=!![];let i=undefined,j=undefined,k=undefined;this['ViewEntityInfo']={'isFramebufferClear':!![],'ShowObject':!![],'ShowReview':!![],'ShowViewCube':!![],'ShowCoordinateAxis':!![],'UseControlState':{'Rotate':!![],'Pan':!![],'Zoom':!![],'Touch_Rotate':!![],'Touch_ZoomPan':!![]},'DelayTime':0x0,'UseContextMenu':!![]},this['InputControlKind']=b['Enum']['INPUT_CONTROL_KIND']['MOUSE'],this['ObjectRenderEnable']=[],this['UseisolateView']=![],this['ObjectIDs']=[],this['ObjectIDsMap']=new Map();function l(){f=0x0;}this['Init']=function(E,F,G){c['domElement']=G,c['canvasElement']=G['getContext']('2d'),c['CameraIndex']=E,c['CameraID']=F,c['eventEnabled']=![];let H=undefined;a['useWebGL2']&&(H=G['getContext']('webgl2',{'alpha':![]})),!H&&G['getContext']('webgl',{'alpha':![]});},this['Release']=function(){m();};function m(){if(!c['eventEnabled'])return;c['eventEnabled']=![];if(c['ViewEntityInfo']['UseContextMenu']===!![])c['domElement']['removeEventListener']('contextmenu',D,![]);c['domElement']['removeEventListener']('mousedown',r,![]),c['domElement']['removeEventListener']('mousewheel',u,![]),c['domElement']['removeEventListener']('DOMMouseScroll',u,![]),c['domElement']['removeEventListener']('dblclick',v,![]),c['domElement']['removeEventListener']('touchstart',w,![]),c['domElement']['removeEventListener']('touchend',y,![]),c['domElement']['removeEventListener']('touchmove',x,![]),c['domElement']['removeEventListener']('mousemove',s,![]),c['domElement']['removeEventListener']('mouseup',t,![]),c['domElement']['removeEventListener']('mouseover',q,![]),c['domElement']['removeEventListener']('mouseout',p,![]),c['domElement']['removeEventListener']('mouseenter',o,![]),window['removeEventListener']('keyup',B,![]),window['removeEventListener']('keypress',A,![]);}function n(){if(c['eventEnabled'])return;c['eventEnabled']=!![];if(c['ViewEntityInfo']['UseContextMenu']===!![])c['domElement']['addEventListener']('contextmenu',D,![]);c['domElement']['addEventListener']('mousedown',r,![]),c['domElement']['addEventListener']('mousewheel',u,![]),c['domElement']['addEventListener']('DOMMouseScroll',u,![]),c['domElement']['addEventListener']('dblclick',v,![]),c['domElement']['addEventListener']('touchstart',w,![]),c['domElement']['addEventListener']('touchend',y,![]),c['domElement']['addEventListener']('touchmove',x,![]),c['domElement']['addEventListener']('mousemove',s,![]),c['domElement']['addEventListener']('mouseup',t,![]),c['domElement']['addEventListener']('mouseover',q,![]),c['domElement']['addEventListener']('mouseout',p,![]),c['domElement']['addEventListener']('mouseenter',o,![]),window['addEventListener']('keyup',B,![]),window['addEventListener']('keydown',z,![]),window['addEventListener']('keypress',A,![]);}function o(E){if(c['eventEnabled']===![])return;}function p(E){if(c['eventEnabled']===![])return;a['Control']['MouseOut'](E);}function q(E){if(c['eventEnabled']===![])return;a['Control']['MouseOver'](E);}function r(E){if(c['eventEnabled']===![])return;c['InputControlKind']=b['Enum']['INPUT_CONTROL_KIND']['MOUSE'],l();if(document['activeElement']!==undefined)document['activeElement']['blur']();a['Container']['focus'](),a['Mode']['Camera'](c['CameraIndex']),a['Control']['MouseDown'](E),a['Mode']['Camera'](0x0);}function s(E){if(c['eventEnabled']===![])return;c['InputControlKind']=b['Enum']['INPUT_CONTROL_KIND']['MOUSE'],l(),a['Mode']['Camera'](c['CameraIndex']),a['Control']['MouseMove'](E),a['Mode']['Camera'](0x0);}function t(E){if(c['eventEnabled']===![])return;c['InputControlKind']=b['Enum']['INPUT_CONTROL_KIND']['MOUSE'],l(),a['Mode']['Camera'](c['CameraIndex']),a['Control']['MouseUp'](E),a['Mode']['Camera'](0x0);}function u(E){if(c['eventEnabled']===![])return;c['InputControlKind']=b['Enum']['INPUT_CONTROL_KIND']['MOUSE'],l(),a['Mode']['Camera'](c['CameraIndex']),a['Control']['MouseWheel'](E),a['Mode']['Camera'](0x0);}function v(E){if(c['eventEnabled']===![])return;c['InputControlKind']=b['Enum']['INPUT_CONTROL_KIND']['MOUSE'],l(),a['Mode']['Camera'](c['CameraIndex']),a['Control']['DoubleClick'](E),a['Mode']['Camera'](0x0);}function w(E){if(c['eventEnabled']===![])return;c['InputControlKind']=b['Enum']['INPUT_CONTROL_KIND']['TOUCH'],l(),a['Mode']['Camera'](c['CameraIndex']),a['Control']['TouchStart'](E),a['Mode']['Camera'](0x0);}function x(E){if(c['eventEnabled']===![])return;c['InputControlKind']=b['Enum']['INPUT_CONTROL_KIND']['TOUCH'],a['Mode']['Camera'](c['CameraIndex']),a['Control']['TouchMove'](E),a['Mode']['Camera'](0x0);}function y(E){if(c['eventEnabled']===![])return;c['InputControlKind']=b['Enum']['INPUT_CONTROL_KIND']['TOUCH'],l(),a['Mode']['Camera'](c['CameraIndex']),a['Control']['TouchEnd'](E),a['Mode']['Camera'](0x0);}function z(E){if(c['eventEnabled']===![])return;a['Mode']['Camera'](c['CameraIndex']),a['Control']['Keydown'](E),a['Mode']['Camera'](0x0);}function A(E){if(c['eventEnabled']===![])return;a['Mode']['Camera'](c['CameraIndex']),a['Control']['Keypress'](E),a['Mode']['Camera'](0x0);}function B(E){if(c['eventEnabled']===![])return;a['Mode']['Camera'](c['CameraIndex']),a['Control']['Keyup'](E),a['Mode']['Camera'](0x0);}function C(){let E=c['domElement'],F=a['Canvas_Review'],G=![];if(f===0x0)f=new Date()['getTime'](),g=a['Renderer']['GetImageDataFromBuffer'](b['Enum']['FB_RENDER_TYPES']['END']),G=!![],c['Enable']=!![];else{let O=new Date()['getTime'](),P=O-f;P>c['ViewEntityInfo']['DelayTime']?(f=0x0,g=a['Renderer']['GetImageDataFromBuffer'](b['Enum']['FB_RENDER_TYPES']['END']),G=!![],c['Enable']=!![]):c['Enable']=![];}if(![]){let Q=document['createElement']('canvas');Q['id']=a['Container']['id']+'canvasbuffer',Q['width']=g['width'],Q['height']=g['height'];let R=Q['getContext']('2d');R['imageSmoothingEnabled']=![];let S=Q['width'],T=Q['height'];E['width']=S,E['height']=T;let U=E['getContext']('2d');U['clearRect'](0x0,0x0,E['width'],E['height']);let V=R['createImageData'](g['width'],g['height']);V['data']['set'](g['data']),R['putImageData'](V,0x0,0x0);let W=Math['min'](E['width']/g['width'],E['height']/g['height']),X=E['width']/0x2-g['width']/0x2*W,Y=E['height']/0x2-g['height']/0x2*W,Z=g['width']*W,a0=g['height']*W;U['imageSmoothingEnabled']=![],U['drawImage'](Q,X,Y,g['width']*W,g['height']*W),U['drawImage'](F,X,Y,F['width']*W,F['height']*W);}i===undefined&&(i=document['createElement']('canvas'),i['id']=a['Container']['id']+'canvasbuffer');i['width']=g['width'],i['height']=g['height'];j===undefined&&(j=i['getContext']('2d'),j['imageSmoothingEnabled']=![]);let H=i['width'],I=i['height'];E['width']=H,E['height']=I;k===undefined&&(k=E['getContext']('2d'));k['clearRect'](0x0,0x0,E['width'],E['height']);G&&(h=j['createImageData'](g['width'],g['height']),h['data']['set'](g['data']));j['putImageData'](h,0x0,0x0);let J=Math['min'](E['width']/g['width'],E['height']/g['height']),K=E['width']/0x2-g['width']/0x2*J,L=E['height']/0x2-g['height']/0x2*J,M=g['width']*J,N=g['height']*J;k['imageSmoothingEnabled']=![],k['drawImage'](i,K,L,g['width']*J,g['height']*J),k['drawImage'](F,K,L,F['width']*J,F['height']*J);}function D(E){if(c['enabled']===![])return;if(a['Configuration']['ContextMenu']['Use']===![]){E['preventDefault']();return;}a['Mode']['Camera'](c['CameraIndex']),a['Control']['Contextmenu'](E),a['Mode']['Camera'](0x0);}this['Lock']=function(){m();},this['Unlock']=function(){n();},this['Visible']=function(){return e;},this['Show']=function(E){e=E;if(e)n();else m();c['Container']!==undefined&&(E===!![]?c['Container']['style']['display']='block':c['Container']['style']['display']='none');if(e){if(a['Camera']['CameraIndex']!==c['CameraIndex']){let F=a['Camera']['CameraIndex'];a['Mode']['Camera'](c['CameraIndex']),a['Camera']['clientWidth']=c['domElement']['clientWidth'],a['Camera']['clientHeight']=c['domElement']['clientHeight'],a['Camera']['ResizeGLWindow'](),d&&(a['Camera']['FitAll'](),d=![]),a['Shader']['Resize'](!![]),c['ClearDrawTime'](),a['Renderer']['Render'](),a['Mode']['Camera'](F);}else c['ClearDrawTime'](),c['Draw']();}},this['Draw']=function(){if(e){a['Camera']['CameraIndex']===c['CameraIndex']&&(a['Grid']['Render'](a['gl'],a['ctx_review'],!![]),C());if(a['useMiniView'])a['MiniView']['Render']();}},this['ClearDrawTime']=function(){l();},this['SetISOlateView']=function(E,F){c['UseisolateView']=E;E?(c['ObjectIDsMap']['clear'](),c['ObjectIDs']=F,c['Enable']=!![],F['forEach'](G=>{c['ObjectIDsMap']['set'](G,G);})):(c['ObjectIDs']=[],c['ObjectIDsMap']['clear']());a['RenderWGL']['listMultiviewObjectManager']['splice'](0x0,a['RenderWGL']['listMultiviewObjectManager']['length']),a['RenderWGL']['listMultiviewObjectManager']['push']([0x0]);for(let G=0x0;G<a['Data']['Objects']['length'];G++){let H=a['Data']['Objects'][G];for(let I=0x0;I<H['tag']['length'];I++){let J=H['tag'][I],K=0x0,L=![],M=-0x1,N=[0x0];for(let P=0x1;P<a['MultiView']['length'];P++){if(!a['MultiView'][P]['Visible']())continue;if(!a['MultiView'][P]['UseisolateView'])continue;let Q=a['MultiView'][P]['ObjectIDsMap']['get'](J['bodyId']);if(Q===undefined)continue;const R=N['findIndex'](S=>S===P);if(R>=0x0)continue;N['push'](P),L=!![];}if(L){N['sort']();for(let S=0x0;S<a['RenderWGL']['listMultiviewObjectManager']['length'];S++){let T=a['RenderWGL']['listMultiviewObjectManager'][S];if(T['length']!==N['length'])continue;let U=0x0;for(let V=0x0;V<N['length'];V++){let W=T['findIndex'](X=>X===N[V]);if(W>=0x0)continue;U++;}if(U!==N['length'])continue;M=S;break;}M<0x0?(a['RenderWGL']['listMultiviewObjectManager']['push'](N),K=a['RenderWGL']['listMultiviewObjectManager']['length']-0x1):K=M;}let O=a['Data']['ShapeAction']['GetAction'](J['object']['id_file'],J['origin_id']);O['multiViewIdx']=K;}H['flag']['updateProcess']=!![];}a['ViewRefresh']();},this['SetBGColor']=function(E,F){c['UseDefaultViewColor']=!E,c['MultiViewBGColor']=F;},this['IsUseControlState']=function(E){switch(E){case b['Enum']['MOUSE_STATE']['ROTATE']:return c['ViewEntityInfo']['UseControlState']['Rotate'];case b['Enum']['MOUSE_STATE']['ZOOM']:return c['ViewEntityInfo']['UseControlState']['Zoom'];case b['Enum']['MOUSE_STATE']['PAN']:return c['ViewEntityInfo']['UseControlState']['Pan'];case b['Enum']['MOUSE_STATE']['TOUCH_ROTATE']:return c['ViewEntityInfo']['UseControlState']['Touch_Rotate'];case b['Enum']['MOUSE_STATE']['TOUCH_ZOOM_PAN']:return c['ViewEntityInfo']['UseControlState']['Touch_ZoomPan'];}return!![];},this['BeginUpdateFramebuffer']=function(){c['UpdateFramebuffer']=!![],c['ObjectRenderEnable']=[];for(let E=0x0,F=a['Data']['ObjectsUpdateLength'];E<F;E++){c['ObjectRenderEnable'][E]=!![];}},this['EndUpdateFramebuffer']=function(){c['UpdateFramebuffer']=![];for(let E=0x0,F=c['ObjectRenderEnable']['length'];E<F;E++){if(a['Data']['Objects'][E]['attribs']['a_index']['buffer']===null)continue;c['ObjectRenderEnable'][E]=![];}};}}export default MultiView;