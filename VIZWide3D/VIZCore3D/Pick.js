class Pick{constructor(a,b){let c=this;this['PreselectObjects']=[],this['PreselectEdges']=[];let d=[],e=new b['Color'](0x0,0x0,0x0,0xff),f=new b['Color'](0x0,0xc8,0x0,0xff),g=0xa,h=0x3;this['EnableControlPicker']=![];let i=![],j=new b['Vector3'](),k=0x1,l=0x48,m=0x50,n=![],o=undefined;this['EnableControlMove']=!![],this['EnableControlOk']=![],this['EnableControlCancel']=![],p();function p(){for(let t=0x0;t<0x4;t++){c['PreselectObjects'][t]=a['Data']['Object3D']();}};this['GetPickByBody']=function(t,u,v){let w;if(a['Camera']['perspectiveView'])w=new b['Vector3'](u,v,0x0);else w=new b['Vector3'](u,v,-0x1);let z=new b['Vector3'](w['x'],w['y'],w['z']),A=new b['Vector3'](w['x'],w['y'],0x1),B,C;B=a['Camera']['screen2WorldWithMatrix'](a['Camera']['matMVP'],z),C=a['Camera']['screen2WorldWithMatrix'](a['Camera']['matMVP'],A);let D=c['GetWorldPickByID'](t,B,C);return D;},this['GetBodyCacheDownload']=function(t,u){if(a['MeshBlock']['IsCacheBlockDownloading']())return;if(u===undefined)return;let v=a['Data']['GetBody'](t);if(v===undefined||v['length']===0x0)return;let w=a['CameraIndex'],x=function(){a['MultiView'][w]['Unlock']();},y=v[0x0],z=function(B){a['MeshBlock']['IsCacheBlockDownloading']()===![]&&(u(t),x());};a['Control']['Lock']();let A=[];if(!y['object']['flag']['cache']||y['object']['attribs']['a_index']['buffer']===null){let B=function(C,D,E){for(let F=0x0;F<C['length'];F++){if(y['object']['uuid']!==C[F]['uuid'])continue;A['push'](D);break;}};a['Data']['ObjectMap']['forEach'](B);if(A['length']>0x1)console['log']('[Shw3DCore]\x20URL\x20cache\x20Num\x20:\x20'+A['length']);a['MeshBlock']['CacheBlock'](A,z);}else setTimeout(z,0x1);},this['GetPickByBodyCacheDownload']=function(t,u,v){if(a['MeshBlock']['IsCacheBlockDownloading']())return;if(v===undefined)return;const w=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),z=new b['Matrix4']()['multiplyMatrices'](a['Camera']['projectionMatrix'],w);let A=![],B=undefined,C=undefined,D=undefined,E=function(I,J){D=J;},F=a['Renderer']['PickingCallback'](t,u,c,E,undefined);if(!F)return;let G=function(I){const J=c['GetPickByBody'](D['bodyId'],t,u);if(J['pick']){A=!![];let K=new b['Vector3']()['copy'](J['position']);const L=a['Camera']['world2ScreenWithMatrix'](z,K);if(C===undefined)C=J,B=L;else L['z']<B['z']&&(C=J,B=L);}if(a['MeshBlock']['IsCacheBlockDownloading']()===![]){if(A)v(C);a['Control']['Unlock']();}};a['Control']['Lock']();let H=[];if(!D['object']['flag']['cache']||D['object']['attribs']['a_index']['buffer']===null){let I=function(J,K,L){for(let M=0x0;M<J['length'];M++){if(D['object']['uuid']!==J[M]['uuid'])continue;H['push'](K);break;}};a['Data']['ObjectMap']['forEach'](I);if(H['length']===0x0){let J=function(){const K=a['Renderer']['PickPositionObject'](t,u);if(K!==undefined)v(C);a['Control']['Unlock']();};setTimeout(J,0x1);return;}if(H['length']>0x1)console['log']('[Shw3DCore]\x20URL\x20cache\x20Num\x20:\x20'+H['length']);a['MeshBlock']['CacheBlock'](H,G);}else setTimeout(G,0x1);},this['GetWorldPickByID']=function(t,u,v){let w=a['Data']['GetBody'](t);return c['GetWorldPick'](w,u,v);},this['GetWorldPick']=function(t,u,v){if(t===undefined)return a['Data']['PickDataItem']();let w,x;w=new b['Vector3']()['copy'](u),x=new b['Vector3']()['copy'](v);let y=![],z,A=a['Data']['PickDataItem']();for(let B=0x0;B<t['length'];B++){let C=t[B],D=a['Data']['ShapeAction']['GetAction'](C['object']['id_file'],C['origin_id']),E=C['BBox']['min'],F=C['BBox']['max'],G=[new b['Vector3'](E['x'],E['y'],E['z']),new b['Vector3'](E['x'],E['y'],F['z']),new b['Vector3'](E['x'],F['y'],E['z']),new b['Vector3'](E['x'],F['y'],F['z']),new b['Vector3'](F['x'],E['y'],E['z']),new b['Vector3'](F['x'],E['y'],F['z']),new b['Vector3'](F['x'],F['y'],E['z']),new b['Vector3'](F['x'],F['y'],F['z'])],H=[[0x0,0x1,0x2],[0x1,0x2,0x3],[0x4,0x5,0x6],[0x5,0x6,0x7],[0x0,0x2,0x4],[0x2,0x4,0x6],[0x1,0x3,0x5],[0x3,0x5,0x7],[0x2,0x3,0x6],[0x3,0x6,0x7],[0x0,0x1,0x4],[0x1,0x4,0x5]],I=new b['Matrix4'](),J=![];if(D['transform']['equals'](I)===![])J=!![];if(J)for(let K=0x0;K<0x8;++K){G[K]['applyMatrix4'](D['transform']);}if(a['useFramebuffer']&&C['object']['attribs']['a_index']['array']['length']<=0x0){for(let L=0x0;L<0xc;++L){let M=a['Util']['LineToTriangleIntersections'](w,x,G[H[L][0x0]],G[H[L][0x1]],G[H[L][0x2]]);if(M[0x0]===0x1){let N=new b['Vector3']()['subVectors'](w,M[0x1])['length']();if(y===![])y=!![],z=N,A['pick']=!![],A['position']=M[0x1],A['normal']=new b['Plane']()['setFromCoplanarPoints'](G[H[L][0x0]],G[H[L][0x1]],G[H[L][0x2]])['normal'],A['body']=C;else N<z&&(z=N,A['pick']=!![],A['position']=M[0x1],A['normal']=new b['Plane']()['setFromCoplanarPoints'](G[H[L][0x0]],G[H[L][0x1]],G[H[L][0x2]])['normal'],A['body']=C);}}continue;}else{let O=![];for(let P=0x0;P<0xc;++P){let Q=a['Util']['LineToTriangleIntersections'](w,x,G[H[P][0x0]],G[H[P][0x1]],G[H[P][0x2]]);if(Q[0x0]===0x1){O=!![];break;}}if(!O)continue;}for(let R=C['m_triIdx'];R<C['m_triIdx']+C['m_nTris'];R+=0x3){let S,T,U;S=C['object']['attribs']['a_index']['array'][R],T=C['object']['attribs']['a_index']['array'][R+0x1],U=C['object']['attribs']['a_index']['array'][R+0x2];let V=new b['Vector3'](C['object']['attribs']['a_position']['array'][S*0x3+0x0],C['object']['attribs']['a_position']['array'][S*0x3+0x1],C['object']['attribs']['a_position']['array'][S*0x3+0x2]),W=new b['Vector3'](C['object']['attribs']['a_position']['array'][T*0x3+0x0],C['object']['attribs']['a_position']['array'][T*0x3+0x1],C['object']['attribs']['a_position']['array'][T*0x3+0x2]),X=new b['Vector3'](C['object']['attribs']['a_position']['array'][U*0x3+0x0],C['object']['attribs']['a_position']['array'][U*0x3+0x1],C['object']['attribs']['a_position']['array'][U*0x3+0x2]),Y=new b['Vector3']()['copy'](V),Z=new b['Vector3']()['copy'](W),a0=new b['Vector3']()['copy'](X);J&&(Y['applyMatrix4'](D['transform']),Z['applyMatrix4'](D['transform']),a0['applyMatrix4'](D['transform']));let a1=a['Util']['LineToTriangleIntersections'](w,x,Y,Z,a0);if(a1[0x0]===0x1){if(!a['Clipping']['IsClippingPosition'](a1[0x1])){let a2=new b['Vector3']()['subVectors'](w,a1[0x1])['length']();if(y===![]){y=!![],z=a2,A['pick']=!![],A['position']=a1[0x1],A['normal']=new b['Plane']()['setFromCoplanarPoints'](Y,Z,a0)['normal'],A['surface']=!![],A['triangle']['vertex']['v1']=Y,A['triangle']['vertex']['v2']=Z,A['triangle']['vertex']['v3']=a0;if(C['object']['attribs']['a_normal']['array']===undefined||C['object']['attribs']['a_normal']['array']['length']===0x0)A['triangle']['normal']['v1']['copy'](A['normal']),A['triangle']['normal']['v2']['copy'](A['normal']),A['triangle']['normal']['v3']['copy'](A['normal']);else{A['triangle']['normal']['v1']['set'](C['object']['attribs']['a_normal']['array'][S*0x3+0x0],C['object']['attribs']['a_normal']['array'][S*0x3+0x1],C['object']['attribs']['a_normal']['array'][S*0x3+0x2]),A['triangle']['normal']['v2']['set'](C['object']['attribs']['a_normal']['array'][T*0x3+0x0],C['object']['attribs']['a_normal']['array'][T*0x3+0x1],C['object']['attribs']['a_normal']['array'][T*0x3+0x2]),A['triangle']['normal']['v3']['set'](C['object']['attribs']['a_normal']['array'][U*0x3+0x0],C['object']['attribs']['a_normal']['array'][U*0x3+0x1],C['object']['attribs']['a_normal']['array'][U*0x3+0x2]);if(J){let a3=new b['Matrix4']()['copy'](D['transform']);a3['setPosition'](new b['Vector3']()),A['triangle']['normal']['v1']=a3['multiplyVector'](A['triangle']['normal']['v1']),A['triangle']['normal']['v2']=a3['multiplyVector'](A['triangle']['normal']['v2']),A['triangle']['normal']['v3']=a3['multiplyVector'](A['triangle']['normal']['v3']);}}A['triangle']['index'][0x0]=S,A['triangle']['index'][0x1]=T,A['triangle']['index'][0x2]=U,A['body']=C;}else{if(a2<z){z=a2,A['pick']=!![],A['position']=a1[0x1],A['normal']=new b['Plane']()['setFromCoplanarPoints'](Y,Z,a0)['normal'],A['surface']=!![],A['triangle']['vertex']['v1']=Y,A['triangle']['vertex']['v2']=Z,A['triangle']['vertex']['v3']=a0;if(C['object']['attribs']['a_normal']['array']===undefined||C['object']['attribs']['a_normal']['array']['length']===0x0)A['triangle']['normal']['v1']['copy'](A['normal']),A['triangle']['normal']['v2']['copy'](A['normal']),A['triangle']['normal']['v3']['copy'](A['normal']);else{A['triangle']['normal']['v1']['set'](C['object']['attribs']['a_normal']['array'][S*0x3+0x0],C['object']['attribs']['a_normal']['array'][S*0x3+0x1],C['object']['attribs']['a_normal']['array'][S*0x3+0x2]),A['triangle']['normal']['v2']['set'](C['object']['attribs']['a_normal']['array'][T*0x3+0x0],C['object']['attribs']['a_normal']['array'][T*0x3+0x1],C['object']['attribs']['a_normal']['array'][T*0x3+0x2]),A['triangle']['normal']['v3']['set'](C['object']['attribs']['a_normal']['array'][U*0x3+0x0],C['object']['attribs']['a_normal']['array'][U*0x3+0x1],C['object']['attribs']['a_normal']['array'][U*0x3+0x2]);if(J){let a4=new b['Matrix4']()['copy'](D['transform']);a4['setPosition'](new b['Vector3']()),A['triangle']['normal']['v1']=a4['multiplyVector'](A['triangle']['normal']['v1']),A['triangle']['normal']['v2']=a4['multiplyVector'](A['triangle']['normal']['v2']),A['triangle']['normal']['v3']=a4['multiplyVector'](A['triangle']['normal']['v3']);}}A['triangle']['index'][0x0]=S,A['triangle']['index'][0x1]=T,A['triangle']['index'][0x2]=U,A['body']=C;}}}}}}return A;},this['GetPreselectPick']=function(t,u,v){let w=a['Renderer']['PickingPreselectData'](t,u);if(w===undefined)return undefined;let z=c['PreselectEdges'][w['index']],A=a['Data']['PickDataItem']();A['pick']=!![],A['surface']=![],A['body']=undefined,A['preselectKind']=w['pickKind'],A['preselect']=a['Data']['PreselectEdgeItem'](),A['preselect']['id']=z['id'],A['preselect']['kind']=z['kind'];for(let C=0x0;C<z['vData']['length'];C++){A['preselect']['vData'][C]=new b['Vector3']()['copy'](z['vData'][C]);}A['preselect']['fValue']=z['fValue'];let B=new b['Matrix4']();{let D=undefined;if(a['useTree'])D=a['Tree']['GetBodies']([c['PreselectObjects'][0x0]['index']]);else D=a['Data']['GetBodies']([c['PreselectObjects'][0x0]['index']]);if(D!==undefined&&D['length']>0x0){let E=a['Data']['ShapeAction']['GetAction'](D[0x0]['object']['id_file'],D[0x0]['origin_id']);E['transform']!==undefined&&B['copy'](E['transform']);}}if(w['pickKind']===b['Enum']['PRESELECT_PICK_KIND']['EDGE'])A['preselect']['vData'][0x0]=B['multiplyVector'](A['preselect']['vData'][0x0]),A['preselect']['vData'][0x1]=B['multiplyVector'](A['preselect']['vData'][0x1]);else{if(w['pickKind']===b['Enum']['PRESELECT_PICK_KIND']['EDGE_START'])A['preselect']['vData'][0x0]=B['multiplyVector'](A['preselect']['vData'][0x0]),A['preselect']['vData'][0x1]=B['multiplyVector'](A['preselect']['vData'][0x1]),A['position']['copy'](A['preselect']['vData'][0x0]);else{if(w['pickKind']===b['Enum']['PRESELECT_PICK_KIND']['EDGE_END'])A['preselect']['vData'][0x0]=B['multiplyVector'](A['preselect']['vData'][0x0]),A['preselect']['vData'][0x1]=B['multiplyVector'](A['preselect']['vData'][0x1]),A['position']['copy'](A['preselect']['vData'][0x1]);else{if(w['pickKind']===b['Enum']['PRESELECT_PICK_KIND']['EDGE_MID'])A['preselect']['vData'][0x0]=B['multiplyVector'](A['preselect']['vData'][0x0]),A['preselect']['vData'][0x1]=B['multiplyVector'](A['preselect']['vData'][0x1]),A['position']=new b['Vector3']()['addVectors'](A['preselect']['vData'][0x0],A['preselect']['vData'][0x1])['multiplyScalar'](0.5);else{if(w['pickKind']===b['Enum']['PRESELECT_PICK_KIND']['CIRCLE_CENTER']){let F=new b['Matrix4']()['copy'](B);F['setPosition'](new b['Vector3']()),A['preselect']['vData'][0x0]=F['multiplyVector'](A['preselect']['vData'][0x0]),A['preselect']['vData'][0x1]=F['multiplyVector'](A['preselect']['vData'][0x1]),A['preselect']['vData'][0x2]=B['multiplyVector'](A['preselect']['vData'][0x2]),A['preselect']['vData'][0x3]=F['multiplyVector'](A['preselect']['vData'][0x3]),A['position']['copy'](A['preselect']['vData'][0x2]),A['normal']['copy'](A['preselect']['vData'][0x3]);}else{if(w['pickKind']===b['Enum']['PRESELECT_PICK_KIND']['CIRCLE']){let G=new b['Matrix4']()['copy'](B);G['setPosition'](new b['Vector3']()),A['preselect']['vData'][0x0]=G['multiplyVector'](A['preselect']['vData'][0x0]),A['preselect']['vData'][0x1]=G['multiplyVector'](A['preselect']['vData'][0x1]),A['preselect']['vData'][0x2]=B['multiplyVector'](A['preselect']['vData'][0x2]),A['preselect']['vData'][0x3]=G['multiplyVector'](A['preselect']['vData'][0x3]),A['normal']['copy'](A['preselect']['vData'][0x3]);}}}}}}return v!==undefined&&v(A),A;},this['GetPreselectDataPick']=function(t,u){let v=a['Renderer']['PickingPreselectData'](t,u);return v;},this['GetPreselectDataByID']=function(t){for(let u=0x0;u<d['length'];u++){if(d[u]['id']!==t)continue;return d[u];}return undefined;},this['GetMakePreselectID']=function(){for(let t=0x0;t<c['PreselectObjects']['length'];t++){return c['PreselectObjects'][t]['index'];}return-0x1;},this['MakeMeasurePreselectInfoByBodyCache']=function(t){c['GetBodyCacheDownload'](t,c['MakeMeasurePreselectInfoByID']);},this['MakeMeasurePreselectInfoByID']=function(t){let u=undefined;return a['useTree']?u=a['Tree']['GetBodies']([t]):u=a['Data']['GetBodies']([t]),c['MakeMeasurePreselectInfo'](u);},this['MakeMeasurePreselectInfo']=function(t){let u=a['Data']['GetTriangles'](t);c['ReleaseMeasurePreselectInfo']();if(t['length']===0x0)return![];for(let N=0x0;N<c['PreselectObjects']['length'];N++){c['PreselectObjects'][N]['index']=t[0x0]['bodyId'],c['PreselectObjects'][N]['id_file']=t[0x0]['object']['id_file'];}{let O=c['PreselectObjects'][0x0],P=0x0,Q=0x0;for(let R=0x0;R<u['length'];R++){let S=P;O['attribs']['a_position']['array'][S]=u[R]['vertex']['v1']['x'],S++,O['attribs']['a_position']['array'][S]=u[R]['vertex']['v1']['y'],S++,O['attribs']['a_position']['array'][S]=u[R]['vertex']['v1']['z'],S++,O['attribs']['a_index']['array'][Q]=Q,Q++,O['attribs']['a_position']['array'][S]=u[R]['vertex']['v2']['x'],S++,O['attribs']['a_position']['array'][S]=u[R]['vertex']['v2']['y'],S++,O['attribs']['a_position']['array'][S]=u[R]['vertex']['v2']['z'],S++,O['attribs']['a_index']['array'][Q]=Q,Q++,O['attribs']['a_position']['array'][S]=u[R]['vertex']['v3']['x'],S++,O['attribs']['a_position']['array'][S]=u[R]['vertex']['v3']['y'],S++,O['attribs']['a_position']['array'][S]=u[R]['vertex']['v3']['z'],S++,O['attribs']['a_index']['array'][Q]=Q,Q++,P=S;}Q>0x0&&(O['attribs']['a_position']['array']=new Float32Array(O['attribs']['a_position']['array'],0x0,O['attribs']['a_position']['array']['length']),O['attribs']['a_index']['array']=new Uint32Array(O['attribs']['a_index']['array'],0x0,O['attribs']['a_index']['array']['length']));}{for(let T=u['length']-0x1;T>=0x0;T--){let U=u[T];(U['vertex']['v1']['equals'](U['vertex']['v2'])||U['vertex']['v2']['equals'](U['vertex']['v3'])||U['vertex']['v3']['equals'](U['vertex']['v1']))&&u['splice'](T,0x1);}}let v=u['length'];if(v>0x7530)return c['ReleaseMeasurePreselectInfo'](),![];let w=function(V){let W={'triangle':V,'closedTriangleIndex':[],'fValue':0x0};for(let X=0x0;X<0x3;X++){W['closedTriangleIndex'][X]=[-0x1,-0x1];}return W;},x=0x1,y=0.00001,z=[];if(u['length']>0x0){for(let V=u['length']-0x1;V=0x0;V--){let W=u[V];W['fValue']=W['vertex']['v1']['x']+W['vertex']['v1']['y']+W['vertex']['v1']['z']+W['vertex']['v2']['x']+W['vertex']['v2']['y']+W['vertex']['v2']['z']+W['vertex']['v3']['x']+W['vertex']['v3']['y']+W['vertex']['v3']['z'];}u['sort'](function(X,Y){if(X['fValue']>Y['fValue'])return 0x1;if(X['fValue']<Y['fValue'])return-0x1;return 0x0;});for(let X=0x0;X<v;X++){z[X]=w(u[X]);}for(let Y=0x0;Y<v;Y++){let Z=z[Y];for(let a0=0x0;a0<0x3;a0++){if(Z['closedTriangleIndex'][a0][0x0]>=0x0)continue;let a1=new b['Vector3']()['copy'](Z['triangle']['normal']),a2=[Z['triangle']['vertex']['v1'],Z['triangle']['vertex']['v2'],Z['triangle']['vertex']['v3']],a3=![];for(let a4=Y+0x1;a4<v;a4++){let a5=z[a4],a6=new b['Vector3']()['copy'](a5['triangle']['normal']),a7=[a5['triangle']['vertex']['v1'],a5['triangle']['vertex']['v2'],a5['triangle']['vertex']['v3']];for(let a8=0x0;a8<0x3;a8++){if(a5['closedTriangleIndex'][a8][0x0]>=0x0)continue;if(u[Y]['index'][a0]===u[a4]['index'][a8]&&u[Y]['index'][(a0+0x1)%0x3]===u[a4]['index'][(a8+0x1)%0x3]||u[Y]['index'][a0]===u[a4]['index'][(a8+0x1)%0x3]&&u[Y]['index'][(a0+0x1)%0x3]===u[a4]['index'][a8]){a3=!![],z[Y]['closedTriangleIndex'][a0][0x0]=a4,z[Y]['closedTriangleIndex'][a0][0x1]=a8,z[a4]['closedTriangleIndex'][a8][0x0]=Y,z[a4]['closedTriangleIndex'][a8][0x1]=a0;break;}}if(a3)break;}}}}let A=0x0,B=0x0;for(let a9=0x0;a9<v;a9++){let aa=z[a9];for(let ab=0x0;ab<0x3;ab++){A++;if(aa['closedTriangleIndex'][ab][0x0]<0x0)B++;}}if(B===0x0)return![];let C=function(){let ac={'vPos':[],'vNormal':[],'blockIndex':0x0,'index':[],'linkedEdgeIndex':[],'bProcessed':![],'fLength':0x0,'fCosAngle':0x0};for(let ad=0x0;ad<0x2;ad++){ac['vPos'][ad]=new b['Vector3'](),ac['vNormal'][ad]=new b['Vector3'](),ac['index'][ad]=-0x1,ac['linkedEdgeIndex'][ad]=[];for(let ae=0x0;ae<0x2;ae++){ac['linkedEdgeIndex'][ad][ae]=-0x1;}}return ac;},D=![],E=![],F=![],G=![],H=[],I=0x0;for(let ac=0x0;ac<v;ac++){let ad=z[ac];for(let ae=0x0;ae<0x3;ae++){if(ad['closedTriangleIndex'][ae][0x0]<0x0){let af=C();af['vPos'][0x0]=a['Util']['GetTrianglePos'](ad['triangle'],ae),af['vPos'][0x1]=a['Util']['GetTrianglePos'](ad['triangle'],(ae+0x1)%0x3),af['vNormal'][0x0]=a['Util']['GetTriangleItemIdxNormal'](ad['triangle'],ae),af['vNormal'][0x1]=a['Util']['GetTriangleItemIdxNormal'](ad['triangle'],(ae+0x1)%0x3),af['index'][0x0]=ad['triangle']['index'][ae],af['index'][0x1]=ad['triangle']['index'][(ae+0x1)%0x3];for(let ag=0x0;ag<0x2;ag++)for(let ah=0x0;ah<0x2;ah++)af['linkedEdgeIndex'][ag][ah]=-0x1;af['bProcessed']=![],af['fLength']=new b['Vector3']()['subVectors'](af['vPos'][0x0],af['vPos'][0x1])['length'](),H[I]=af,I++;}}}let J=0x0;for(let ai=0x0;ai<B;ai++){for(let aj=0x0;aj<0x2;aj++){if(H[ai]['linkedEdgeIndex'][aj][0x0]>=0x0)continue;let ak=![];for(let al=ai+0x1;al<B;al++){if(H[ai]['blockIndex']!==H[al]['blockIndex'])continue;for(let am=0x0;am<0x2;am++){if(H[al]['linkedEdgeIndex'][am][0x0]>=0x0)continue;if(H[ai]['index'][aj]===H[al]['index'][am]){ak=!![],H[ai]['linkedEdgeIndex'][aj][0x0]=al,H[ai]['linkedEdgeIndex'][aj][0x1]=am,H[al]['linkedEdgeIndex'][am][0x0]=ai,H[al]['linkedEdgeIndex'][am][0x1]=aj,J++;break;}}if(ak)break;}}}let K=0x1388,L=0x0,M=0x0;for(let an=0x0;an<B;an++){if(H[an]['bProcessed'])continue;if(H[an]['linkedEdgeIndex'][0x0][0x0]<0x0&&H[an]['linkedEdgeIndex'][0x1][0x0]<0x0||G||D){c['AddPreselectEdgeByLine'](x,H[an]['vPos'][0x0],H[an]['vPos'][0x1],0x0),x++,H[an]['bProcessed']=!![],L++;continue;}let ao=an,ap=H[an]['linkedEdgeIndex'][0x0][0x0],aq=H[an]['linkedEdgeIndex'][0x0][0x1];ap<0x0&&(ap=H[an]['linkedEdgeIndex'][0x1][0x0],aq=H[an]['linkedEdgeIndex'][0x1][0x1]);let ar=0x0;for(let az=0x0;az<B;az++){let aA=H[ap]['linkedEdgeIndex'][0x1-aq][0x0],aB=H[ap]['linkedEdgeIndex'][0x1-aq][0x1];if(aA<0x0||aA===ao)break;ap=aA,aq=aB,ar++;}ar=0x1,aq=H[ap]['linkedEdgeIndex'][0x0][0x1];if(H[ap]['linkedEdgeIndex'][0x0][0x0]<0x0)aq=H[ap]['linkedEdgeIndex'][0x1][0x1];let as,at;as=ap,at=aq;let au,av,aw,ax,ay;au=new b['Vector3']()['subVectors'](H[as]['vPos'][at],H[as]['vPos'][0x1-at]),aw=H[as]['fLength'],ay=H[as];for(let aC=0x0;aC<B;aC++){let aD=H[as]['linkedEdgeIndex'][at][0x0],aE=0x1-H[as]['linkedEdgeIndex'][at][0x1];as=aD,at=aE;if(as<0x0||as===ap)break;av=new b['Vector3']()['subVectors'](H[as]['vPos'][at],H[as]['vPos'][0x1-at]),ax=H[as]['fLength'],ax>1e-7&&aw>1e-7&&(ay['fCosAngle']=av['dot'](au)/ax/aw),au=av,aw=ax,ay=H[as],ar++;}as=ap,at=aq;for(let aF=0x0;aF<ar;aF++){if(aF>ar-0x4||E){for(let aH=aF;aH<ar;aH++){if(at>0x0){c['AddPreselectEdgeByLine'](x,H[as]['vPos'][at-0x1],H[as]['vPos'][at],0x0),x++,H[as]['bProcessed']=!![],L++,as=H[as]['linkedEdgeIndex'][at][0x0],at=0x1-H[as]['linkedEdgeIndex'][at][0x1];if(as<0x0||as===ap)break;}}break;}let aG=0x1;{let aI,aJ,aK=as,aL=at;for(let aM=aF;aM<ar-0x1;aM++){if(aM===aF){aI=H[aK]['fCosAngle'],aJ=H[aK]['fLength'];if(aI<0.7071||aI>0.9999)break;aG++;}else{if(Math['abs'](aI-H[aK]['fCosAngle'])>0.005)break;if(Math['abs'](aJ-H[aK]['fLength'])>Math['max'](aJ*0.01,H[aK]['fLength']*0.01))break;aG++;}aK=H[aK]['linkedEdgeIndex'][aL][0x0],aL=0x1-H[aK]['linkedEdgeIndex'][aL][0x1];if(aK<0x0||aK===ap)break;}}{let aN=H[as]['linkedEdgeIndex'][at][0x0],aO=0x1-H[as]['linkedEdgeIndex'][at][0x1];if(H[as]['vPos'][0x1-at]!=H[as]['vPos'][at]&&H[as]['vPos'][at]!=H[aN]['vPos'][aO]&&H[as]['vPos'][0x1-at]!=H[aN]['vPos'][aO]){let aP=a['Util']['GetCircleCenterPTFrom3Pt'](H[as]['vPos'][0x1-at],H[as]['vPos'][at],H[aN]['vPos'][aO]),aQ=new b['Vector3']()['subVectors'](aP,H[as]['vPos'][at])['length']();if(aQ>K)aG=0x0;}else aG=0x0;}if(aG>=0x4){let aR=H[as]['linkedEdgeIndex'][at][0x0],aS=0x1-H[as]['linkedEdgeIndex'][at][0x1],aT=a['Util']['GetCircleCenterPTFrom3Pt'](H[as]['vPos'][0x1-at],H[as]['vPos'][at],H[aR]['vPos'][aS]),aU=new b['Vector3']()['subVectors'](aT,H[as]['vPos'][at])['length']();aU=new b['Vector3']()['subVectors'](aT,H[as]['vPos'][0x1-at])['length'](),aU=new b['Vector3']()['subVectors'](aT,H[aR]['vPos'][aS])['length']();let aV=new b['Vector3']()['subVectors'](H[as]['vPos'][0x1-at],H[as]['vPos'][at]);aV=new b['Vector3']()['crossVectors'](aV,new b['Vector3']()['subVectors'](H[aR]['vPos'][aS],H[as]['vPos'][at])),aV['normalize']();if(F){{c['AddPreselectEdgeByLine'](x,H[as]['vPos'][0x1-at],H[as]['vPos'][at],0x0),x++,H[as]['bProcessed']=!![],L++,as=H[as]['linkedEdgeIndex'][at][0x0],at=0x1-H[as]['linkedEdgeIndex'][at][0x1];}c['AddPreselectEdgeByLine'](x,aT,aT,0x0),x++;}else{M++;for(let aW=0x0;aW<aG;aW++){c['AddPreselectEdgeByCircle'](x,H[as]['vPos'][0x1-at],H[as]['vPos'][at],aT,aV,aU),H[as]['bProcessed']=!![],as=H[as]['linkedEdgeIndex'][at][0x0],at=0x1-H[as]['linkedEdgeIndex'][at][0x1];if(as<0x0||as===ap)break;}x++;}}else at>0x0&&(c['AddPreselectEdgeByLine'](x,H[as]['vPos'][0x1-at],H[as]['vPos'][at],0x0),x++,H[as]['bProcessed']=!![],L++,as=H[as]['linkedEdgeIndex'][at][0x0],at=0x1-H[as]['linkedEdgeIndex'][at][0x1]);if(as<0x0||as==ap)break;}au=new b['Vector3']()['subVectors'](H[as]['vPos'][at],H[as]['vPos'][0x1-at]),aw=H[as]['fLength'],ay=H[as];for(let aX=0x0;aX<B;aX++){let aY=H[as]['linkedEdgeIndex'][at][0x0],aZ=0x1-H[as]['linkedEdgeIndex'][at][0x1];as=aY,at=aZ;if(as<0x0||as===ap)break;av=new b['Vector3']()['subVectors'](H[as]['vPos'][at],H[as]['vPos'][0x1-at]),ax=H[as]['fLength'],ax>1e-7&&aw>1e-7&&(ay['fCosAngle']=av['dot'](au)/ax/aw),au=av,aw=ax,ay=H[as],ar++;}as=ap,at=aq;for(let b0=0x0;b0<ar;b0++){if(b0>ar-0x4||E){for(let b2=b0;b2<ar;b2++){if(at>0x0){c['AddPreselectEdgeByLine'](x,H[as]['vPos'][at-0x1],H[as]['vPos'][at],0x0),x++,H[as]['bProcessed']=!![],L++,as=H[as]['linkedEdgeIndex'][at][0x0],at=0x1-H[as]['linkedEdgeIndex'][at][0x1];if(as<0x0||as===ap)break;}}break;}let b1=0x1;{let b3,b4,b5=as,b6=at;for(let b7=b0;b7<ar-0x1;b7++){if(b7==b0){b3=H[b5]['fCosAngle'],b4=H[b5]['fLength'];if(b3<0.7071||b3>0.9999)break;b1++;}else{if(Math['abs'](b3-H[b5]['fCosAngle'])>0.005)break;if(Math['abs'](b4-H[b5]['fLength'])>Math['max'](b4*0.01,H[b5]['fLength']*0.01))break;b1++;}b5=H[b5]['linkedEdgeIndex'][b6][0x0],b6=0x1-H[b5]['linkedEdgeIndex'][b6][0x1];if(b5<0x0||b5===ap)break;}}{let b8=H[as]['linkedEdgeIndex'][at][0x0],b9=0x1-H[as]['linkedEdgeIndex'][at][0x1];if(!H[as]['vPos'][0x1-at]['equals'](H[as]['vPos'][at])&&!H[as]['vPos'][at]['equals'](H[b8]['vPos'][b9])&&!H[as]['vPos'][0x1-at]['equals'](H[b8]['vPos'][b9])){let ba=a['Util']['GetCircleCenterPTFrom3Pt'](H[as]['vPos'][0x1-at],H[as]['vPos'][at],H[b8]['vPos'][b9]),bb=new b['Vector3']()['subVectors'](ba,H[as]['vPos'][at])['length']();if(bb>K)b1=0x0;}else b1=0x0;}if(b1>=0x4){let bc=H[as]['linkedEdgeIndex'][at][0x0],bd=0x1-H[as]['linkedEdgeIndex'][at][0x1],be=a['Util']['GetCircleCenterPTFrom3Pt'](H[as]['vPos'][0x1-at],H[as]['vPos'][at],H[bc]['vPos'][bd]),bf=new b['Vector3']()['subVectors'](be,H[as]['vPos'][at])['length']();bf=new b['Vector3']()['subVectors'](be,H[as]['vPos'][0x1-at])['length'](),bf=new b['Vector3']()['subVectors'](be,H[bc]['vPos'][bd])['length']();let bg=new b['Vector3']()['subVectors'](H[as]['vPos'][0x1-at],H[as]['vPos'][at]);bg=new b['Vector3']()['crossVectors'](bg,new b['Vector3']()['subVectors'](H[bc]['vPos'][bd],H[as]['vPos'][at])),bg['normalize']();if(F){{c['AddPreselectEdgeByLine'](x,H[as]['vPos'][at-0x1],H[as]['vPos'][at],0x0),x++,H[as]['bProcessed']=!![],L++,as=H[as]['linkedEdgeIndex'][at][0x0],at=0x1-H[as]['linkedEdgeIndex'][at][0x1];}c['AddPreselectEdgeByLine'](x,be,be,0x0),x++;}else{M++;for(let bh=0x0;bh<b1;bh++){c['AddPreselectEdgeByCircle'](x,H[as]['vPos'][0x1-at],H[as]['vPos'][at],be,bg,bf),H[as]['bProcessed']=!![],as=H[as]['linkedEdgeIndex'][at][0x0],at=0x1-H[as]['linkedEdgeIndex'][at][0x1];if(as<0x0||as===ap)break;}x++;}}else at>0x0&&(c['AddPreselectEdgeByLine'](x,H[as]['vPos'][0x1-at],H[as]['vPos'][at],0x0),x++,H[as]['bProcessed']=!![],L++,as=H[as]['linkedEdgeIndex'][at][0x0],at=0x1-H[as]['linkedEdgeIndex'][at][0x1]);if(as<0x0||as===ap)break;}}if(c['PreselectEdges']['length']>0x0){for(let bi=0x0;bi<c['PreselectObjects']['length'];bi++){c['PreselectObjects'][bi]['flag']['updateProcess']=!![];}return!![];}return![];},this['ReleaseMeasurePreselectInfo']=function(){for(let t=0x0;t<c['PreselectObjects']['length'];t++){a['RenderWGL']['ReleaseDataByObject'](c['PreselectObjects'][t]),c['PreselectObjects'][t]['index']=-0x1,c['PreselectObjects'][t]['id_file']='';}c['PreselectEdges']=[],d=[];},this['AddPreselectEdgeByLine']=function(t,u,v,w){let x=a['Data']['PreselectEdgeItem']();x['id']=t,x['kind']=b['Enum']['PRESELECT_EDGE_KIND']['EDGE'],x['vData'][0x0]=u,x['vData'][0x1]=v,x['fValue']=w,c['PreselectEdges']['push'](x);},this['AddPreselectEdgeByCircle']=function(t,u,v,w,x,y){let z=a['Data']['PreselectEdgeItem']();z['id']=t,z['kind']=b['Enum']['PRESELECT_EDGE_KIND']['CIRCLE'],z['vData'][0x0]=u,z['vData'][0x1]=v,z['vData'][0x2]=w,z['vData'][0x3]=x,z['fValue']=y;{let A=new b['Vector3'](0x0,0x0,0x1),B;if(A['dot'](x)>0.9)A['set'](0x1,0x0,0x0);A=new b['Vector3']()['crossVectors'](A,x),A['normalize'](),B=new b['Vector3']()['copy'](A),B=new b['Vector3']()['crossVectors'](B,x),B['normalize'](),z['vData'][0x4]=A,z['vData'][0x5]=B;}c['PreselectEdges']['push'](z);};function q(t){if(c['PreselectObjects']['length']<=0x0)return;let u=![];for(let M=0x0;M<c['PreselectObjects']['length'];M++){let N=c['PreselectObjects'][M];if(!N['flag']['updateProcess'])break;u=!![];break;}if(!u)return;let w=![],x=![],y=![],z=![],A=![],B=![],C=![],D=![],E=![],F=![],G=![],H=![],I=![],J=![];t['GetProcessFlag'](b['Enum']['MARKUP_FLAG']['POINT'])&&(A=!![],E=!![],F=!![]);t['GetProcessFlag'](b['Enum']['MARKUP_FLAG']['CIRCLE_CENTER'])&&(G=!![]);t['GetProcessFlag'](b['Enum']['MARKUP_FLAG']['AXIS_CENTER'])&&(J=!![]);t['GetProcessFlag'](b['Enum']['MARKUP_FLAG']['SURFACE'])&&(D=!![]);t['GetProcessFlag'](b['Enum']['MARKUP_FLAG']['LINE'])&&(B=!![]);t['GetProcessFlag'](b['Enum']['MARKUP_FLAG']['CIRCLE'])&&(C=!![]);d=[];let K=new b['Color'](0x0,0x0,0x0,0x1),L=c['PreselectEdges']['length'];{let O=c['PreselectObjects'][0x0];O['flag']['updateProcess']&&(a['RenderWGL']['RemoveGLBuffer'](O,!![]),a['RenderWGL']['DeletePipeline'](O['uuid']),a['RenderWGL']['SetDataByObject'](O),a['RenderWGL']['InitRenderPipelineSample'](O));}for(let P=0x1;P<c['PreselectObjects']['length'];P++){let Q=c['PreselectObjects'][P];if(!Q['flag']['updateProcess'])continue;a['RenderWGL']['ReleaseDataByObject'](Q),a['RenderWGL']['DeletePipeline'](Q['uuid']);let R=0x0,S=0x0,T=0x0;for(let U=0x0;U<L;U++){let V=c['PreselectEdges'][U];if(V['kind']===b['Enum']['PRESELECT_EDGE_KIND']['EDGE']){if(A&&P===0x1){K['new'](),Q['attribs']['a_position']['array'][R]=V['vData'][0x0]['x'],Q['attribs']['a_position']['array'][R+0x1]=V['vData'][0x0]['y'],Q['attribs']['a_position']['array'][R+0x2]=V['vData'][0x0]['z'],R+=0x3,Q['attribs']['a_color']['array'][S]=K['r'],Q['attribs']['a_color']['array'][S+0x1]=K['g'],Q['attribs']['a_color']['array'][S+0x2]=K['b'],Q['attribs']['a_color']['array'][S+0x3]=K['a'],S+=0x4,Q['attribs']['a_index']['array'][T]=T,T+=0x1,r(K,U,b['Enum']['PRESELECT_PICK_KIND']['EDGE_START']),K['new']();let W=new b['Vector3']()['addVectors'](V['vData'][0x0],V['vData'][0x1])['multiplyScalar'](0.5);Q['attribs']['a_position']['array'][R]=W['x'],Q['attribs']['a_position']['array'][R+0x1]=W['y'],Q['attribs']['a_position']['array'][R+0x2]=W['z'],R+=0x3,Q['attribs']['a_color']['array'][S]=K['r'],Q['attribs']['a_color']['array'][S+0x1]=K['g'],Q['attribs']['a_color']['array'][S+0x2]=K['b'],Q['attribs']['a_color']['array'][S+0x3]=K['a'],S+=0x4,Q['attribs']['a_index']['array'][T]=T,T+=0x1,r(K,U,b['Enum']['PRESELECT_PICK_KIND']['EDGE_MID']),K['new'](),Q['attribs']['a_position']['array'][R]=V['vData'][0x1]['x'],Q['attribs']['a_position']['array'][R+0x1]=V['vData'][0x1]['y'],Q['attribs']['a_position']['array'][R+0x2]=V['vData'][0x1]['z'],R+=0x3,Q['attribs']['a_color']['array'][S]=K['r'],Q['attribs']['a_color']['array'][S+0x1]=K['g'],Q['attribs']['a_color']['array'][S+0x2]=K['b'],Q['attribs']['a_color']['array'][S+0x3]=K['a'],S+=0x4,Q['attribs']['a_index']['array'][T]=T,T+=0x1,r(K,U,b['Enum']['PRESELECT_PICK_KIND']['EDGE_END']);}else B&&P===0x2&&(K['new'](),Q['attribs']['a_position']['array'][R]=V['vData'][0x0]['x'],Q['attribs']['a_position']['array'][R+0x1]=V['vData'][0x0]['y'],Q['attribs']['a_position']['array'][R+0x2]=V['vData'][0x0]['z'],Q['attribs']['a_position']['array'][R+0x3]=V['vData'][0x1]['x'],Q['attribs']['a_position']['array'][R+0x4]=V['vData'][0x1]['y'],Q['attribs']['a_position']['array'][R+0x5]=V['vData'][0x1]['z'],R+=0x6,Q['attribs']['a_color']['array'][S]=K['r'],Q['attribs']['a_color']['array'][S+0x1]=K['g'],Q['attribs']['a_color']['array'][S+0x2]=K['b'],Q['attribs']['a_color']['array'][S+0x3]=K['a'],Q['attribs']['a_color']['array'][S+0x4]=K['r'],Q['attribs']['a_color']['array'][S+0x5]=K['g'],Q['attribs']['a_color']['array'][S+0x6]=K['b'],Q['attribs']['a_color']['array'][S+0x7]=K['a'],S+=0x8,Q['attribs']['a_index']['array'][T]=T,Q['attribs']['a_index']['array'][T+0x1]=T+0x1,T+=0x2,r(K,U,b['Enum']['PRESELECT_PICK_KIND']['EDGE']));}else{if(V['kind']===b['Enum']['PRESELECT_EDGE_KIND']['CIRCLE']){G&&P===0x1&&(K['new'](),Q['attribs']['a_position']['array'][R]=V['vData'][0x2]['x'],Q['attribs']['a_position']['array'][R+0x1]=V['vData'][0x2]['y'],Q['attribs']['a_position']['array'][R+0x2]=V['vData'][0x2]['z'],R+=0x3,Q['attribs']['a_color']['array'][S]=K['r'],Q['attribs']['a_color']['array'][S+0x1]=K['g'],Q['attribs']['a_color']['array'][S+0x2]=K['b'],Q['attribs']['a_color']['array'][S+0x3]=K['a'],S+=0x4,Q['attribs']['a_index']['array'][T]=T,T+=0x1,r(K,U,b['Enum']['PRESELECT_PICK_KIND']['CIRCLE_CENTER']));if(C&&P===0x3){K['new']();let X=a['MeshProcess']['Get2D3DCircleVertices'](V['vData'][0x2],V['vData'][0x4],V['vData'][0x5],V['fValue'],0x0,0x168);for(let Y=0x1;Y<X['vertices']['length'];Y++){for(let Z=0x1;Z>=0x0;Z--){Q['attribs']['a_position']['array'][R]=X['vertices'][Y-Z]['x'],Q['attribs']['a_position']['array'][R+0x1]=X['vertices'][Y-Z]['y'],Q['attribs']['a_position']['array'][R+0x2]=X['vertices'][Y-Z]['z'],R+=0x3,Q['attribs']['a_color']['array'][S]=K['r'],Q['attribs']['a_color']['array'][S+0x1]=K['g'],Q['attribs']['a_color']['array'][S+0x2]=K['b'],Q['attribs']['a_color']['array'][S+0x3]=K['a'],S+=0x4,Q['attribs']['a_index']['array'][T]=T,T+=0x1;}}r(K,U,b['Enum']['PRESELECT_PICK_KIND']['CIRCLE']);}}}}if(T>0x0){{Q['attribs']['a_position']['array']=new Float32Array(Q['attribs']['a_position']['array'],0x0,Q['attribs']['a_position']['array']['length']),Q['attribs']['a_color']['array']=new Uint8Array(Q['attribs']['a_color']['array'],0x0,Q['attribs']['a_color']['array']['length']),Q['attribs']['a_index']['array']=new Uint32Array(Q['attribs']['a_index']['array'],0x0,Q['attribs']['a_index']['array']['length']);}a['RenderWGL']['SetDataByObject'](Q),a['RenderWGL']['InitRenderPipelineSample'](Q);}}}function r(t,u,v){let w=a['Data']['PreselectEdgeColorTableItem']();w['id']=t['r']+(t['g']<<0x8)+(t['b']<<0x10)+t['a']*0x1000000,w['index']=u,w['pickKind']=v,d['push'](w);};this['RefreshPreselectEdgeProcess']=function(){for(let t=0x0;t<c['PreselectObjects']['length'];t++){let u=c['PreselectObjects'][t];u['flag']['updateProcess']=!![];}},this['RenderPreselectEdgeColor']=function(){let t=a['Control']['GetMode']();if(t!==b['Enum']['CONTROL_STATE']['MARKUP'])return;let u=a['Control']['GetUIMode'](),v=u['GetUIControl']();if(v===undefined)return;if(!v['GetProcessFlag'](b['Enum']['MARKUP_FLAG']['PRESELECT']))return;if(c['PreselectObjects']['length']<=0x0)return;if(c['GetMakePreselectID']()<0x0)return;q(v);let w=new b['Matrix4'](),x=undefined;if(a['useTree'])x=a['Tree']['GetBodies']([c['PreselectObjects'][0x0]['index']]);else x=a['Data']['GetBodies']([c['PreselectObjects'][0x0]['index']]);if(x!==undefined&&x['length']>0x0){let z=a['Data']['ShapeAction']['GetAction'](x[0x0]['object']['id_file'],x[0x0]['origin_id']);z['transform']!==undefined&&w['copy'](z['transform']);}for(let A=0x0;A<c['PreselectObjects']['length'];A++){let B=a['RenderWGL']['GetPipeline'](c['PreselectObjects'][A]['uuid']);if(B===undefined)continue;if(B['listProcess']['length']<=0x0)continue;for(let C=0x0;C<B['listProcess']['length'];C++){B['listProcess'][C]['action']['transform']['copy'](w);}}let y=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']);{a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['BASIC2D']),a['Shader']['SetGLCameraData']();let D=new b['Color']();D['set'](0x0,0x0,0x0,0x0),a['Shader']['SetClipping'](y),a['RenderWGL']['UpdateRenderProcessByObjectOneColor_v2'](c['PreselectObjects'][0x0],D),a['Shader']['EndShader']();}{let E=g,F=h,G=h;a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['PICKING']),a['Shader']['SetPointSize'](E),a['Shader']['SetGLCameraData'](),a['RenderWGL']['SetGLDrawMode'](a['gl']['POINTS']),a['Shader']['SetClipping'](y),a['RenderWGL']['UpdateRenderProcessByColorID_v2'](c['PreselectObjects'][0x1]),a['Shader']['EndShader'](),a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['PICKING']),a['Shader']['SetGLCameraData'](),a['RenderWGL']['SetGLDrawMode'](a['gl']['LINES']),a['Shader']['SetClipping'](y),a['RenderWGL']['UpdateRenderProcessByColorID_v2'](c['PreselectObjects'][0x2]),a['RenderWGL']['SetGLDrawMode'](a['gl']['LINES']),a['Shader']['SetClipping'](y),a['Shader']['SetGLCameraData'](),a['RenderWGL']['UpdateRenderProcessByColorID_v2'](c['PreselectObjects'][0x3]),a['RenderWGL']['SetGLDrawMode'](a['gl']['TRIANGLES']),a['Shader']['EndShader']();}},this['RenderPreselectEdge']=function(){let t=a['Control']['GetMode']();if(t!==b['Enum']['CONTROL_STATE']['MARKUP'])return;let u=a['Control']['GetUIMode'](),v=u['GetUIControl']();if(v===undefined)return;if(!v['GetProcessFlag'](b['Enum']['MARKUP_FLAG']['PRESELECT']))return;if(c['PreselectObjects']['length']<=0x0)return;if(c['GetMakePreselectID']()<0x0)return;q(v);let w=new b['Matrix4'](),x=undefined;if(a['useTree'])x=a['Tree']['GetBodies']([c['PreselectObjects'][0x0]['index']]);else x=a['Data']['GetBodies']([c['PreselectObjects'][0x0]['index']]);if(x!==undefined&&x['length']>0x0){let y=a['Data']['ShapeAction']['GetAction'](x[0x0]['object']['id_file'],x[0x0]['origin_id']);y['transform']!==undefined&&w['copy'](y['transform']);}for(let z=0x0;z<c['PreselectObjects']['length'];z++){let A=a['RenderWGL']['GetPipeline'](c['PreselectObjects'][z]['uuid']);if(A===undefined)continue;if(A['listProcess']['length']<=0x0)continue;for(let B=0x0;B<A['listProcess']['length'];B++){A['listProcess'][B]['action']['transform']['copy'](w);}}{let C=new b['Matrix4']()['copy'](a['Camera']['cameraMatrix']),D=e,E=e,F=e;a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['BASIC3D']),a['Shader']['SetPointSize'](g),a['Shader']['SetGLCameraData'](),a['RenderWGL']['SetGLDrawMode'](a['gl']['POINTS']),a['Shader']['SetClipping'](C),a['RenderWGL']['UpdateRenderProcessByObjectOneColor_v2'](c['PreselectObjects'][0x1],D),a['Shader']['EndShader'](),a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['BASIC3D']),a['Shader']['SetGLCameraData'](),a['Shader']['SetLineThickness'](h),a['Shader']['SetClipping'](C),a['RenderWGL']['SetGLDrawMode'](a['gl']['LINES']),a['Shader']['SetLineThickness'](h),a['Shader']['SetResolutionData'](),a['RenderWGL']['UpdateRenderProcessByObjectOneColor_v2'](c['PreselectObjects'][0x2],E),a['RenderWGL']['SetGLDrawMode'](a['gl']['LINES']),a['RenderWGL']['UpdateRenderProcessByObjectOneColor_v2'](c['PreselectObjects'][0x3],F),a['RenderWGL']['SetGLDrawMode'](a['gl']['TRIANGLES']),a['Shader']['EndShader']();}},this['RenderPreselectData']=function(t){if(t===undefined)return;let u=c['PreselectEdges'][t['index']];if(u===undefined)return;let w=[],x=a['gl']['TRIANGLES'];if(t['pickKind']===b['Enum']['PRESELECT_PICK_KIND']['EDGE'])x=a['gl']['LINES'],w[0x0]=new b['Vector3']()['copy'](u['vData'][0x0]),w[0x1]=new b['Vector3']()['copy'](u['vData'][0x1]);else{if(t['pickKind']===b['Enum']['PRESELECT_PICK_KIND']['EDGE_START'])x=a['gl']['POINTS'],w[0x0]=new b['Vector3']()['copy'](u['vData'][0x0]);else{if(t['pickKind']===b['Enum']['PRESELECT_PICK_KIND']['EDGE_END'])x=a['gl']['POINTS'],w[0x0]=new b['Vector3']()['copy'](u['vData'][0x1]);else{if(t['pickKind']===b['Enum']['PRESELECT_PICK_KIND']['EDGE_MID']){x=a['gl']['POINTS'];let y=new b['Vector3']()['addVectors'](u['vData'][0x0],u['vData'][0x1])['multiplyScalar'](0.5);w[0x0]=new b['Vector3']()['copy'](y);}else{if(t['pickKind']===b['Enum']['PRESELECT_PICK_KIND']['CIRCLE_CENTER'])x=a['gl']['POINTS'],a['Shader']['SetPointSize'](g),w[0x0]=new b['Vector3']()['copy'](u['vData'][0x2]);else{if(t['pickKind']===b['Enum']['PRESELECT_PICK_KIND']['CIRCLE']){x=a['gl']['LINES'];let z=a['MeshProcess']['Get2D3DCircleVertices'](u['vData'][0x2],u['vData'][0x4],u['vData'][0x5],u['fValue'],0x0,0x168),A=w['length'],B=0x0;for(let C=0x1;C<z['vertices']['length'];C++){for(let D=0x1;D>=0x0;D--){w[A]=new b['Vector3']()['copy'](z['vertices'][C-D]),A++;}}}}}}}}if(w['length']>0x0){let E=new b['Matrix4']();if(c['PreselectObjects']['length']>0x0){let M=undefined;if(a['useTree'])M=a['Tree']['GetBodies']([c['PreselectObjects'][0x0]['index']]);else M=a['Data']['GetBodies']([c['PreselectObjects'][0x0]['index']]);if(M!==undefined&&M['length']>0x0){let N=a['Data']['ShapeAction']['GetAction'](M[0x0]['object']['id_file'],M[0x0]['origin_id']);N['transform']!==undefined&&E['copy'](N['transform']);}for(let O=0x0;O<w['length'];O++){w[O]=E['multiplyVector'](w[O]);}}a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['BASIC2D']),a['Shader']['SetPointSize'](g);const F=new b['Matrix4']()['copy'](a['Camera']['matMVP']),G=new b['Matrix4']()['copy'](a['Camera']['screenProjectionMatrix']);a['Shader']['SetMatrix'](G,undefined);let H=new b['Color']()['copy'](f)['glColor']();a['Shader']['SetGLColor'](H['r'],H['g'],H['b'],H['a']);if(x===a['gl']['LINES']){let P=h;![]&&(P=new b['Vector3']()['subVectors'](v2,v1)['length']());let Q=[];for(let R=0x0;R<w['length'];R+=0x2){let S=a['Camera']['world2ScreenWithMatrix'](F,w[R]),T=a['Camera']['world2ScreenWithMatrix'](F,w[R+0x1]);S['z']=0x0,T['z']=0x0;let U=a['MeshProcess']['GetLine'](S,T,P);for(let V=0x0;V<U['vertices']['length'];V++){Q['push'](U['vertices'][V]);}}w=Q,x=a['gl']['TRIANGLES'];}else for(let W=0x0;W<w['length'];W++){let X=a['Camera']['world2ScreenWithMatrix'](F,w[W]);w[W]=X;}let I=0x0,J=[],K=0x0;for(let Y=0x0;Y<w['length'];Y++){J[K]=w[Y]['x'],J[K+0x1]=w[Y]['y'],J[K+0x2]=0x0,K+=0x3,I++;}let L=a['gl']['createBuffer']();a['gl']['bindBuffer'](a['gl']['ARRAY_BUFFER'],L),a['gl']['bufferData'](a['gl']['ARRAY_BUFFER'],new Float32Array(J),a['gl']['STATIC_DRAW']),a['gl']['vertexAttribPointer'](a['Shader']['positionAttributeLocation'],0x3,a['gl']['FLOAT'],![],0x0,0x0),a['gl']['drawArrays'](x,0x0,I),a['gl']['deleteBuffer'](L);}a['Shader']['EndShader']();},this['GetControlPickerPickPos']=function(t,u){if(!c['EnableControlPicker']||!i)return new b['Vector2'](t,u);let v=a['Camera']['clientWidth']/0xf*k;if(l>0x0)v=l*k;else v=a['Camera']['clientWidth']/0xf*k;const w=j['x']+(-0x96+0x26)/0x100*v,z=j['y']+(-0x96+0xf)/0x100*v;return new b['Vector2'](w,z);},this['RenderControlPicker']=function(){const t=i;i=![];if(!c['EnableControlPicker'])return;const u=a['Control']['GetMode']();if(u!==b['Enum']['CONTROL_STATE']['MARKUP'])return;const v=a['Control']['GetUIMode'](),w=v['GetUIControl']();if(w===undefined)return;c['EnableControlMove']=!![];!w['GetProcessFlag'](b['Enum']['MARKUP_FLAG']['PRESELECT'])&&(c['EnableControlMove']=![]);if(c['PreselectObjects']['length']<=0x0)return;if(c['PreselectEdges']['length']<=0x0)return;if(o===undefined){o=a['gl']['createTexture'](),a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],o);let x=new Uint8Array(0x2*0x2*0x4);for(let z=0x0;z<x['length'];z++)x[z]=0x0;a['gl']['texImage2D'](a['gl']['TEXTURE_2D'],0x0,a['gl']['RGBA'],0x2,0x2,0x0,a['gl']['RGBA'],a['gl']['UNSIGNED_BYTE'],x);const y=new Image();y['src']=a['Shader']['DefaultTexture']['SelectMarker'],y['onload']=function(){n=!![],a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],o),a['gl']['texImage2D'](a['gl']['TEXTURE_2D'],0x0,a['gl']['RGBA'],a['gl']['RGBA'],a['gl']['UNSIGNED_BYTE'],y),a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],null),a['Renderer']['Render']();},a['gl']['texParameteri'](a['gl']['TEXTURE_2D'],a['gl']['TEXTURE_MIN_FILTER'],a['gl']['LINEAR']),a['gl']['texParameteri'](a['gl']['TEXTURE_2D'],a['gl']['TEXTURE_MAG_FILTER'],a['gl']['LINEAR']),a['gl']['texParameteri'](a['gl']['TEXTURE_2D'],a['gl']['TEXTURE_WRAP_S'],a['gl']['REPEAT']),a['gl']['texParameteri'](a['gl']['TEXTURE_2D'],a['gl']['TEXTURE_WRAP_T'],a['gl']['REPEAT']),a['gl']['bindTexture'](a['gl']['TEXTURE_2D'],null);return;}if(!n)return;i=!![];{const A=new b['BBox']();A['set'](new b['Vector3'](),new b['Vector3'](a['Camera']['clientWidth'],a['Camera']['clientHeight'],0x0)),(!A['isInBoundBox2D'](j,0x1)||t!=i)&&c['SetControlPickerPositon'](new b['Vector3'](a['Camera']['clientWidth']*0.5,a['Camera']['clientHeight']*0.8,0x0));}{const B=new b['Matrix4']();a['Shader']['BeginShader'](b['Enum']['SHADER_TYPES']['TEXTURE2D']),a['Shader']['SetMatrix'](B,undefined),a['Shader']['SetGLColor'](0x1,0x1,0x1,0x1);let C=function(D,E){let F=a['Camera']['clientWidth']/0xf*k;if(l>0x0)F=l*k;else F=a['Camera']['clientWidth']/0xf*k;if(E===0x0)a['Renderer']['Util']['TextureByScreenCoord'](D,F,F,o,new b['Vector2'](0x0,0x0),new b['Vector2'](0.25,0.5));else{if(E===0x1)a['Renderer']['Util']['TextureByScreenCoord'](new b['Vector3'](D,j['y'],j['z']),F,F,o,new b['Vector2'](0.25,0x0),new b['Vector2'](0.5,0.5));else E===0x2&&a['Renderer']['Util']['TextureByScreenCoord'](new b['Vector3'](D,j['y'],j['z']),F,F,o,new b['Vector2'](0.5,0x0),new b['Vector2'](0.75,0.5));}};if(c['EnableControlMove']===!![]){C(j,0x0);if(c['EnableControlOk']===!![]&&c['EnableControlCancel']===!![]){let D=j['x']+m,E=j['x']+m*0x2;a['Camera']['clientWidth']<D?C(j['x']-m,0x1):C(j['x']+m,0x1);if(a['Camera']['clientWidth']<E){if(a['Camera']['clientWidth']<D)C(j['x']-m*0x2,0x2);else C(j['x']-m,0x2);}else C(j['x']+m*0x2,0x2);}else{if(c['EnableControlCancel']===!![]){let F=j['x']+m;a['Camera']['clientWidth']<F?C(j['x']-m,0x2):C(j['x']+m,0x2);}}}else C(j['x']+m,0x1),C(j['x']+m*0x2,0x2);a['Shader']['EndShader']();}};function s(t,u,v,w){const z=new b['BBox']();z['min']['x']=j['x']+t-w,z['min']['y']=j['y']-w,z['max']['x']=j['x']+t+w,z['max']['y']=j['y']+w,z['update']();if(z['isInBoundBox2D'](new b['Vector3'](u,v,0x0),0x0))return!![];return![];}this['IsMouseDownControlPicker']=function(t,u){const v={'pick':![],'kind':0x0};if(!c['EnableControlPicker']||!i)return v;let w=a['Camera']['clientWidth']/0xf*k;if(l>0x0)w=l*k;else w=a['Camera']['clientWidth']/0xf*k;const z=w*0.5;if(c['EnableControlMove']===!![]){if(s(0x0,t,u,z)===!![])return v['pick']=!![],v['kind']=0x1,v;if(c['EnableControlOk']===!![]){let A=j['x']+m,B=j['x']+m*0x2;if(a['Camera']['clientWidth']<A){if(s(-m,t,u,z)===!![])return v['pick']=!![],v['kind']=0x2,v;}else{if(s(+m,t,u,z)===!![])return v['pick']=!![],v['kind']=0x2,v;}if(a['Camera']['clientWidth']<B){if(a['Camera']['clientWidth']<A){if(s(-(m*0x2),t,u,z)===!![])return v['pick']=!![],v['kind']=0x3,v;}else{if(s(-m,t,u,z)===!![])return v['pick']=!![],v['kind']=0x3,v;}}else{if(s(m*0x2,t,u,z)===!![])return v['pick']=!![],v['kind']=0x3,v;}}else{let C=j['x']+m;if(a['Camera']['clientWidth']<C){if(s(-m,t,u,z)===!![])return v['pick']=!![],v['kind']=0x3,v;}else{if(s(m,t,u,z)===!![])return v['pick']=!![],v['kind']=0x3,v;}}}else{if(s(m,t,u,z)===!![])return v['pick']=!![],v['kind']=0x2,v;else{if(s(m*0x2,t,u,z)===!![])return v['pick']=!![],v['kind']=0x3,v;}}return v;},this['SetControlPickerPositon']=function(t){j['copy'](t);},this['SetControlPickerSize']=function(t){l=t;},this['GetControlPickerSize']=function(){return l;},this['SetPickDefinedObjects']=function(t,u){a['Tree']['EnableUseSelectionMulti'](t,u);},this['ClearDefinedObjects']=function(){a['Tree']['EnableUseSelectionMulti'](undefined,!![]);};}}export default Pick;