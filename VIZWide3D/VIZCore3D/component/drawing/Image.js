class ImageControl{constructor(a){let b=this,c=undefined,d={'x':0x0,'y':0x0},e=0.1,f=![],g=0x0,h=0x0,i=a['canvas'],j=0x1,k=0x1,l=0x0,m=0x0,n=!![];this['scale']={'width':0x1,'height':0x1};function o(w){w['preventDefault']();if(!a['PanMode'])return;i['style']['cursor']='grabbing';const {left:x,top:y}=i['getBoundingClientRect']();d={'x':w['clientX']-x,'y':w['clientY']-y},f=!![],g=d['x'],h=d['y'];}function p(){if(!a['PanMode'])return;i['style']['cursor']='grab',f=![];}function q(w){const {left:z,top:A}=i['getBoundingClientRect']();w['preventDefault']();if(!a['PanMode'])return;if(!f)return;let B=w['clientX']-z,C=w['clientY']-A,D=B-g,E=C-h,F=i['width']*a['_Scale']-i['width'],G=i['height']*a['_Scale']-i['height'];if(a['pointX']+D<-F||a['pointX']+D+i['width']>i['width']*a['_Scale']-F)D=0x0;if(a['pointY']+E<-G||a['pointY']+E+i['height']>i['height']*a['_Scale']-G)E=0x0;a['pointX']+=D,a['pointY']+=E,g=B,h=C,a['DrawSketch']();}function r(w){w['preventDefault']();let z=a['_Scale']*e;const {left:A,top:B}=i['getBoundingClientRect']();let C=w['clientX']-A,D=w['clientY']-B,E=a['_Scale'];C=(C-a['pointX'])/E,D=(D-a['pointY'])/E;w['deltaY']>0x0?a['_Scale']=a['_Scale']-z:a['_Scale']=a['_Scale']+z;a['_Scale']=Math['min'](Math['max'](0x1,a['_Scale']));let F=C*E-C*a['_Scale'],G=D*E-D*a['_Scale'];if(a['SketchItems']['length']>0x0){let H=a['SketchItems'][0x0],I=H['drawitem']['x'],J=H['drawitem']['y'],K=H['image']['canvasWidth'],L=H['image']['canvasHeight'],M=H['image']['canvasWidth'],N=H['image']['canvasHeight'];H['drawitem']['zoom']&&(K*=a['_Scale'],L*=a['_Scale']);if(I+a['pointX']+F>0x0)a['pointX']=0x0,F=0x0;else{if(K+a['pointX']+F<M){let O=M-(K+a['pointX']+F);F+=O;}}if(J+a['pointY']+G>0x0)a['pointY']=0x0,G=0x0;else{if(L+a['pointY']+G<N){let P=N-(L+a['pointY']+G);G+=P;}}}a['pointX']+=F,a['pointY']+=G,a['Scales']=[],a['DrawSketch']();}i['addEventListener']('wheel',r),i['addEventListener']('mousedown',o),i['addEventListener']('mouseup',p),i['addEventListener']('mousemove',q),this['SetImage']=function(w,x){{const y=new Image();let z=a['SketchItem'](),A=document['getElementsByClassName']('VIZWeb3D_Buttons')[0x0]['clientHeight'],B=![],C=undefined,D=function(){let E=a['canvas']['parentNode'],F=E['clientWidth'],G=E['clientHeight']-A,H=E['clientWidth'],I=E['clientHeight']-A;j=0x1,k=0x1;let J=function(K){let L=K['naturalWidth'],M=K['naturalHeight'],N=H/L,O=I/M;N>O?(H=L*O,I=M*O):(H=L*N,I=M*N),z['image']['item']=c,z['image']['src']=w,z['image']['width']=L,z['image']['height']=M,z['image']['canvasWidth']=H,z['image']['canvasHeight']=I,z['drawitem']['zoom']=!![],i['width']=H,i['height']=I,i['style']['left']=(F-i['width'])/0x2+'px',i['style']['top']=(G-i['height'])/0x2+A+'px',n&&(l=i['width'],m=i['height'],n=![]),a['DrawSketch']();};if(B!==!![])y['src']=w;else J(C);c=y,y['onload']=function(){B=!![],C=this,J(C);};};D(),a['SketchItems']['push'](z);if(x)for(let E=0x1;E<x['length'];E++){const F=x[E];a['SketchItems']['push'](F);}a['DrawSketch'](),window['addEventListener']('resize',function(){D(),s(i['width']/l,i['height']/m),l=i['width'],m=i['height'],a['DrawSketch']();});}};function s(w,x){a['pointX']*=w,a['pointY']*=x;for(let y=0x0;y<a['SketchItems']['length'];y++){let z=a['SketchItems'][y];if(!z['visible'])continue;if(z['image']['item']!==undefined)continue;if(z['brush']['position']['length']>0x0)for(let A=0x0;A<z['brush']['position']['length'];A++){const B=z['brush']['position'][A];for(let C=0x0;C<B['length'];C++){let D=B[C]['x']*w,E=B[C]['y']*x;B[C]['x']=D,B[C]['y']=E;}}if(z['line']['position']['length']>0x0)for(let F=0x0;F<z['line']['position']['length'];F++){const G=z['line']['position'][F],H=z['line']['position'][F];let I=G[0x0]['x']*w,J=G[0x0]['y']*x;G[0x0]['x']=I,G[0x0]['y']=J;let K=H[G['length']-0x1]['x']*w,L=H[G['length']-0x1]['y']*x;H[G['length']-0x1]['x']=K,H[G['length']-0x1]['y']=L;}if(z['square']['position']['length']>0x0)for(let M=0x0;M<z['square']['position']['length'];M++){let N=z['square']['position'][M];for(let O=0x0;O<N['length'];O++){let P=N[O]['x']*w,Q=N[O]['y']*x;N[O]['x']=P,N[O]['y']=Q;}}if(z['circle']['position']['length']>0x0)for(let R=0x0;R<z['circle']['position']['length'];R++){const S=z['circle']['position'][R];for(let T=0x0;T<S['length'];T++){let U=S[T]['x']*w,V=S[T]['y']*x;S[T]['x']=U,S[T]['y']=V;}}z['text']['value']!=undefined&&(z['text']['x']*=w,z['text']['y']*=x);}};this['PanMode']=function(){a['PanMode']?(a['PanMode']=![],i['style']['cursor']='default',a['SetMode']()):(a['PanMode']=!![],i['style']['cursor']='grab',a['SetMode'](a['Enum']['Mode']['Pan'])),a['oldMode']!==undefined&&a['oldMode']['Mode']!==this['Mode']&&a['oldMode']['DrawEnd']();};function t(w){const x=new XMLHttpRequest();x['open']('GET',w),x['responseType']='arraybuffer',x['onload']=function(){const y=x['response'],z=new Tiff({'buffer':y});let A=z['toCanvas']();if(A){const B=A['toDataURL'](),C=v(B);url=URL['createObjectURL'](C),c=url;}},x['send']();}let u=w=>{return new Promise((x,y)=>{const z=new XMLHttpRequest();z['open']('GET',w),z['responseType']='arraybuffer',z['onload']=function(){const A=z['response'],B=new Tiff({'buffer':A});let C=B['toCanvas']();if(C){const D=C['toDataURL'](),E=v(D),F=URL['createObjectURL'](E);x(F);}},z['send']();});};function v(w){let x=w['split'](','),y=x[0x0]['match'](/:(.*?);/)[0x1],z=atob(x[0x1]),A=z['length'],B=new Uint8Array(A);while(A--){B[A]=z['charCodeAt'](A);}return new Blob([B],{'type':y});};}};export default ImageControl;