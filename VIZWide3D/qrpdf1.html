<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>pdf-lib + QRCode ì˜ˆì œ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    #qrcode {
      margin: 20px auto;
    }
    input {
      width: 250px;
      padding: 8px;
      font-size: 16px;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>ğŸ“„ pdf-libìœ¼ë¡œ QR ì½”ë“œ PDF ë§Œë“¤ê¸°</h2>
  <input type="text" id="textInput" placeholder="QR ì½”ë“œì— ë„£ì„ í…ìŠ¤íŠ¸ ì…ë ¥">
  <button onclick="generateQRCode()">QR ì½”ë“œ ìƒì„±</button>
  <div id="qrcode"></div>
  <button onclick="generatePDF()">ğŸ“¥ PDF ë‹¤ìš´ë¡œë“œ</button>

  <script>
    let qrCodeInstance = null;

    const users = [
    {
      "appConfig": {
        "version": "1.0.3",
        "lastUpdated": "2025-09-23T14:25:00+09:00",
        "features": {
          "darkMode": true,
          "notifications": {
            "email": true,
            "sms": false,
            "push": true
          },
          "language": "ko-KR"
        }
      },
    }
    ];

    function generateQRCode() {
      const text = document.getElementById("textInput").value || "https://example.com";

      // ê¸°ì¡´ QR ì´ˆê¸°í™”
      document.getElementById("qrcode").innerHTML = "";

      // QR ìƒì„±
      qrCodeInstance = new QRCode(document.getElementById("qrcode"), {
        text: JSON.stringify(users),
        width: 150,
        height: 150,
      });
    }

    async function generatePDF() {
      if (!qrCodeInstance) {
        alert("ë¨¼ì € QR ì½”ë“œë¥¼ ìƒì„±í•˜ì„¸ìš”!");
        return;
      }

      // QR Canvasì—ì„œ DataURL ì¶”ì¶œ
      const qrCanvas = document.querySelector("#qrcode canvas");
      const qrDataUrl = qrCanvas.toDataURL("image/png");

      // PDF ìƒì„±
      const { PDFDocument, rgb } = PDFLib;
      const pdfDoc = await PDFDocument.create();
      const page = pdfDoc.addPage([400, 400]);

      // ì œëª© í…ìŠ¤íŠ¸
      const font = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);
      page.drawText("QR Code PDF Example", {
        x: 50,
        y: 350,
        size: 14,
        font,
        color: rgb(0, 0, 0),
      });

      // QR ì´ë¯¸ì§€ ì‚½ì…
      const qrImage = await pdfDoc.embedPng(qrDataUrl);
      const qrDims = qrImage.scale(0.5); // í¬ê¸° ì¡°ì ˆ
      page.drawImage(qrImage, {
        x: 50,
        y: 150,
        width: qrDims.width,
        height: qrDims.height,
      });

      // PDF ì €ì¥ ë° ë‹¤ìš´ë¡œë“œ
      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: "application/pdf" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "qrcode.pdf";
      link.click();
    }
  </script>
</body>
</html>
